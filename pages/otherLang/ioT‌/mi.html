<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>1.米家业务相关在线地址 | 首页</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/Front-end-go-on/logo.png">
    <meta name="description" content="前端记录">
    
    <link rel="preload" href="/Front-end-go-on/assets/css/0.styles.2a02a9f8.css" as="style"><link rel="preload" href="/Front-end-go-on/assets/js/app.b29d28dc.js" as="script"><link rel="preload" href="/Front-end-go-on/assets/js/2.91199c1a.js" as="script"><link rel="preload" href="/Front-end-go-on/assets/js/49.056c89e3.js" as="script"><link rel="prefetch" href="/Front-end-go-on/assets/js/10.dbd61a19.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/11.d2511fcf.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/12.d7e17549.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/13.a25d2e0d.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/14.8196c68b.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/15.9b81dd0e.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/16.6ef023a1.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/17.db28656e.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/18.4dd70cae.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/19.46a529d3.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/20.4512b2d0.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/21.c795f588.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/22.cc2b8396.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/23.62daa4ff.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/24.2eafb7bf.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/25.96da6abe.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/26.c8452eef.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/27.e3ca7a3d.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/28.6b9fb52b.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/29.02132917.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/3.7085e851.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/30.8a251a6a.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/31.22af6b37.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/32.f6f21399.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/33.0de56584.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/34.9edb1269.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/35.1f6efe30.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/36.bad605ef.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/37.526cba22.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/38.546c6275.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/39.44089222.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/4.31a866fe.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/40.54d1c748.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/41.abd2d13f.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/42.4124e16f.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/43.20ef10f6.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/44.ea442036.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/45.1124b109.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/46.eaa3d750.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/47.148fdbb3.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/48.a9ad6709.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/5.6b1d25f3.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/50.9a09e40d.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/51.882983b2.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/52.2cf75d6a.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/53.8a648ff8.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/54.93d20f6b.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/6.81696d45.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/7.faac9166.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/8.33c1098b.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/9.39407bd9.js">
    <link rel="stylesheet" href="/Front-end-go-on/assets/css/0.styles.2a02a9f8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Front-end-go-on/" class="home-link router-link-active"><img src="/Front-end-go-on/logo.png" alt="首页" class="logo"> <span class="site-name can-hide">首页</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Front-end-go-on/pages/frontend/base/Html.html" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/Front-end-go-on/pages/otherLang/node/base.html" class="nav-link">
  非前端
</a></div><div class="nav-item"><a href="/Front-end-go-on/pages/assit/chrome/Extension.html" class="nav-link">
  辅助
</a></div><div class="nav-item"><a href="https://github.com/lll618xxx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Front-end-go-on/pages/frontend/base/Html.html" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/Front-end-go-on/pages/otherLang/node/base.html" class="nav-link">
  非前端
</a></div><div class="nav-item"><a href="/Front-end-go-on/pages/assit/chrome/Extension.html" class="nav-link">
  辅助
</a></div><div class="nav-item"><a href="https://github.com/lll618xxx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>物联网</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Front-end-go-on/pages/otherLang/ioT‌/base.html" class="sidebar-link">基础知识</a></li><li><a href="/Front-end-go-on/pages/otherLang/ioT‌/mi.html" class="active sidebar-link">米家相关</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Front-end-go-on/pages/otherLang/ioT‌/mi.html#_1-米家业务相关在线地址" class="sidebar-link">1.米家业务相关在线地址</a></li><li class="sidebar-sub-header"><a href="/Front-end-go-on/pages/otherLang/ioT‌/mi.html#_2-米家wifi设备的架构和通信流程" class="sidebar-link">2.米家WiFi设备的架构和通信流程</a></li><li class="sidebar-sub-header"><a href="/Front-end-go-on/pages/otherLang/ioT‌/mi.html#_3-插件端开发关键点" class="sidebar-link">3.插件端开发关键点</a></li><li class="sidebar-sub-header"><a href="/Front-end-go-on/pages/otherLang/ioT‌/mi.html#_4-安全机制" class="sidebar-link">4.安全机制</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Node</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Front-end-go-on/pages/otherLang/node/base.html" class="sidebar-link">Node基础</a></li><li><a href="/Front-end-go-on/pages/otherLang/node/frame.html" class="sidebar-link">Node进阶</a></li><li><a href="/Front-end-go-on/pages/otherLang/node/tool.html" class="sidebar-link">Node工具</a></li><li><a href="/Front-end-go-on/pages/otherLang/node/script.html" class="sidebar-link">Node脚本</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Linux</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Front-end-go-on/pages/otherLang/linux/base.html" class="sidebar-link">Linux基础</a></li><li><a href="/Front-end-go-on/pages/otherLang/linux/env.html" class="sidebar-link">Linux环境</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>抓包</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Front-end-go-on/pages/otherLang/wireshark/whistle.html" class="sidebar-link">Whistle</a></li><li><a href="/Front-end-go-on/pages/otherLang/wireshark/fiddler.html" class="sidebar-link">Fiddler</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="_1-米家业务相关在线地址"><a href="#_1-米家业务相关在线地址" class="header-anchor">#</a> 1.米家业务相关在线地址</h2> <p><a href="https://home.miot-spec.com/" target="_blank" rel="noopener noreferrer">小米/米家产品库 - Xiaomi Miot Spec<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://vd.iot.mi.com/home" target="_blank" rel="noopener noreferrer">AIoT平台高仿真系统 - 设备租借<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://autotest.iot.mi.com/acsLanding/" target="_blank" rel="noopener noreferrer">AIoT认证测试平台 - 自动测试<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="_2-米家wifi设备的架构和通信流程"><a href="#_2-米家wifi设备的架构和通信流程" class="header-anchor">#</a> 2.米家WiFi设备的架构和通信流程</h2> <h4 id="_2-1、整体架构"><a href="#_2-1、整体架构" class="header-anchor">#</a> 2-1、整体架构</h4> <p>米家生态的通信流程通常分为三层：</p> <p>1、<strong>设备端</strong>：WiFi模组（如ESP32/乐鑫方案）运行定制固件，支持与云端/App交互。</p> <p>2、<strong>云端服务器</strong>：小米的IoT平台（Miot Cloud）负责设备管理、指令转发和数据存储。</p> <p>3、<strong>客户端（插件/App）</strong>：通过SDK或API与云端交互，间接控制设备。</p> <h4 id="_2-2、关键通信流程"><a href="#_2-2、关键通信流程" class="header-anchor">#</a> 2-2、关键通信流程</h4> <p><strong>1、设备配网（Provisioning）</strong></p> <p>设备初次联网需通过「Smart Config」或「AP配网模式」：</p> <ul><li><p><strong>Smart Config</strong>：手机App发送WiFi SSID/Password的加密广播包（UDP），设备监听并解析。</p></li> <li><p><strong>AP模式</strong>：设备开启热点，用户连接后通过HTTP页面提交WiFi信息。</p></li> <li><p><strong>配网后</strong>：设备通过MQTT/TLS与小米云建立长连接，并上报设备信息（DID、Token等）。</p></li></ul> <p><strong>2、认证与绑定</strong></p> <ul><li><p><strong>设备唯一标识</strong>：每个设备拥有唯一的DID（Device ID）和Token（加密密钥）。</p></li> <li><p><strong>绑定流程</strong>：用户通过App扫码或手动添加设备，云端验证Token后绑定设备到账户。</p></li></ul> <p><strong>3. 通信协议</strong></p> <p>米家采用分层协议设计，核心协议包括：</p> <ul><li><p><strong>传输层</strong>：基于TLS加密的MQTT协议（长连接）+ HTTP（配置/OTA升级）。</p></li> <li><p><strong>应用层</strong>：自定义二进制协议（部分设备开放HTTP API），数据格式通常为JSON或Protobuf。</p></li></ul> <p><strong>MQTT 主题结构</strong></p> <p>设备与云端通过MQTT的Topic订阅/发布消息：</p> <ul><li><p><strong>指令下发</strong>：miio/command/{DID}</p></li> <li><p><strong>状态上报</strong>：miio/report/{DID}</p></li> <li><p><strong>设备心跳</strong>：miio/heartbeat/{DID}</p></li></ul> <p><strong>4. 指令交互流程</strong></p> <p>以开关灯为例：</p> <p>App/插件端：调用小米云API（如miot-spec.com）发送指令（JSON格式）。</p> <p>云端：验证权限后，通过MQTT将指令转发到目标设备。</p> <p>设备端：执行指令并返回状态码（如{&quot;code&quot;:0}表示成功）。</p> <p>云端：将状态同步到App/插件端。</p> <p><strong>5. 本地通信（可选）</strong></p> <p>部分设备支持局域网控制（绕过云端）：</p> <ul><li><p><strong>协议</strong>：UDP广播 + 自定义二进制协议（如Xiaomi MIoT Spec Local）。</p></li> <li><p><strong>发现设备</strong>：发送广播包到端口54321，设备响应IP和Token。</p></li> <li><p><strong>指令加密</strong>：使用AES-CBC加密，密钥由Token派生。</p></li></ul> <h2 id="_3-插件端开发关键点"><a href="#_3-插件端开发关键点" class="header-anchor">#</a> 3.插件端开发关键点</h2> <h4 id="_3-1、接入方式"><a href="#_3-1、接入方式" class="header-anchor">#</a> 3-1、接入方式：</h4> <ul><li><p><strong>云端API</strong>：通过小米开放平台（Open Cloud）申请API权限，使用OAuth 2.0授权。</p></li> <li><p><strong>本地控制</strong>：需获取设备的Token和IP，直接发送加密指令（需逆向协议）。</p></li></ul> <h4 id="_3-2、sdk支持"><a href="#_3-2、sdk支持" class="header-anchor">#</a> 3-2、SDK支持：</h4> <p>官方提供MiHome SDK或MIoT Spec，封装了协议细节。</p> <p>第三方库（如python-miio）支持部分设备的本地控制。</p> <h4 id="_3-3、数据格式示例-伪代码"><a href="#_3-3、数据格式示例-伪代码" class="header-anchor">#</a> 3-3、数据格式示例（伪代码）：</h4> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">// 云端API指令</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;method&quot;</span><span class="token operator">:</span> <span class="token string">&quot;set_properties&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;params&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token property">&quot;did&quot;</span><span class="token operator">:</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;siid&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token comment">// 服务ID</span>
    <span class="token property">&quot;piid&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment">// 属性ID</span>
    <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="_4-安全机制"><a href="#_4-安全机制" class="header-anchor">#</a> 4.安全机制</h2> <p><strong>设备认证</strong>：Token绑定设备与账户，防止未授权访问。</p> <p><strong>通信加密</strong>：TLS 1.2（云端） + AES（本地）。</p> <p><strong>动态刷新</strong>：部分设备支持Token周期性更新。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">lastUpdate:</span> <span class="time">3/21/2025, 5:01:22 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Front-end-go-on/pages/otherLang/ioT‌/base.html" class="prev">
        基础知识
      </a></span> <span class="next"><a href="/Front-end-go-on/pages/otherLang/node/base.html">
        Node基础
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/Front-end-go-on/assets/js/app.b29d28dc.js" defer></script><script src="/Front-end-go-on/assets/js/2.91199c1a.js" defer></script><script src="/Front-end-go-on/assets/js/49.056c89e3.js" defer></script>
  </body>
</html>

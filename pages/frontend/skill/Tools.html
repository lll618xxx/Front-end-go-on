<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>1、JS浮点数兼容处理 | 首页</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/Front-end-go-on/logo.png">
    <meta name="description" content="前端记录">
    
    <link rel="preload" href="/Front-end-go-on/assets/css/0.styles.2a02a9f8.css" as="style"><link rel="preload" href="/Front-end-go-on/assets/js/app.469290c7.js" as="script"><link rel="preload" href="/Front-end-go-on/assets/js/2.91199c1a.js" as="script"><link rel="preload" href="/Front-end-go-on/assets/js/12.5b21eab7.js" as="script"><link rel="prefetch" href="/Front-end-go-on/assets/js/10.0e1fdea3.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/11.da7412e8.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/13.a25d2e0d.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/14.8196c68b.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/15.9b81dd0e.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/16.6ef023a1.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/17.db28656e.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/18.3e8ad986.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/19.03e97fd3.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/20.370f0ede.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/21.721acf77.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/22.0890a42a.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/23.27bdfa44.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/24.2eafb7bf.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/25.96da6abe.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/26.f4134e11.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/27.825bda6f.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/28.3b031892.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/29.b5ace85c.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/3.e5178497.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/30.51464e32.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/31.d267b579.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/32.9ee227b3.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/33.2e912aeb.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/34.076d1cef.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/35.42620ddc.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/36.7fd1803e.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/37.c8a33880.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/38.e5d59992.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/39.7aa8ce4f.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/4.93a94d6d.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/40.0fc5218a.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/41.7a6efb08.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/42.19d45ec5.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/43.20ef10f6.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/44.e97dd6b2.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/45.6ee2af48.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/46.122e47e0.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/47.299d32ef.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/48.d9bf8103.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/49.657a88e7.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/5.02be03d4.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/50.3233d931.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/51.3a81f672.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/52.6f5911b5.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/53.8a648ff8.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/54.185ee731.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/6.dd46559c.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/7.efe90bd9.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/8.e8820868.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/9.2fba42da.js">
    <link rel="stylesheet" href="/Front-end-go-on/assets/css/0.styles.2a02a9f8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Front-end-go-on/" class="home-link router-link-active"><img src="/Front-end-go-on/logo.png" alt="首页" class="logo"> <span class="site-name can-hide">首页</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Front-end-go-on/pages/frontend/base/Html.html" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/Front-end-go-on/pages/otherLang/node/base.html" class="nav-link">
  非前端
</a></div><div class="nav-item"><a href="/Front-end-go-on/pages/assit/chrome/Extension.html" class="nav-link">
  辅助
</a></div><div class="nav-item"><a href="https://github.com/lll618xxx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Front-end-go-on/pages/frontend/base/Html.html" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/Front-end-go-on/pages/otherLang/node/base.html" class="nav-link">
  非前端
</a></div><div class="nav-item"><a href="/Front-end-go-on/pages/assit/chrome/Extension.html" class="nav-link">
  辅助
</a></div><div class="nav-item"><a href="https://github.com/lll618xxx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Front-end-go-on/pages/frontend/base/Html.html" class="sidebar-link">HTML基础</a></li><li><a href="/Front-end-go-on/pages/frontend/base/Css.html" class="sidebar-link">CSS基础</a></li><li><a href="/Front-end-go-on/pages/frontend/base/Js.html" class="sidebar-link">JS基础</a></li><li><a href="/Front-end-go-on/pages/frontend/base/ES6.html" class="sidebar-link">ES6基础</a></li><li><a href="/Front-end-go-on/pages/frontend/base/Http.html" class="sidebar-link">HTTP基础</a></li><li><a href="/Front-end-go-on/pages/frontend/base/Cache.html" class="sidebar-link">前端缓存</a></li><li><a href="/Front-end-go-on/pages/frontend/base/Algorithm.html" class="sidebar-link">数据结构基础</a></li><li><a href="/Front-end-go-on/pages/frontend/base/MyArticle.html" class="sidebar-link">我的文章</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端进阶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Front-end-go-on/pages/frontend/frame/base/Vue.html" class="sidebar-link">Vue2基础</a></li><li><a href="/Front-end-go-on/pages/frontend/frame/advanced/Vue.html" class="sidebar-link">Vue2进阶</a></li><li><a href="/Front-end-go-on/pages/frontend/frame/base/Vue3.html" class="sidebar-link">Vue3基础</a></li><li><a href="/Front-end-go-on/pages/frontend/frame/base/React.html" class="sidebar-link">React基础</a></li><li><a href="/Front-end-go-on/pages/frontend/frame/advanced/React.html" class="sidebar-link">React进阶</a></li><li><a href="/Front-end-go-on/pages/frontend/frame/base/RN.html" class="sidebar-link">RN基础</a></li><li><a href="/Front-end-go-on/pages/frontend/frame/base/RNEnv.html" class="sidebar-link">RN环境搭建和打包</a></li><li><a href="/Front-end-go-on/pages/frontend/frame/base/Webpack.html" class="sidebar-link">Webpack</a></li><li><a href="/Front-end-go-on/pages/frontend/frame/base/Ts.html" class="sidebar-link">TS基础</a></li><li><a href="/Front-end-go-on/pages/frontend/frame/base/Nuxt.html" class="sidebar-link">Nuxt基础</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端代码练习</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Front-end-go-on/pages/frontend/exercise/Css.html" class="sidebar-link">CSS代码练习</a></li><li><a href="/Front-end-go-on/pages/frontend/exercise/Js.html" class="sidebar-link">JS代码练习</a></li><li><a href="/Front-end-go-on/pages/frontend/exercise/Algorithm.html" class="sidebar-link">算法代码练习</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前端代码技巧</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Front-end-go-on/pages/frontend/skill/Tools.html" aria-current="page" class="active sidebar-link">工具库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Front-end-go-on/pages/frontend/skill/Tools.html#_1、js浮点数兼容处理" class="sidebar-link">1、JS浮点数兼容处理</a></li><li class="sidebar-sub-header"><a href="/Front-end-go-on/pages/frontend/skill/Tools.html#_2、基于vue读取txt文件" class="sidebar-link">2、基于Vue读取txt文件</a></li><li class="sidebar-sub-header"><a href="/Front-end-go-on/pages/frontend/skill/Tools.html#_3、从一个标签页发送消息到另一个标签页" class="sidebar-link">3、从一个标签页发送消息到另一个标签页</a></li><li class="sidebar-sub-header"><a href="/Front-end-go-on/pages/frontend/skill/Tools.html#_4、基于vue纯前端导出excel" class="sidebar-link">4、基于Vue纯前端导出Excel</a></li><li class="sidebar-sub-header"><a href="/Front-end-go-on/pages/frontend/skill/Tools.html#_5、小程序log日志" class="sidebar-link">5、小程序log日志</a></li><li class="sidebar-sub-header"><a href="/Front-end-go-on/pages/frontend/skill/Tools.html#_6、uni-app-小程序-上传文件方法" class="sidebar-link">6、uni-app 小程序 上传文件方法</a></li><li class="sidebar-sub-header"><a href="/Front-end-go-on/pages/frontend/skill/Tools.html#_7、h5错误捕获上报" class="sidebar-link">7、H5错误捕获上报</a></li><li class="sidebar-sub-header"><a href="/Front-end-go-on/pages/frontend/skill/Tools.html#_8、微信小程序反编译" class="sidebar-link">8、微信小程序反编译</a></li><li class="sidebar-sub-header"><a href="/Front-end-go-on/pages/frontend/skill/Tools.html#_9、预解析svga文件" class="sidebar-link">9、预解析SVGA文件</a></li><li class="sidebar-sub-header"><a href="/Front-end-go-on/pages/frontend/skill/Tools.html#_10、常用正则库" class="sidebar-link">10、常用正则库</a></li></ul></li><li><a href="/Front-end-go-on/pages/frontend/skill/Utils.html" class="sidebar-link">工具函数</a></li><li><a href="/Front-end-go-on/pages/frontend/skill/CSSAnimation.html" class="sidebar-link">CSS动画库</a></li><li><a href="/Front-end-go-on/pages/frontend/skill/Css.html" class="sidebar-link">CSS代码技巧</a></li><li><a href="/Front-end-go-on/pages/frontend/skill/Js.html" class="sidebar-link">JS代码技巧</a></li><li><a href="/Front-end-go-on/pages/frontend/skill/Project.html" class="sidebar-link">项目技巧</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="_1、js浮点数兼容处理"><a href="#_1、js浮点数兼容处理" class="header-anchor">#</a> 1、JS浮点数兼容处理</h2> <p><a href="https://www.jianshu.com/p/719379c65a31" target="_blank" rel="noopener noreferrer">参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="example-加法"><a href="#example-加法" class="header-anchor">#</a> example：加法</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">plus</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> num1Digits <span class="token operator">=</span> <span class="token punctuation">(</span>num1<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length
  <span class="token keyword">const</span> num2Digits <span class="token operator">=</span> <span class="token punctuation">(</span>num2<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length
  <span class="token keyword">const</span> baseNum <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>num1Digits<span class="token punctuation">,</span> num2Digits<span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">times</span><span class="token punctuation">(</span>num1<span class="token punctuation">,</span> baseNum<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">times</span><span class="token punctuation">(</span>num2<span class="token punctuation">,</span> baseNum<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> baseNum
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="example-乘法"><a href="#example-乘法" class="header-anchor">#</a> example：乘法</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">times</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> num1String <span class="token operator">=</span> num1<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> num2String <span class="token operator">=</span> num2<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> num1Digits <span class="token operator">=</span> <span class="token punctuation">(</span>num1String<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length
  <span class="token keyword">const</span> num2Digits <span class="token operator">=</span> <span class="token punctuation">(</span>num2String<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length
  <span class="token keyword">const</span> baseNum <span class="token operator">=</span>  Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> num1Digits <span class="token operator">+</span> num2Digits<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token function">Number</span><span class="token punctuation">(</span>num1String<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">Number</span><span class="token punctuation">(</span>num2String<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> baseNum
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="_2、基于vue读取txt文件"><a href="#_2、基于vue读取txt文件" class="header-anchor">#</a> 2、基于Vue读取txt文件</h2> <h3 id="_2-1、beforecreate-生命周期定义方法"><a href="#_2-1、beforecreate-生命周期定义方法" class="header-anchor">#</a> 2-1、beforeCreate 生命周期定义方法</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">beforeCreate</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 读取文件（自定义函数）
     * @param pms {@link Object}：参数：
     *  @param pms.encode {@link String}：编码格式：
     * @return {@link String}：文本内容；
     */</span>
    FileReader<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">reading</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> encode <span class="token punctuation">}</span> <span class="token operator">=</span> pms</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//无符号整型数组</span>
      <span class="token keyword">let</span> text <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TextDecoder</span><span class="token punctuation">(</span>encode <span class="token operator">||</span> <span class="token string">'UTF-8'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> text<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">/* 重写readAsBinaryString函数 */</span>
    FileReader<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">readAsBinaryString</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>onload<span class="token punctuation">)</span>       <span class="token comment">//如果this未重写onload函数，则创建一个公共处理方式</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> e <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token comment">//在this.onload函数中，完成公共处理</span>
          <span class="token keyword">let</span> rs <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>rs<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">readAsArrayBuffer</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//内部会回调this.onload方法</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="_2、read函数"><a href="#_2、read函数" class="header-anchor">#</a> 2、read函数</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code> <span class="token function">read</span> <span class="token punctuation">(</span><span class="token parameter">fileRaw</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> rd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rd<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> e <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token comment">//this.readAsArrayBuffer函数内，会回调this.onload函数。在这里处理结果</span>
      <span class="token keyword">let</span> content <span class="token operator">=</span> rd<span class="token punctuation">.</span><span class="token function">reading</span><span class="token punctuation">(</span><span class="token punctuation">{</span> encode<span class="token operator">:</span> <span class="token string">'UTF-8'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    rd<span class="token punctuation">.</span><span class="token function">readAsBinaryString</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="_3、从一个标签页发送消息到另一个标签页"><a href="#_3、从一个标签页发送消息到另一个标签页" class="header-anchor">#</a> 3、从一个标签页发送消息到另一个标签页</h2> <p><a href="https://github.com/krasimir/lsbridge" target="_blank" rel="noopener noreferrer">github地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="_3-1、add-lsbridge-min-js-to-your-page"><a href="#_3-1、add-lsbridge-min-js-to-your-page" class="header-anchor">#</a> 3-1、Add lsbridge.min.js to your page:</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;js/lsbridge.min.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_3-2、send-messages"><a href="#_3-2、send-messages" class="header-anchor">#</a> 3-2、Send messages:</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>lsbridge<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'my-namespace'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'Hello world!'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_3-3、listen-for-messages"><a href="#_3-3、listen-for-messages" class="header-anchor">#</a> 3-3、Listen for messages:</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>lsbridge<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'my-namespace'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// prints: { message: 'Hello world!'}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_3-4、cancel-listeners-for-specific-namespace"><a href="#_3-4、cancel-listeners-for-specific-namespace" class="header-anchor">#</a> 3-4、Cancel listeners for specific namespace:</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>lsbridge<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token string">'my-namespace'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="lsbridge-min-js"><a href="#lsbridge-min-js" class="header-anchor">#</a> lsbridge.min.js</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">root<span class="token punctuation">,</span> factory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> define <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">&amp;&amp;</span> define<span class="token punctuation">.</span>amd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> factory<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> exports <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        root<span class="token punctuation">.</span>lsbridge <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">/*
      - Storing messages in localStorage.
      - Clients subscribe to the changes and
        they get notified if a new message arrives.
    */</span>

    <span class="token keyword">var</span> api <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    api<span class="token punctuation">.</span>isLSAvailable <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> mod <span class="token operator">=</span> <span class="token string">'_'</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>mod<span class="token punctuation">,</span> mod<span class="token punctuation">)</span><span class="token punctuation">;</span>
            localStorage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span>mod<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">api<span class="token punctuation">.</span>isLSAvailable</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">var</span> interval <span class="token operator">=</span> <span class="token number">100</span>
            <span class="token punctuation">,</span> intervalForRemoval <span class="token operator">=</span> <span class="token number">200</span>
            <span class="token punctuation">,</span> ls <span class="token operator">=</span> localStorage
            <span class="token punctuation">,</span> listeners <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token punctuation">,</span> isLoopStarted <span class="token operator">=</span> <span class="token boolean">false</span>
            <span class="token punctuation">,</span> buffer <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">var</span> <span class="token function-variable function">loop</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">var</span> namespace <span class="token keyword">in</span> listeners</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">var</span> data <span class="token operator">=</span> ls<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>namespace<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">data <span class="token operator">&amp;&amp;</span> buffer<span class="token punctuation">[</span>namespace<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> buffer<span class="token punctuation">[</span>namespace<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    buffer<span class="token punctuation">[</span>namespace<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token keyword">var</span> parsed <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>parsed<span class="token punctuation">)</span> data <span class="token operator">=</span> parsed<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> listeners<span class="token punctuation">[</span>namespace<span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        listeners<span class="token punctuation">[</span>namespace<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ls<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>namespace <span class="token operator">+</span> <span class="token string">'-removeit'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        ls<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>namespace <span class="token operator">+</span> <span class="token string">'-removeit'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                ls<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                ls<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token string">'-removeit'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                buffer<span class="token punctuation">[</span>namespace<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span><span class="token punctuation">,</span> intervalForRemoval<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>namespace<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">!</span>data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    buffer<span class="token punctuation">[</span>namespace<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token function">setTimeout</span><span class="token punctuation">(</span>loop<span class="token punctuation">,</span> interval<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        api<span class="token punctuation">.</span><span class="token function-variable function">send</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">namespace<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> raw <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> data <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> data <span class="token operator">=</span> <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> data <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                raw <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                raw <span class="token operator">=</span> data<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            ls<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>namespace<span class="token punctuation">,</span> raw<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>


        api<span class="token punctuation">.</span><span class="token function-variable function">subscribe</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">namespace<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">!</span>listeners<span class="token punctuation">[</span>namespace<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                listeners<span class="token punctuation">[</span>namespace<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                buffer<span class="token punctuation">[</span>namespace<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            listeners<span class="token punctuation">[</span>namespace<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">!</span>isLoopStarted</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                isLoopStarted <span class="token operator">=</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        api<span class="token punctuation">.</span><span class="token function-variable function">unsubscribe</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">namespace</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">listeners<span class="token punctuation">[</span>namespace<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                listeners<span class="token punctuation">[</span>namespace<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">buffer<span class="token punctuation">[</span>namespace<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                buffer<span class="token punctuation">[</span>namespace<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        api<span class="token punctuation">.</span><span class="token function-variable function">getBuffer</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> buffer<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        api<span class="token punctuation">.</span>send <span class="token operator">=</span> api<span class="token punctuation">.</span><span class="token function-variable function">subscribe</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'localStorage not supported.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> api<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br></div></div><h2 id="_4、基于vue纯前端导出excel"><a href="#_4、基于vue纯前端导出excel" class="header-anchor">#</a> 4、基于Vue纯前端导出Excel</h2> <p><a href="https://www.cnblogs.com/shenjp/p/11398232.html" target="_blank" rel="noopener noreferrer">参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="_4-1、安装依赖-三个"><a href="#_4-1、安装依赖-三个" class="header-anchor">#</a> 4-1、安装依赖（三个）</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npm install file<span class="token operator">-</span>saver xlsx <span class="token operator">-</span><span class="token constant">S</span>
npm install script<span class="token operator">-</span>loader <span class="token operator">-</span><span class="token constant">D</span>  <span class="token comment">// 加载script 需要</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_4-2、src目录下引入所需文件"><a href="#_4-2、src目录下引入所需文件" class="header-anchor">#</a> 4-2、src目录下引入所需文件</h3> <p>/src 目录下新建 vendor文件夹，用于存放 <strong>Blob.js</strong> 和 <strong>Export2Excel.js</strong> 文件  后附这两个文件
注意：如果不叫 vendor 名字，则需要修改 Export2Excel.js 中的代码。</p> <h4 id="_4-2-1-配置webpack-如果用的是cli-2搭建的项目"><a href="#_4-2-1-配置webpack-如果用的是cli-2搭建的项目" class="header-anchor">#</a> 4-2-1 配置webpack，如果用的是cli-2搭建的项目</h4> <p>在 /build/webpack.base.config.js 的resolve 模块中添加一个别名</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.vue'</span><span class="token punctuation">,</span> <span class="token string">'.json'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    alias<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">'vue$'</span><span class="token operator">:</span> <span class="token string">'vue/dist/vue.esm.js'</span><span class="token punctuation">,</span>
      <span class="token string">'@'</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token string">'vendor'</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src/vendor'</span><span class="token punctuation">)</span> <span class="token comment">// 添加一个别名</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_4-2-2-配置webpack-如果用的是cli-3搭建的项目"><a href="#_4-2-2-配置webpack-如果用的是cli-3搭建的项目" class="header-anchor">#</a> 4-2-2 配置webpack，如果用的是cli-3搭建的项目</h4> <p>在 vue.config.js 的resolve 模块中添加一个别名</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">dir</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> dir<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  outputDir<span class="token operator">:</span> <span class="token string">'fxop'</span><span class="token punctuation">,</span>
  runtimeCompiler<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 包含编译器</span>
  publicPath<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">BASE_URL</span> <span class="token operator">||</span> <span class="token string">'./'</span><span class="token punctuation">,</span>
  productionSourceMap<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  transpileDependencies<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'element-ui-verify/dist'</span><span class="token punctuation">,</span> <span class="token string">'vue-echarts'</span><span class="token punctuation">,</span> <span class="token string">'resize-detector'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function-variable function">chainWebpack</span><span class="token operator">:</span> config <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      
    <span class="token comment">// 设置一些别名</span>
    config<span class="token punctuation">.</span>resolve<span class="token punctuation">.</span>alias<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'vendor'</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src/vendor'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'@'</span><span class="token punctuation">,</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    port<span class="token operator">:</span> <span class="token number">8081</span><span class="token punctuation">,</span>
    proxy<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">'/'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        target<span class="token operator">:</span> <span class="token string">'http://test.portal.ads.toponegames.mobi'</span> <span class="token comment">/* 'http://172.16.2.174' 'http://192.168.64.1:8082' */</span><span class="token punctuation">,</span>
        ws<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        changeOrigin<span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="_4-3、在vue中使用"><a href="#_4-3、在vue中使用" class="header-anchor">#</a> 4-3、在vue中使用</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">&quot;exportExcel&quot;</span><span class="token operator">&gt;</span>导出表格<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'export'</span><span class="token punctuation">,</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            loading<span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    methods<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function">exportExcel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> sourceOriginAmount <span class="token operator">=</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    goodsName<span class="token operator">:</span> <span class="token string">'苹果'</span><span class="token punctuation">,</span>
                    sourceCode<span class="token operator">:</span> <span class="token string">'123'</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span>
                    goodsName<span class="token operator">:</span> <span class="token string">'香蕉'</span><span class="token punctuation">,</span>
                    sourceCode<span class="token operator">:</span> <span class="token string">'234'</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 需要导出的数据，可以动态获取</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 设置一个loading，生成Excel需要时间</span>
            <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/vendor/Export2Excel.js'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">excel</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 导入js模块</span>
                <span class="token keyword">const</span> tHeader <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'编号'</span><span class="token punctuation">,</span> <span class="token string">'商品名称'</span><span class="token punctuation">,</span> <span class="token string">'溯源码'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 导出excel 的标题</span>
                <span class="token keyword">const</span> filterVal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'index'</span><span class="token punctuation">,</span> <span class="token string">'goodsName'</span><span class="token punctuation">,</span> <span class="token string">'sourceCode'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 每个标题对应的字段</span>

                <span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token punctuation">(</span>sourceOriginAmount <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 通过 map 方法遍历，组装数据成上面的格式</span>
                    <span class="token keyword">return</span> <span class="token punctuation">{</span>
                        index<span class="token operator">:</span> key <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
                        goodsName<span class="token operator">:</span> item<span class="token punctuation">.</span>goodsName<span class="token punctuation">,</span>
                        sourceCode<span class="token operator">:</span> item<span class="token punctuation">.</span>key
                    <span class="token punctuation">}</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">list</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">formatJson</span><span class="token punctuation">(</span>filterVal<span class="token punctuation">,</span> list<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 生成json数据</span>
                    excel<span class="token punctuation">.</span><span class="token function">export_json_to_excel</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">// 调用excel方法生成表格</span>
                        header<span class="token operator">:</span> tHeader<span class="token punctuation">,</span>
                        data<span class="token punctuation">,</span>
                        filename<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>goodsName
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'暂无无数据'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">formatJson</span> <span class="token punctuation">(</span><span class="token parameter">filterVal<span class="token punctuation">,</span> jsonData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> jsonData<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> filterVal<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">j</span> <span class="token operator">=&gt;</span> v<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div><h3 id="_4-4-文件附录"><a href="#_4-4-文件附录" class="header-anchor">#</a> 4-4 文件附录：</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/* eslint-disable */</span>
<span class="token comment">/* Blob.js
 * A Blob implementation.
 * 2014-05-27
 *
 * By Eli Grey, http://eligrey.com
 * By Devin Samarin, https://github.com/eboyjr
 * License: X11/MIT
 *   See LICENSE.md
 */</span>

<span class="token comment">/*global self, unescape */</span>
<span class="token comment">/*jslint bitwise: true, regexp: true, confusion: true, es5: true, vars: true, white: true,
 plusplus: true */</span>

<span class="token comment">/*! @source http://purl.eligrey.com/github/Blob.js/blob/master/Blob.js */</span>

<span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">view</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token string">'use strict'</span>

  view<span class="token punctuation">.</span><span class="token constant">URL</span> <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token constant">URL</span> <span class="token operator">||</span> view<span class="token punctuation">.</span>webkitURL

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">view<span class="token punctuation">.</span>Blob <span class="token operator">&amp;&amp;</span> view<span class="token punctuation">.</span><span class="token constant">URL</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Internally we use a BlobBuilder implementation to base Blob off of</span>
  <span class="token comment">// in order to support older browsers that only have BlobBuilder</span>
  <span class="token keyword">var</span> BlobBuilder <span class="token operator">=</span>
    view<span class="token punctuation">.</span>BlobBuilder <span class="token operator">||</span>
    view<span class="token punctuation">.</span>WebKitBlobBuilder <span class="token operator">||</span>
    view<span class="token punctuation">.</span>MozBlobBuilder <span class="token operator">||</span>
    <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">view</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> <span class="token function-variable function">get_class</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> Object<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\[object\s(.*)\]$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">FakeBlobBuilder</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">BlobBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">FakeBlob</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">Blob</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> type<span class="token punctuation">,</span> encoding</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> data
          <span class="token keyword">this</span><span class="token punctuation">.</span>size <span class="token operator">=</span> data<span class="token punctuation">.</span>length
          <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> type
          <span class="token keyword">this</span><span class="token punctuation">.</span>encoding <span class="token operator">=</span> encoding
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        FBB_proto <span class="token operator">=</span> FakeBlobBuilder<span class="token punctuation">.</span>prototype<span class="token punctuation">,</span>
        FB_proto <span class="token operator">=</span> FakeBlob<span class="token punctuation">.</span>prototype<span class="token punctuation">,</span>
        FileReaderSync <span class="token operator">=</span> view<span class="token punctuation">.</span>FileReaderSync<span class="token punctuation">,</span>
        <span class="token function-variable function">FileException</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> type<span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        file_ex_codes <span class="token operator">=</span> <span class="token punctuation">(</span>
          <span class="token string">'NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR '</span> <span class="token operator">+</span>
          <span class="token string">'NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR'</span>
        <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        file_ex_code <span class="token operator">=</span> file_ex_codes<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
        real_URL <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token constant">URL</span> <span class="token operator">||</span> view<span class="token punctuation">.</span>webkitURL <span class="token operator">||</span> view<span class="token punctuation">,</span>
        real_create_object_URL <span class="token operator">=</span> real_URL<span class="token punctuation">.</span>createObjectURL<span class="token punctuation">,</span>
        real_revoke_object_URL <span class="token operator">=</span> real_URL<span class="token punctuation">.</span>revokeObjectURL<span class="token punctuation">,</span>
        <span class="token constant">URL</span> <span class="token operator">=</span> real_URL<span class="token punctuation">,</span>
        btoa <span class="token operator">=</span> view<span class="token punctuation">.</span>btoa<span class="token punctuation">,</span>
        atob <span class="token operator">=</span> view<span class="token punctuation">.</span>atob<span class="token punctuation">,</span>
        ArrayBuffer <span class="token operator">=</span> view<span class="token punctuation">.</span>ArrayBuffer<span class="token punctuation">,</span>
        Uint8Array <span class="token operator">=</span> view<span class="token punctuation">.</span>Uint8Array
      FakeBlob<span class="token punctuation">.</span>fake <span class="token operator">=</span> FB_proto<span class="token punctuation">.</span>fake <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token parameter">file_ex_code<span class="token operator">--</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        FileException<span class="token punctuation">.</span>prototype<span class="token punctuation">[</span>file_ex_codes<span class="token punctuation">[</span>file_ex_code<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> file_ex_code <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">!</span>real_URL<span class="token punctuation">.</span>createObjectURL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token constant">URL</span> <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token constant">URL</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function-variable function">createObjectURL</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">blob</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> type <span class="token operator">=</span> blob<span class="token punctuation">.</span>type<span class="token punctuation">,</span>
          data_URI_header
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">type <span class="token operator">===</span> <span class="token keyword">null</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          type <span class="token operator">=</span> <span class="token string">'application/octet-stream'</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>blob <span class="token keyword">instanceof</span> <span class="token class-name">FakeBlob</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          data_URI_header <span class="token operator">=</span> <span class="token string">'data:'</span> <span class="token operator">+</span> type
          <span class="token keyword">if</span> <span class="token punctuation">(</span>blob<span class="token punctuation">.</span>encoding <span class="token operator">===</span> <span class="token string">'base64'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> data_URI_header <span class="token operator">+</span> <span class="token string">';base64,'</span> <span class="token operator">+</span> blob<span class="token punctuation">.</span>data
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>blob<span class="token punctuation">.</span>encoding <span class="token operator">===</span> <span class="token string">'URI'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> data_URI_header <span class="token operator">+</span> <span class="token string">','</span> <span class="token operator">+</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>blob<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">btoa</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> data_URI_header <span class="token operator">+</span> <span class="token string">';base64,'</span> <span class="token operator">+</span> <span class="token function">btoa</span><span class="token punctuation">(</span>blob<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> data_URI_header <span class="token operator">+</span> <span class="token string">','</span> <span class="token operator">+</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>blob<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">real_create_object_URL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token function">real_create_object_URL</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>real_URL<span class="token punctuation">,</span> blob<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function-variable function">revokeObjectURL</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">object_URL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>object_URL<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token string">'data:'</span> <span class="token operator">&amp;&amp;</span> real_revoke_object_URL<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">real_revoke_object_URL</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>real_URL<span class="token punctuation">,</span> object_URL<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      FBB_proto<span class="token punctuation">.</span><span class="token function-variable function">append</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>data <span class="token comment">/*, endings*/</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> bb <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data
        <span class="token comment">// decode data to a binary string</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Uint8Array <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>data <span class="token keyword">instanceof</span> <span class="token class-name">ArrayBuffer</span> <span class="token operator">||</span> data <span class="token keyword">instanceof</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span>
            buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span>
            i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
            buf_len <span class="token operator">=</span> buf<span class="token punctuation">.</span>length
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> buf_len<span class="token punctuation">;</span> i<span class="token operator">++</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            str <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
          bb<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">get_class</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'Blob'</span> <span class="token operator">||</span> <span class="token function">get_class</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'File'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">FileReaderSync</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> fr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReaderSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            bb<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fr<span class="token punctuation">.</span><span class="token function">readAsBinaryString</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// async FileReader won't work as BlobBuilder is sync</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">FileException</span><span class="token punctuation">(</span><span class="token string">'NOT_READABLE_ERR'</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token keyword">instanceof</span> <span class="token class-name">FakeBlob</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>encoding <span class="token operator">===</span> <span class="token string">'base64'</span> <span class="token operator">&amp;&amp;</span> atob<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            bb<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">atob</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>encoding <span class="token operator">===</span> <span class="token string">'URI'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            bb<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>encoding <span class="token operator">===</span> <span class="token string">'raw'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            bb<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> data <span class="token operator">!==</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            data <span class="token operator">+=</span> <span class="token string">''</span> <span class="token comment">// convert unsupported types to strings</span>
          <span class="token punctuation">}</span>
          <span class="token comment">// decode UTF-16 to binary string</span>
          bb<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">unescape</span><span class="token punctuation">(</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      FBB_proto<span class="token punctuation">.</span><span class="token function-variable function">getBlob</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">!</span>arguments<span class="token punctuation">.</span>length</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          type <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FakeBlob</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span> type<span class="token punctuation">,</span> <span class="token string">'raw'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      FBB_proto<span class="token punctuation">.</span><span class="token function-variable function">toString</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">'[object BlobBuilder]'</span>
      <span class="token punctuation">}</span>
      FB_proto<span class="token punctuation">.</span><span class="token function-variable function">slice</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">start<span class="token punctuation">,</span> end<span class="token punctuation">,</span> type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> args <span class="token operator">=</span> arguments<span class="token punctuation">.</span>length
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">args <span class="token operator">&lt;</span> <span class="token number">3</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          type <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FakeBlob</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> args <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">?</span> end <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">,</span> type<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>encoding<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      FB_proto<span class="token punctuation">.</span><span class="token function-variable function">toString</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">'[object Blob]'</span>
      <span class="token punctuation">}</span>
      FB_proto<span class="token punctuation">.</span><span class="token function-variable function">close</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>size <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> FakeBlobBuilder
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>view<span class="token punctuation">)</span>

  view<span class="token punctuation">.</span><span class="token function-variable function">Blob</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">Blob</span><span class="token punctuation">(</span><span class="token parameter">blobParts<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> type <span class="token operator">=</span> options <span class="token operator">?</span> options<span class="token punctuation">.</span>type <span class="token operator">||</span> <span class="token string">''</span> <span class="token operator">:</span> <span class="token string">''</span>
    <span class="token keyword">var</span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BlobBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">blobParts</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> blobParts<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        builder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>blobParts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">getBlob</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> self <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">&amp;&amp;</span> self<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">&amp;&amp;</span> window<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>content <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/* eslint-disable */</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'script-loader!file-saver'</span><span class="token punctuation">)</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'script-loader!@/vendor/Blob'</span><span class="token punctuation">)</span>
<span class="token keyword">import</span> <span class="token constant">XLSX</span> <span class="token keyword">from</span> <span class="token string">'xlsx'</span>

<span class="token keyword">function</span> <span class="token function">generateArray</span><span class="token punctuation">(</span><span class="token parameter">table</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> out <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">var</span> rows <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'tr'</span><span class="token punctuation">)</span>
  <span class="token keyword">var</span> ranges <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">var</span> <span class="token constant">R</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token constant">R</span> <span class="token operator">&lt;</span> rows<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span><span class="token constant">R</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> outRow <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">var</span> row <span class="token operator">=</span> rows<span class="token punctuation">[</span><span class="token constant">R</span><span class="token punctuation">]</span>
    <span class="token keyword">var</span> columns <span class="token operator">=</span> row<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'td'</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">var</span> <span class="token constant">C</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token constant">C</span> <span class="token operator">&lt;</span> columns<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span><span class="token constant">C</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> cell <span class="token operator">=</span> columns<span class="token punctuation">[</span><span class="token constant">C</span><span class="token punctuation">]</span>
      <span class="token keyword">var</span> colspan <span class="token operator">=</span> cell<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'colspan'</span><span class="token punctuation">)</span>
      <span class="token keyword">var</span> rowspan <span class="token operator">=</span> cell<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'rowspan'</span><span class="token punctuation">)</span>
      <span class="token keyword">var</span> cellValue <span class="token operator">=</span> cell<span class="token punctuation">.</span>innerText
      <span class="token keyword">if</span> <span class="token punctuation">(</span>cellValue <span class="token operator">!==</span> <span class="token string">''</span> <span class="token operator">&amp;&amp;</span> cellValue <span class="token operator">==</span> <span class="token operator">+</span>cellValue<span class="token punctuation">)</span> cellValue <span class="token operator">=</span> <span class="token operator">+</span>cellValue

      <span class="token comment">//Skip ranges</span>
      ranges<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">range</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token constant">R</span> <span class="token operator">&gt;=</span> range<span class="token punctuation">.</span>s<span class="token punctuation">.</span>r <span class="token operator">&amp;&amp;</span> <span class="token constant">R</span> <span class="token operator">&lt;=</span> range<span class="token punctuation">.</span>e<span class="token punctuation">.</span>r <span class="token operator">&amp;&amp;</span> outRow<span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> range<span class="token punctuation">.</span>s<span class="token punctuation">.</span>c <span class="token operator">&amp;&amp;</span> outRow<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> range<span class="token punctuation">.</span>e<span class="token punctuation">.</span>c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> range<span class="token punctuation">.</span>e<span class="token punctuation">.</span>c <span class="token operator">-</span> range<span class="token punctuation">.</span>s<span class="token punctuation">.</span>c<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> outRow<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>

      <span class="token comment">//Handle Row Span</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">rowspan <span class="token operator">||</span> colspan</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        rowspan <span class="token operator">=</span> rowspan <span class="token operator">||</span> <span class="token number">1</span>
        colspan <span class="token operator">=</span> colspan <span class="token operator">||</span> <span class="token number">1</span>
        ranges<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> s<span class="token operator">:</span> <span class="token punctuation">{</span> r<span class="token operator">:</span> <span class="token constant">R</span><span class="token punctuation">,</span> c<span class="token operator">:</span> outRow<span class="token punctuation">.</span>length <span class="token punctuation">}</span><span class="token punctuation">,</span> e<span class="token operator">:</span> <span class="token punctuation">{</span> r<span class="token operator">:</span> <span class="token constant">R</span> <span class="token operator">+</span> rowspan <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> c<span class="token operator">:</span> outRow<span class="token punctuation">.</span>length <span class="token operator">+</span> colspan <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token comment">//Handle Value</span>
      outRow<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cellValue <span class="token operator">!==</span> <span class="token string">''</span> <span class="token operator">?</span> cellValue <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span>

      <span class="token comment">//Handle Colspan</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>colspan<span class="token punctuation">)</span> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> colspan <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token operator">++</span>k<span class="token punctuation">)</span> outRow<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    out<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>outRow<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>out<span class="token punctuation">,</span> ranges<span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">datenum</span><span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> date1904</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>date1904<span class="token punctuation">)</span> v <span class="token operator">+=</span> <span class="token number">1462</span>
  <span class="token keyword">var</span> epoch <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>epoch <span class="token operator">-</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token constant">UTC</span><span class="token punctuation">(</span><span class="token number">1899</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">24</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">sheet_from_array_of_arrays</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> opts</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> ws <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">var</span> range <span class="token operator">=</span> <span class="token punctuation">{</span> s<span class="token operator">:</span> <span class="token punctuation">{</span> c<span class="token operator">:</span> <span class="token number">10000000</span><span class="token punctuation">,</span> r<span class="token operator">:</span> <span class="token number">10000000</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> e<span class="token operator">:</span> <span class="token punctuation">{</span> c<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> r<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">var</span> <span class="token constant">R</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token constant">R</span> <span class="token operator">!=</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span><span class="token constant">R</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">var</span> <span class="token constant">C</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token constant">C</span> <span class="token operator">!=</span> data<span class="token punctuation">[</span><span class="token constant">R</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span><span class="token constant">C</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>range<span class="token punctuation">.</span>s<span class="token punctuation">.</span>r <span class="token operator">&gt;</span> <span class="token constant">R</span><span class="token punctuation">)</span> range<span class="token punctuation">.</span>s<span class="token punctuation">.</span>r <span class="token operator">=</span> <span class="token constant">R</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>range<span class="token punctuation">.</span>s<span class="token punctuation">.</span>c <span class="token operator">&gt;</span> <span class="token constant">C</span><span class="token punctuation">)</span> range<span class="token punctuation">.</span>s<span class="token punctuation">.</span>c <span class="token operator">=</span> <span class="token constant">C</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>range<span class="token punctuation">.</span>e<span class="token punctuation">.</span>r <span class="token operator">&lt;</span> <span class="token constant">R</span><span class="token punctuation">)</span> range<span class="token punctuation">.</span>e<span class="token punctuation">.</span>r <span class="token operator">=</span> <span class="token constant">R</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>range<span class="token punctuation">.</span>e<span class="token punctuation">.</span>c <span class="token operator">&lt;</span> <span class="token constant">C</span><span class="token punctuation">)</span> range<span class="token punctuation">.</span>e<span class="token punctuation">.</span>c <span class="token operator">=</span> <span class="token constant">C</span>
      <span class="token keyword">var</span> cell <span class="token operator">=</span> <span class="token punctuation">{</span> v<span class="token operator">:</span> data<span class="token punctuation">[</span><span class="token constant">R</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token constant">C</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>cell<span class="token punctuation">.</span>v <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">continue</span>
      <span class="token keyword">var</span> cell_ref <span class="token operator">=</span> <span class="token constant">XLSX</span><span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">encode_cell</span><span class="token punctuation">(</span><span class="token punctuation">{</span> c<span class="token operator">:</span> <span class="token constant">C</span><span class="token punctuation">,</span> r<span class="token operator">:</span> <span class="token constant">R</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> cell<span class="token punctuation">.</span>v <span class="token operator">===</span> <span class="token string">'number'</span><span class="token punctuation">)</span> cell<span class="token punctuation">.</span>t <span class="token operator">=</span> <span class="token string">'n'</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> cell<span class="token punctuation">.</span>v <span class="token operator">===</span> <span class="token string">'boolean'</span><span class="token punctuation">)</span> cell<span class="token punctuation">.</span>t <span class="token operator">=</span> <span class="token string">'b'</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cell<span class="token punctuation">.</span>v <span class="token keyword">instanceof</span> <span class="token class-name">Date</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cell<span class="token punctuation">.</span>t <span class="token operator">=</span> <span class="token string">'n'</span>
        cell<span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token constant">XLSX</span><span class="token punctuation">.</span><span class="token constant">SSF</span><span class="token punctuation">.</span>_table<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span>
        cell<span class="token punctuation">.</span>v <span class="token operator">=</span> <span class="token function">datenum</span><span class="token punctuation">(</span>cell<span class="token punctuation">.</span>v<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> cell<span class="token punctuation">.</span>t <span class="token operator">=</span> <span class="token string">'s'</span>

      ws<span class="token punctuation">[</span>cell_ref<span class="token punctuation">]</span> <span class="token operator">=</span> cell
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>range<span class="token punctuation">.</span>s<span class="token punctuation">.</span>c <span class="token operator">&lt;</span> <span class="token number">10000000</span><span class="token punctuation">)</span> ws<span class="token punctuation">[</span><span class="token string">'!ref'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">XLSX</span><span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">encode_range</span><span class="token punctuation">(</span>range<span class="token punctuation">)</span>
  <span class="token keyword">return</span> ws
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Workbook</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">Workbook</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Workbook</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>SheetNames <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>Sheets <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">s2ab</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
  <span class="token keyword">var</span> view <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">!=</span> s<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> view<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span>
  <span class="token keyword">return</span> buf
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">export_table_to_excel</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> theTable <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
  <span class="token keyword">var</span> oo <span class="token operator">=</span> <span class="token function">generateArray</span><span class="token punctuation">(</span>theTable<span class="token punctuation">)</span>
  <span class="token keyword">var</span> ranges <span class="token operator">=</span> oo<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>

  <span class="token comment">/* original data */</span>
  <span class="token keyword">var</span> data <span class="token operator">=</span> oo<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  <span class="token keyword">var</span> ws_name <span class="token operator">=</span> <span class="token string">'SheetJS'</span>

  <span class="token keyword">var</span> wb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Workbook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    ws <span class="token operator">=</span> <span class="token function">sheet_from_array_of_arrays</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>

  <span class="token comment">/* add ranges to worksheet */</span>
  <span class="token comment">// ws['!cols'] = ['apple', 'banan'];</span>
  ws<span class="token punctuation">[</span><span class="token string">'!merges'</span><span class="token punctuation">]</span> <span class="token operator">=</span> ranges

  <span class="token comment">/* add worksheet to workbook */</span>
  wb<span class="token punctuation">.</span>SheetNames<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>ws_name<span class="token punctuation">)</span>
  wb<span class="token punctuation">.</span>Sheets<span class="token punctuation">[</span>ws_name<span class="token punctuation">]</span> <span class="token operator">=</span> ws

  <span class="token keyword">var</span> wbout <span class="token operator">=</span> <span class="token constant">XLSX</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>wb<span class="token punctuation">,</span> <span class="token punctuation">{</span> bookType<span class="token operator">:</span> <span class="token string">'xlsx'</span><span class="token punctuation">,</span> bookSST<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> type<span class="token operator">:</span> <span class="token string">'binary'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">saveAs</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">s2ab</span><span class="token punctuation">(</span>wbout<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'application/octet-stream'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'test.xlsx'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">export_json_to_excel</span><span class="token punctuation">(</span><span class="token punctuation">{</span> header<span class="token punctuation">,</span> data<span class="token punctuation">,</span> filename <span class="token operator">=</span> <span class="token string">'excel-list'</span><span class="token punctuation">,</span> autoWidth <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* original data */</span>
  data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>data<span class="token punctuation">]</span>
  data<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span>
  <span class="token keyword">var</span> ws_name <span class="token operator">=</span> <span class="token string">'SheetJS'</span>
  <span class="token keyword">var</span> wb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Workbook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    ws <span class="token operator">=</span> <span class="token function">sheet_from_array_of_arrays</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">autoWidth</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/*设置worksheet每列的最大宽度*/</span>
    <span class="token keyword">const</span> colWidth <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">row</span> <span class="token operator">=&gt;</span>
      row<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">val</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">/*先判断是否为null/undefined*/</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">val <span class="token operator">==</span> <span class="token keyword">null</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token punctuation">{</span> wch<span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">val<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">255</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">/*再判断是否为中文*/</span>
          <span class="token keyword">return</span> <span class="token punctuation">{</span> wch<span class="token operator">:</span> val<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">*</span> <span class="token number">2</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token punctuation">{</span> wch<span class="token operator">:</span> val<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    <span class="token comment">/*以第一行为初始值*/</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> colWidth<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> colWidth<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> colWidth<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'wch'</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> colWidth<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'wch'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          result<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'wch'</span><span class="token punctuation">]</span> <span class="token operator">=</span> colWidth<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'wch'</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    ws<span class="token punctuation">[</span><span class="token string">'!cols'</span><span class="token punctuation">]</span> <span class="token operator">=</span> result
  <span class="token punctuation">}</span>

  <span class="token comment">/* add worksheet to workbook */</span>
  wb<span class="token punctuation">.</span>SheetNames<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>ws_name<span class="token punctuation">)</span>
  wb<span class="token punctuation">.</span>Sheets<span class="token punctuation">[</span>ws_name<span class="token punctuation">]</span> <span class="token operator">=</span> ws

  <span class="token keyword">var</span> wbout <span class="token operator">=</span> <span class="token constant">XLSX</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>wb<span class="token punctuation">,</span> <span class="token punctuation">{</span> bookType<span class="token operator">:</span> <span class="token string">'xlsx'</span><span class="token punctuation">,</span> bookSST<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> type<span class="token operator">:</span> <span class="token string">'binary'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">saveAs</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">s2ab</span><span class="token punctuation">(</span>wbout<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'application/octet-stream'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> filename <span class="token operator">+</span> <span class="token string">'.xlsx'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br></div></div><h2 id="_5、小程序log日志"><a href="#_5、小程序log日志" class="header-anchor">#</a> 5、小程序log日志</h2> <p>可根据对应的小程序环境执行不同日志输出</p> <h4 id="develop"><a href="#develop" class="header-anchor">#</a> develop</h4> <p>开发环境 可以看到log的行数</p> <h4 id="trial"><a href="#trial" class="header-anchor">#</a> trial</h4> <p>体验版环境 可在小程序的开发调试，看到log</p> <h4 id="release"><a href="#release" class="header-anchor">#</a> release</h4> <p>线上版环境 需要用户反馈日志，从后台拉取</p> <h3 id="_5-1-log文件"><a href="#_5-1-log文件" class="header-anchor">#</a> 5.1 log文件</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> log <span class="token operator">=</span> wx<span class="token punctuation">.</span>getLogManager <span class="token operator">?</span> wx<span class="token punctuation">.</span><span class="token function">getLogManager</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">level</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>log<span class="token punctuation">)</span> <span class="token keyword">return</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>log<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>log<span class="token punctuation">)</span> <span class="token keyword">return</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>log<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">warn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>log<span class="token punctuation">)</span> <span class="token keyword">return</span>
        log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>log<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span>log <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">oriLogFunc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">logCommon</span><span class="token punctuation">(</span>oriLogFunc<span class="token punctuation">,</span> <span class="token string">'info'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span>

console<span class="token punctuation">.</span>warn <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">oriLogFunc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">logCommon</span><span class="token punctuation">(</span>oriLogFunc<span class="token punctuation">,</span> <span class="token string">'warn'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>warn<span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">logCommon</span><span class="token punctuation">(</span><span class="token parameter">oriLogFunc<span class="token punctuation">,</span> type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> _envVersion <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">getAccountInfoSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?.</span>miniProgram<span class="token operator">?.</span>envVersion
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>_envVersion<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">'develop'</span><span class="token operator">:</span>
            <span class="token keyword">return</span> oriLogFunc
            <span class="token keyword">break</span>
        <span class="token keyword">case</span> <span class="token string">'trial'</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token string">'release'</span><span class="token operator">:</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>arg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">oriLogFunc</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>console<span class="token punctuation">,</span> <span class="token operator">...</span>arg<span class="token punctuation">)</span>
                log<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token operator">...</span>arg<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h3 id="_5-2-在main-js文件中引入"><a href="#_5-2-在main-js文件中引入" class="header-anchor">#</a> 5.2 在main.js文件中引入</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">'./log'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_6、uni-app-小程序-上传文件方法"><a href="#_6、uni-app-小程序-上传文件方法" class="header-anchor">#</a> 6、uni-app 小程序 上传文件方法</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * 小程序专用上传文件方法
 * @param {string} filePath 要上传文件资源的路径 (本地路径)
 * @param {Object} formData HTTP 请求中其他额外的 form data
 * @return {Promise}
 */</span>
<span class="token keyword">function</span> <span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token parameter">filePath<span class="token punctuation">,</span> formData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        wx<span class="token punctuation">.</span><span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>domain<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>commonPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/upload-files/upload</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
            <span class="token comment">// header: {</span>
            <span class="token comment">//     Authorization: 'Bearer ' + uni.getStorageSync('token')</span>
            <span class="token comment">// },</span>
            filePath<span class="token punctuation">,</span>
            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'file'</span><span class="token punctuation">,</span>
            formData<span class="token punctuation">,</span>
            <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function">fail</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h2 id="_7、h5错误捕获上报"><a href="#_7、h5错误捕获上报" class="header-anchor">#</a> 7、H5错误捕获上报</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 通过 VueErrorHandler 捕获的错误</span>
<span class="token comment">// `info` 是 Vue 特定的错误信息，比如错误所在的生命周期钩子</span>
Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token function-variable function">errorHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> info</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// console.log('err, vm, info: ', err, vm, info);</span>
    <span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">发生在 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>info<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">; 具体信息 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>err<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">；组件data：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>
        vm<span class="token punctuation">.</span>$data
    <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token function">uploadLog</span><span class="token punctuation">(</span><span class="token string">'VueErrorHandler'</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Promise catch错误上报，需要在使用promise的地方显示调用.catch()，否则不会捕获错误</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> Promise <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> _promiseCatch <span class="token operator">=</span> <span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>catch
    <span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">catch</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">foo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">_promiseCatch</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">catCatch</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">catCatch</span><span class="token punctuation">(</span><span class="token parameter">foo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> msg <span class="token operator">=</span> args<span class="token punctuation">.</span>stack <span class="token operator">?</span> args<span class="token punctuation">.</span>stack <span class="token operator">:</span> args
        foo <span class="token operator">&amp;&amp;</span> <span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>
        <span class="token function">uploadLog</span><span class="token punctuation">(</span><span class="token string">'PromiseCatch'</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 监听页面的 JS Error 并上报</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">ex</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 一般事件的参数中会包含pos信息。</span>
    <span class="token comment">// logger &amp;&amp; logger.error(ex.error, ex);</span>
    <span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">发生在 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ex<span class="token punctuation">.</span>filename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">; 具体信息 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ex<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">；</span><span class="token template-punctuation string">`</span></span>
    <span class="token function">uploadLog</span><span class="token punctuation">(</span><span class="token string">'JsError'</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 通过 unhandledrejection 捕获的错误</span>
<span class="token comment">// 监听promise未处理的reject错误, 跨域情况下监控不到</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'unhandledrejection'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// console.log('e: unhandledrejection', e);</span>
    <span class="token function">uploadLog</span><span class="token punctuation">(</span><span class="token string">'unhandledrejection'</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">/**
 * 上报数据
 * @param {String} source 错误数据源头
 * @param {String} msg 错误信息
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">uploadLog</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">source<span class="token punctuation">,</span> msg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果msg是Object对象，需要转成字符串</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'[object Object]'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        msg <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> location<span class="token punctuation">.</span>href <span class="token comment">// 页面URL</span>
    <span class="token keyword">const</span> ua <span class="token operator">=</span> navigator<span class="token punctuation">.</span>userAgent <span class="token comment">// userAgent</span>

    <span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">H5日志 *** | userID: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>userID<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | 错误源：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>source<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> |\r\n --- | 错误信息：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> |\r\n --- | 访问URL：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> |\r\n --- | UserAgent：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ua<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> |</span><span class="token template-punctuation string">`</span></span>
    jsBridgeClient<span class="token punctuation">.</span><span class="token function">printLog</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><h2 id="_8、微信小程序反编译"><a href="#_8、微信小程序反编译" class="header-anchor">#</a> 8、微信小程序反编译</h2> <h3 id="使用步骤-资源在网盘"><a href="#使用步骤-资源在网盘" class="header-anchor">#</a> 使用步骤，资源在网盘</h3> <h4 id="_1、获取微信小程序加密包"><a href="#_1、获取微信小程序加密包" class="header-anchor">#</a> 1、获取微信小程序加密包</h4> <p>电脑微信使用小程序，使用 everything 工具，输入.wxapkg 后缀名，然后点击修改时间倒叙排序（要提前删除小程序，重新进入登录，才能准确找到小程序加密包）</p> <img src="/Front-end-go-on/assets/img/259f7e4fedda391fc9a1e878177bf17d.11148b92.jpg"> <p>进入文件夹，打开 UnpackMiniApp.exe 文件，选择需要破解的微信小程序包（注意：需要在和 UnpackMiniApp.exe 同级目录下，新建立）</p> <img src="/Front-end-go-on/assets/img/e06cab830093c6ae9e718ea4f7839b6e.5b30361c.jpg"> <h4 id="_2、解析获取混淆源码"><a href="#_2、解析获取混淆源码" class="header-anchor">#</a> 2、解析获取混淆源码</h4> <p>破解之后会有一个新的 wxapkg 文件（在 wxpack 目录里面），放入 wxappUnpacker 目录，执行命令 npm run pkg wx1b17fa6e767ff55f.wxapkg， 转换为混淆过后的源码</p> <img src="/Front-end-go-on/assets/img/e5ce9c167a0f9dd7978df10af85bae66.b5325999.jpg"> <h2 id="_9、预解析svga文件"><a href="#_9、预解析svga文件" class="header-anchor">#</a> 9、预解析SVGA文件</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * SVGA文件预解析，并存在DB中
 */</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> Downloader<span class="token punctuation">,</span> Parser <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'svga.lite'</span>
<span class="token keyword">import</span> <span class="token constant">DB</span> <span class="token keyword">from</span> <span class="token string">'svga.lite/db'</span>

<span class="token comment">/**
 * 解析SVGA文件
 * @param {Array[String]} fileList svga文件路径
 */</span>
<span class="token keyword">function</span> <span class="token function">parseFile</span><span class="token punctuation">(</span><span class="token parameter">fileList</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">void</span> <span class="token number">0</span>
    <span class="token keyword">let</span> db <span class="token operator">=</span> <span class="token keyword">void</span> <span class="token number">0</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DB</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> downloader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Downloader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> parser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Parser</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    fileList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> curData <span class="token operator">=</span> <span class="token keyword">void</span> <span class="token number">0</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>db<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            curData <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>curData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> fileData <span class="token operator">=</span> <span class="token keyword">await</span> downloader<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>

            data <span class="token operator">=</span> <span class="token keyword">await</span> parser<span class="token punctuation">.</span><span class="token function">do</span><span class="token punctuation">(</span>fileData<span class="token punctuation">)</span>
            <span class="token comment">// 插入数据</span>
            db <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h2 id="_10、常用正则库"><a href="#_10、常用正则库" class="header-anchor">#</a> 10、常用正则库</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * 校验手机号码格式
 * @param {String} phone 手机号码
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">isPhone</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">phone</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^1(3|4|5|6|7|8|9)\d{9}$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 校验邮政编码格式
 * @param {String} postalCode 邮政编码
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">isPostalCode</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">postalCode</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^[1-9][0-9]{5}$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>postalCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 校验邮件地址格式
 * @param {String} email 邮件地址
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">isEmail</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">email</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\w@\w*\.\w</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 检测字符串是否包含中文
 * @param {String} str 字符串
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">isIncludeChinese</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.*[\u4e00-\u9fa5]+.*$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 校验身份证格式
 * @param {String} str 身份证号码
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">isIdCard</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(^[1-9]\d{5}(18|19|([23]\d))\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$)|(^[1-9]\d{5}\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{3}$)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 检测银行卡号格式
 * @param {String} str 银行卡号
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">luhmCheck</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">bankno</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> lastNum <span class="token operator">=</span> bankno<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>bankno<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//取出最后一位（与luhm进行比较）</span>
  <span class="token keyword">var</span> first15Num <span class="token operator">=</span> bankno<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> bankno<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//前15或18位</span>
  <span class="token keyword">var</span> newArr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">var</span> i <span class="token operator">=</span> first15Num<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">--</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//前15或18位倒序存进数组</span>
      newArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>first15Num<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">var</span> arrJiShu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//奇数位*2的积 &lt;9</span>
  <span class="token keyword">var</span> arrJiShu2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//奇数位*2的积 &gt;9</span>
  <span class="token keyword">var</span> arrOuShu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//偶数位数组</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">var</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> newArr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//奇数位</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>newArr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">&lt;</span> <span class="token number">9</span><span class="token punctuation">)</span> arrJiShu<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>newArr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">else</span> arrJiShu2<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>newArr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token comment">//偶数位</span>
      arrOuShu<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>newArr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">var</span> jishu_child1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//奇数位*2 &gt;9 的分割之后的数组个位数</span>
  <span class="token keyword">var</span> jishu_child2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//奇数位*2 &gt;9 的分割之后的数组十位数</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">var</span> h <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> h <span class="token operator">&lt;</span> arrJiShu2<span class="token punctuation">.</span>length<span class="token punctuation">;</span> h<span class="token operator">++</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      jishu_child1<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>arrJiShu2<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      jishu_child2<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>arrJiShu2<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">var</span> sumJiShu <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//奇数位*2 &lt; 9 的数组之和</span>
  <span class="token keyword">var</span> sumOuShu <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//偶数位数组之和</span>
  <span class="token keyword">var</span> sumJiShuChild1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//奇数位*2 &gt;9 的分割之后的数组个位数之和</span>
  <span class="token keyword">var</span> sumJiShuChild2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//奇数位*2 &gt;9 的分割之后的数组十位数之和</span>
  <span class="token keyword">var</span> sumTotal <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> m <span class="token operator">&lt;</span> arrJiShu<span class="token punctuation">.</span>length<span class="token punctuation">;</span> m<span class="token operator">++</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      sumJiShu <span class="token operator">=</span> sumJiShu <span class="token operator">+</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>arrJiShu<span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> n <span class="token operator">&lt;</span> arrOuShu<span class="token punctuation">.</span>length<span class="token punctuation">;</span> n<span class="token operator">++</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      sumOuShu <span class="token operator">=</span> sumOuShu <span class="token operator">+</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>arrOuShu<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> p <span class="token operator">&lt;</span> jishu_child1<span class="token punctuation">.</span>length<span class="token punctuation">;</span> p<span class="token operator">++</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      sumJiShuChild1 <span class="token operator">=</span> sumJiShuChild1 <span class="token operator">+</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>jishu_child1<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      sumJiShuChild2 <span class="token operator">=</span> sumJiShuChild2 <span class="token operator">+</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>jishu_child2<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//计算总和</span>
  sumTotal <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>sumJiShu<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>sumOuShu<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>sumJiShuChild1<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>sumJiShuChild2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">//计算Luhm值</span>
  <span class="token keyword">var</span> k <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>sumTotal<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">10</span> <span class="token operator">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>sumTotal<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> luhm <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">-</span> k<span class="token punctuation">;</span>
  <span class="token keyword">var</span> my <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">lastNum <span class="token operator">==</span> luhm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//Luhm验证通过</span>
      my <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">//银行卡号必须符合Luhm校验</span>
      my <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> my<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br></div></div><p>中国大陆个人身份证号验证
<a href="https://github.com/mc-zone/IDValidator" target="_blank" rel="noopener noreferrer">github参考地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">lastUpdate:</span> <span class="time">2/14/2025, 2:19:31 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Front-end-go-on/pages/frontend/exercise/Algorithm.html" class="prev">
        算法代码练习
      </a></span> <span class="next"><a href="/Front-end-go-on/pages/frontend/skill/Utils.html">
        工具函数
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/Front-end-go-on/assets/js/app.469290c7.js" defer></script><script src="/Front-end-go-on/assets/js/2.91199c1a.js" defer></script><script src="/Front-end-go-on/assets/js/12.5b21eab7.js" defer></script>
  </body>
</html>

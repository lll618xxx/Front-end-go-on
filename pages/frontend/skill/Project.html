<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>1、项目踩坑 | 首页</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/Front-end-go-on/logo.png">
    <meta name="description" content="前端记录">
    
    <link rel="preload" href="/Front-end-go-on/assets/css/0.styles.2a02a9f8.css" as="style"><link rel="preload" href="/Front-end-go-on/assets/js/app.469290c7.js" as="script"><link rel="preload" href="/Front-end-go-on/assets/js/2.91199c1a.js" as="script"><link rel="preload" href="/Front-end-go-on/assets/js/7.efe90bd9.js" as="script"><link rel="prefetch" href="/Front-end-go-on/assets/js/10.0e1fdea3.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/11.da7412e8.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/12.5b21eab7.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/13.a25d2e0d.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/14.8196c68b.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/15.9b81dd0e.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/16.6ef023a1.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/17.db28656e.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/18.3e8ad986.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/19.03e97fd3.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/20.370f0ede.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/21.721acf77.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/22.0890a42a.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/23.27bdfa44.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/24.2eafb7bf.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/25.96da6abe.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/26.f4134e11.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/27.825bda6f.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/28.3b031892.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/29.b5ace85c.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/3.e5178497.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/30.51464e32.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/31.d267b579.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/32.9ee227b3.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/33.2e912aeb.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/34.076d1cef.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/35.42620ddc.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/36.7fd1803e.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/37.c8a33880.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/38.e5d59992.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/39.7aa8ce4f.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/4.93a94d6d.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/40.0fc5218a.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/41.7a6efb08.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/42.19d45ec5.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/43.20ef10f6.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/44.e97dd6b2.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/45.6ee2af48.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/46.122e47e0.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/47.299d32ef.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/48.d9bf8103.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/49.657a88e7.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/5.02be03d4.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/50.3233d931.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/51.3a81f672.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/52.6f5911b5.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/53.8a648ff8.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/54.185ee731.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/6.dd46559c.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/8.e8820868.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/9.2fba42da.js">
    <link rel="stylesheet" href="/Front-end-go-on/assets/css/0.styles.2a02a9f8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Front-end-go-on/" class="home-link router-link-active"><img src="/Front-end-go-on/logo.png" alt="首页" class="logo"> <span class="site-name can-hide">首页</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Front-end-go-on/pages/frontend/base/Html.html" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/Front-end-go-on/pages/otherLang/node/base.html" class="nav-link">
  非前端
</a></div><div class="nav-item"><a href="/Front-end-go-on/pages/assit/chrome/Extension.html" class="nav-link">
  辅助
</a></div><div class="nav-item"><a href="https://github.com/lll618xxx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Front-end-go-on/pages/frontend/base/Html.html" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/Front-end-go-on/pages/otherLang/node/base.html" class="nav-link">
  非前端
</a></div><div class="nav-item"><a href="/Front-end-go-on/pages/assit/chrome/Extension.html" class="nav-link">
  辅助
</a></div><div class="nav-item"><a href="https://github.com/lll618xxx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Front-end-go-on/pages/frontend/base/Html.html" class="sidebar-link">HTML基础</a></li><li><a href="/Front-end-go-on/pages/frontend/base/Css.html" class="sidebar-link">CSS基础</a></li><li><a href="/Front-end-go-on/pages/frontend/base/Js.html" class="sidebar-link">JS基础</a></li><li><a href="/Front-end-go-on/pages/frontend/base/ES6.html" class="sidebar-link">ES6基础</a></li><li><a href="/Front-end-go-on/pages/frontend/base/Http.html" class="sidebar-link">HTTP基础</a></li><li><a href="/Front-end-go-on/pages/frontend/base/Cache.html" class="sidebar-link">前端缓存</a></li><li><a href="/Front-end-go-on/pages/frontend/base/Algorithm.html" class="sidebar-link">数据结构基础</a></li><li><a href="/Front-end-go-on/pages/frontend/base/MyArticle.html" class="sidebar-link">我的文章</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端进阶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Front-end-go-on/pages/frontend/frame/base/Vue.html" class="sidebar-link">Vue2基础</a></li><li><a href="/Front-end-go-on/pages/frontend/frame/advanced/Vue.html" class="sidebar-link">Vue2进阶</a></li><li><a href="/Front-end-go-on/pages/frontend/frame/base/Vue3.html" class="sidebar-link">Vue3基础</a></li><li><a href="/Front-end-go-on/pages/frontend/frame/base/React.html" class="sidebar-link">React基础</a></li><li><a href="/Front-end-go-on/pages/frontend/frame/advanced/React.html" class="sidebar-link">React进阶</a></li><li><a href="/Front-end-go-on/pages/frontend/frame/base/RN.html" class="sidebar-link">RN基础</a></li><li><a href="/Front-end-go-on/pages/frontend/frame/base/RNEnv.html" class="sidebar-link">RN环境搭建和打包</a></li><li><a href="/Front-end-go-on/pages/frontend/frame/base/Webpack.html" class="sidebar-link">Webpack</a></li><li><a href="/Front-end-go-on/pages/frontend/frame/base/Ts.html" class="sidebar-link">TS基础</a></li><li><a href="/Front-end-go-on/pages/frontend/frame/base/Nuxt.html" class="sidebar-link">Nuxt基础</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端代码练习</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Front-end-go-on/pages/frontend/exercise/Css.html" class="sidebar-link">CSS代码练习</a></li><li><a href="/Front-end-go-on/pages/frontend/exercise/Js.html" class="sidebar-link">JS代码练习</a></li><li><a href="/Front-end-go-on/pages/frontend/exercise/Algorithm.html" class="sidebar-link">算法代码练习</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前端代码技巧</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Front-end-go-on/pages/frontend/skill/Tools.html" class="sidebar-link">工具库</a></li><li><a href="/Front-end-go-on/pages/frontend/skill/Utils.html" class="sidebar-link">工具函数</a></li><li><a href="/Front-end-go-on/pages/frontend/skill/CSSAnimation.html" class="sidebar-link">CSS动画库</a></li><li><a href="/Front-end-go-on/pages/frontend/skill/Css.html" class="sidebar-link">CSS代码技巧</a></li><li><a href="/Front-end-go-on/pages/frontend/skill/Js.html" class="sidebar-link">JS代码技巧</a></li><li><a href="/Front-end-go-on/pages/frontend/skill/Project.html" aria-current="page" class="active sidebar-link">项目技巧</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Front-end-go-on/pages/frontend/skill/Project.html#_1、项目踩坑" class="sidebar-link">1、项目踩坑</a></li><li class="sidebar-sub-header"><a href="/Front-end-go-on/pages/frontend/skill/Project.html#_2、h5和app的webview交互" class="sidebar-link">2、H5和App的Webview交互</a></li><li class="sidebar-sub-header"><a href="/Front-end-go-on/pages/frontend/skill/Project.html#_3、移动端常见问题" class="sidebar-link">3、移动端常见问题</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="_1、项目踩坑"><a href="#_1、项目踩坑" class="header-anchor">#</a> 1、项目踩坑</h2> <h3 id="_1、华为荣耀-自带浏览器-position-fixed-底部被工具栏遮挡-解决办法"><a href="#_1、华为荣耀-自带浏览器-position-fixed-底部被工具栏遮挡-解决办法" class="header-anchor">#</a> 1、华为荣耀 自带浏览器 position:fixed 底部被工具栏遮挡 解决办法</h3> <p>head中添加</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x5-fullscreen<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_2、vue数据变化-视图层没变化-数据强制更新"><a href="#_2、vue数据变化-视图层没变化-数据强制更新" class="header-anchor">#</a> 2、vue数据变化，视图层没变化， 数据强制更新</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$forceUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_2、h5和app的webview交互"><a href="#_2、h5和app的webview交互" class="header-anchor">#</a> 2、H5和App的Webview交互</h2> <h3 id="_2-1、h5通过ua判断是否在webview环境-追加ua"><a href="#_2-1、h5通过ua判断是否在webview环境-追加ua" class="header-anchor">#</a> 2.1、H5通过UA判断是否在webview环境（追加UA）</h3> <p>web页面通过脚本能够很容易的拿到浏览器的ua属性，那么在app启动的时候，自定义添加一个ua属性，那么web页面就能够根据这个自定义的ua属性，轻而易举的判断出是否在app内了。</p> <h3 id="_2-2、js和native交互-jsbridge"><a href="#_2-2、js和native交互-jsbridge" class="header-anchor">#</a> 2.2、JS和Native交互（JSBridge）</h3> <p><a href="https://sevody.github.io/2019/11/10/jsbridge-mechanisms/" target="_blank" rel="noopener noreferrer">参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Hybrid APP 即混合模式开发的 APP，它可以把低成本、高效率、跨平台的 H5 技术和追求极致用户体验的 Native 技术混合在一起来为用户提供服务。而 Hybrid 技术实施的前提，是实现 H5 和 Native APP 之间的通信，这个实现，我们称之为 JSBridge。</p> <img src="data:image/png;base64,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YL63N65evfrM26horPz+++9jZdhKNlYmagAMOaJaMjU1RXBwMJycnDBv3jyk7kut8XMfbqwcGxfLxspEDYTTlUR1NG7cOPTp0wchISE4knEECxYsgInJ4xs9s7EyUePhmRxRPejcuTNiYmJgZmYGNzc3nD1bvdHz3bt3ERwczMbKRI2IIUdUT/T19eHh4YFFixZh8eLF2Lp1K8rKygAAp06dgkajQdduXdlYmagRcbqSqJ4NGjQI8fHxCAsLQ0ZGBoYPH47ExEQsWbKEfSeJGhlDjqgBtG7dGu+99x6SkpKQkZGB+Ph4tGrVSttlEekchhxRA5o8eTImT56s7TKIdBavyRERkWIx5IiISLEYckREpFgMOSIiUiyGHBERKRZDjoiIFIshR0REisWQIyIixWLIERGRYjHkiIhIsRhyRESkWE2ud6VKpYK9vb22y2gSVCqVtksgot/x2FSuuR2XVCIi2i6CiIioIXC6koiIFIshR0REisWQIyIixWLIERGRYjHkiIhIsRhyRESkWAw5IiJSLIYcEREpFkOOiIgUiyFHRESKxZAjIiLFYsgREZFiMeSIiEixGHJERKRYDDkiIlIshhwRESkWQ46IiBSLIUdERIrFkCMiIsViyBERkWIx5IiISLEYckREpFgMOSIiUiyGHBERKRZDjoiIFIshR0REisWQIyIixWLIERGRYjHkiIhIsRhyRESkWAw5IiJSLIYcEREpFkOOiIgUiyFHRESKxZAjIiLFYsgREZFiMeSIiEixGHJERKRYDDkiIlIshhwRESkWQ46IiBSLIUdERIrFkCMiIsViyBERkWL9H5/efgO5zwIjAAAAAElFTkSuQmCC"> <h4 id="h5-调用-native-2-种方式"><a href="#h5-调用-native-2-种方式" class="header-anchor">#</a> H5 调用 Native( 2 种方式)</h4> <ul><li>1.理论上，无论是 iOS 还是 Android，提供的 WebView 容器是可以拦截一切 H5 发起的请求的，无论是标准协议（如 http://、https:// 等）还是私有协议（如 weixin:// ）。基于这个原理，H5 采用私有协议模拟发起 URL 请求，Native 解析这类 URL 并定制相应的处理函数，这就实现了 H5 调用 Native。</li></ul> <img src="/Front-end-go-on/assets/img/native_url.764aba50.png"> <ul><li>2.在 Native 的开发中，开发者可以给 WebView 容器注入全局变量并挂载在 window 对象上，这样前端 js 就可以通过 window 上全局对象方法 来调用一些 Native 的方法。这里需要注意的是方法注入的时机，一般是 WebView 一旦加载页面就需要注入变量。</li></ul> <h4 id="native-调用-h5"><a href="#native-调用-h5" class="header-anchor">#</a> Native 调用 H5</h4> <p>上面提到的给 WebView 容器注入全局变量并挂载在 window 对象上，实际上是 Native 代码执行了一个 evaluateJavaScript 函数，直接运行 js 字符串代码(类似 js 的 eval 函数)，从而实现注入。所以 Native 代码也一样可以通过这个 evaluateJavaScript 函数来调用约定好的 js 函数来实现 H5 的调用。</p> <img src="/Front-end-go-on/assets/img/native_h5.00f048b2.png"> <h3 id="_2-3、唤起app"><a href="#_2-3、唤起app" class="header-anchor">#</a> 2.3、唤起APP</h3> <p><a href="https://juejin.im/post/6869665966792376327#heading-0" target="_blank" rel="noopener noreferrer">参考地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://github.com/zhuanzhuanfe/call-app" target="_blank" rel="noopener noreferrer">github地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>唤端一般包含了 <strong>唤起App</strong> 、 <strong>下载App</strong> 以及 <strong>唤起App失败后自动下载</strong> 这三个功能。</p> <img src="/Front-end-go-on/assets/img/56d66a02e2d44bd6ac2d5677df1b0fe7_tplv-k3u1fbpfcp-zoom-1.b8ab176e.png"> <p>唤端所使用的技术，通常可以统称为Deep Link（深度链接）技术。不同平台对这项技术有着不同的实现，主流的有这几种：</p> <ul><li>URL Scheme（全平台通用）</li> <li>Universal Link（通用链接，iOS系统专属）</li> <li>App Links 以及衍生的 Chrome Intents（安卓系统专属）</li></ul> <p>当然，以上只是国际通用标准，我们还需要考虑到“国内特色”，包括但不限于微信爸爸、微博、UC浏览器等这些环境的唤端，对于这些App，主流的唤端方式有这么几种</p> <ul><li>Universal Link（部分App可用，快被国内主流App禁干净了）</li> <li>微信API launchApplication 和 getInstallState （需要申请白名单，难度很高）</li> <li>微信开放标签 <em>wx-open-launch-app</em> (微信推荐方式，需要审核，流程较繁琐)</li> <li>跳转到应用宝，然后通过应用宝唤端 （适用于微信安卓环境）</li> <li>弹出个蒙层，友好的提示用户，点击右上角按钮，然后选择在浏览器中打开 （easy~）</li></ul> <img src="/Front-end-go-on/assets/img/5f02a8465aa54ccd9d0bf3f78b5f883b_tplv-k3u1fbpfcp-zoom-1.e496e552.png"> <p>主要介绍下 <strong>URL Scheme</strong>、<strong>Universal Link</strong>、<strong>微信唤端</strong> 和 <strong>自家公司App</strong> 四种技术场景下的唤端实现</p> <ul><li>URL Scheme：</li></ul> <p>URL Scheme其实就是一个URL前面的协议部分，比如这个地址 https://m.zhuanzhuan.com，其中 https就是一个Scheme，代表这是一个https的地址。</p> <p>我们再看一个地址 zhuanzhuan://jump/core/myBuyList/jump?tab=0，当我们访问这个地址的时候，如果系统中有注册 zhuanzhuan:// =&gt; 转转App，那么系统便会使用转转App打开这个链接了，接着App会解析URL的path和search部分，执行对应的操作。</p> <p>那么如何向系统注册 zhuanzhuan 这个Scheme呢，安卓可以在 manifest 里通过 intent-filter 配置，iOS 则可以在 info.plist 文件中添加 URL types 来注册一个 Scheme。</p> <ul><li>Scheme的调用方法：</li></ul> <p>Scheme的调用也十分简单，我们可以通过 <strong>location.href</strong> 或 <strong>iframe</strong> 或 <strong>a标签</strong> 来调用 这三种方式并无本质区别，都是让系统访问一个URL，只不过在某些环境下，当方法失效时，需要采用另一种形式。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// SCHEMA_PATH 为 URL Scheme 地址</span>

<span class="token comment">// location.href 形式</span>
window<span class="token punctuation">.</span>top<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token constant">SCHEMA_PATH</span><span class="token punctuation">;</span>

<span class="token comment">// a标签形式</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
a<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;href&quot;</span><span class="token punctuation">,</span> <span class="token constant">SCHEMA_PATH</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
a<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// iframe形式</span>
iframe <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'iframe'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
iframe<span class="token punctuation">.</span>frameBorder <span class="token operator">=</span> <span class="token string">'0'</span><span class="token punctuation">;</span>
iframe<span class="token punctuation">.</span>style<span class="token punctuation">.</span>cssText <span class="token operator">=</span> <span class="token string">'display:none;border:0;width:0;height:0;'</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>iframe<span class="token punctuation">)</span><span class="token punctuation">;</span>
iframe<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token constant">SCHEMA_PATH</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ul><li>唤端失败自动下载：</li></ul> <p>使用URL Scheme会遇到一个棘手的问题，那就是我们无法得知是否成功唤起App。这个也可以理解，因为这个方式本质上就是访问一个URL，并没有特别的地方。</p> <p>但是唤端失败（通常是用户没有装这个App），我们需要引导用户去下载，这就要求我们需要通过一些手段，去检测唤端是否成功。</p> <p>常见的做法是通过监听页面是否在 n秒内 隐藏来判断是否成功唤起App，因为如果唤起，那当前页面必然已经退到后台去了。</p> <p>所以我们处理的流程是这样：</p> <p>1、当点击唤端后，定时器延时n秒(我们设定的是2.5秒)后执行下载操作<br>
2、监听 visibilitychange 事件，如果页面隐藏，则表示唤端成功，清除定时器<br>
3、如果 visibilitychange 事件没有被触发，那么就代表唤端失败，n秒后就会执行下载的操作</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// n秒后执行下载</span>
<span class="token keyword">const</span> timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">__download</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>delay<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 页面隐藏，那么代表已经调起了app，就清除下载的定时器</span>
<span class="token keyword">const</span> <span class="token function-variable function">visibilitychange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> tag <span class="token operator">=</span> document<span class="token punctuation">.</span>hidden <span class="token operator">||</span> document<span class="token punctuation">.</span>webkitHidden<span class="token punctuation">;</span>
  tag <span class="token operator">&amp;&amp;</span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;visibilitychange&quot;</span><span class="token punctuation">,</span> visibilitychange<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;webkitvisibilitychange&quot;</span><span class="token punctuation">,</span> visibilitychange<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>
  <span class="token string">&quot;pagehide&quot;</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token boolean">false</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>不过这个方法有个致命问题，就是 n 应该取多少，不同的手机，唤端的时间并不一样。</p> <p>时间设置太长，用户下载等待太久，会导致用户还没看到下载就退出了。
时间设置太短，可能会导致还没有唤起App，就又同时执行了下载的逻辑。</p> <p>这里我们经过测试，觉得n设置为2500ms-3000ms，是一个比较合适的值</p> <h2 id="_3、移动端常见问题"><a href="#_3、移动端常见问题" class="header-anchor">#</a> 3、移动端常见问题</h2> <h3 id="_3-1、移动端1px边框问题"><a href="#_3-1、移动端1px边框问题" class="header-anchor">#</a> 3-1、移动端1px边框问题</h3> <p><a href="https://www.jianshu.com/p/fa670b737a29" target="_blank" rel="noopener noreferrer">参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>移动端CSS里面写了1px，实际上看起来比1px粗；<br>
UI设计师要求的1px是指设备的物理像素1px，而CSS里记录的像素是逻辑像素。<br>
它们之间存在一个比例关系，可以用javascript中的<code>window.devicePixelRatio</code>来获取，也可以用媒体查询的<code>-webkit-min-device-pixel-ratio</code>来获取。</p> <p>在手机上border无法达到我们想要的效果。这是因为<code>devicePixelRatio</code>特性导致，iPhone的devicePixelRatio==2，而border-width: 1px描述的是设备独立像素。<br>
所以，border被放大到物理像素2px显示，在iPhone上就显得较粗。</p> <h4 id="解决方案"><a href="#解决方案" class="header-anchor">#</a> 解决方案：</h4> <ul><li>1、媒体查询利用设备像素比缩放，设置小数像素</li></ul> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">.border</span> <span class="token punctuation">{</span> <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #999 <span class="token punctuation">}</span>
<span class="token atrule"><span class="token rule">@media</span> screen <span class="token keyword">and</span> <span class="token punctuation">(</span><span class="token property">-webkit-min-device-pixel-ratio</span><span class="token punctuation">:</span> 2<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
    <span class="token selector">.border</span> <span class="token punctuation">{</span> <span class="token property">border</span><span class="token punctuation">:</span> 0.5px solid #999 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token atrule"><span class="token rule">@media</span> screen <span class="token keyword">and</span> <span class="token punctuation">(</span><span class="token property">-webkit-min-device-pixel-ratio</span><span class="token punctuation">:</span> 3<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
    <span class="token selector">.border</span> <span class="token punctuation">{</span> <span class="token property">border</span><span class="token punctuation">:</span> 0.333333px solid #999 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>2、媒体查询 + transfrom，对第一个方案的优化</li></ul> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token comment">/* 2倍屏 */</span>
<span class="token atrule"><span class="token rule">@media</span> <span class="token keyword">only</span> screen <span class="token keyword">and</span> <span class="token punctuation">(</span><span class="token property">-webkit-min-device-pixel-ratio</span><span class="token punctuation">:</span> 2.0<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
    <span class="token selector">.border-bottom::after</span> <span class="token punctuation">{</span>
        <span class="token property">-webkit-transform</span><span class="token punctuation">:</span> <span class="token function">scaleY</span><span class="token punctuation">(</span>0.5<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scaleY</span><span class="token punctuation">(</span>0.5<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">/* 3倍屏 */</span>
<span class="token atrule"><span class="token rule">@media</span> <span class="token keyword">only</span> screen <span class="token keyword">and</span> <span class="token punctuation">(</span><span class="token property">-webkit-min-device-pixel-ratio</span><span class="token punctuation">:</span> 3.0<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
    <span class="token selector">.border-bottom::after</span> <span class="token punctuation">{</span>
        <span class="token property">-webkit-transform</span><span class="token punctuation">:</span> <span class="token function">scaleY</span><span class="token punctuation">(</span>0.33<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scaleY</span><span class="token punctuation">(</span>0.33<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="_3-2、h5页面窗口自动调整到设备宽度-并禁止用户缩放页面"><a href="#_3-2、h5页面窗口自动调整到设备宽度-并禁止用户缩放页面" class="header-anchor">#</a> 3-2、H5页面窗口自动调整到设备宽度，并禁止用户缩放页面</h3> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_3-3、移动端click屏幕产生300-ms的延迟响应"><a href="#_3-3、移动端click屏幕产生300-ms的延迟响应" class="header-anchor">#</a> 3-3、移动端click屏幕产生300 ms的延迟响应</h3> <p><a href="https://www.cnblogs.com/chaojidan/p/4517895.html" target="_blank" rel="noopener noreferrer">参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="定义"><a href="#定义" class="header-anchor">#</a> 定义：</h4> <p>当用户一次点击屏幕之后，浏览器并不能立刻判断用户是要进行双击缩放，还是想要进行单击操作。因此，就会等待300毫秒，以判断用户是否再次点击了屏幕。</p> <h4 id="解决方案-2"><a href="#解决方案-2" class="header-anchor">#</a> 解决方案：</h4> <ul><li><p>1、通过 meta 标签禁用网页的缩放</p></li> <li><p>2、通过 meta 标签将网页的 viewport 设置为 ideal viewport。</p></li> <li><p>3、FastClick</p></li></ul> <p>FastClick 是 FT Labs 专门为解决移动端浏览器 300 毫秒点击延迟问题所开发的一个轻量级的库。简而言之，FastClick 在检测到 touchend 事件的时候，会通过 DOM 自定义事件立即触发一个模拟click事件的自定义事件，并把浏览器在 300 毫秒之后真正触发的 click 事件阻止掉。</p> <h3 id="_3-4、iphonex的-刘海-底部的安全区域。让页面不能占满屏幕"><a href="#_3-4、iphonex的-刘海-底部的安全区域。让页面不能占满屏幕" class="header-anchor">#</a> 3-4、iphoneX的“刘海”，底部的安全区域。让页面不能占满屏幕</h3> <p><a href="https://www.zhihu.com/question/66761606" target="_blank" rel="noopener noreferrer">参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="解决方案-3"><a href="#解决方案-3" class="header-anchor">#</a> 解决方案：</h4> <p>添加viewport-fit=cover meta标签，使页面占满整个屏幕</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0, viewport-fit=cover<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_3-5、移动端滚动穿透问题"><a href="#_3-5、移动端滚动穿透问题" class="header-anchor">#</a> 3-5、移动端滚动穿透问题</h3> <p><a href="https://www.zhihu.com/question/66761606" target="_blank" rel="noopener noreferrer">参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="定义-2"><a href="#定义-2" class="header-anchor">#</a> 定义：</h4> <p>移动端弹出fixed弹窗的话，在弹窗上滑动会导致下层的页面跟着滚动，这个叫 “滚动穿透”</p> <h4 id="解决方案-4"><a href="#解决方案-4" class="header-anchor">#</a> 解决方案：</h4> <ul><li>1、先定义一个变量，用来记录document的scrollTop值</li> <li>2、在弹窗显示的时候，将最新的document的scrollTop值赋值给之前定义的变量，然后将body设为fixed定位，将body的top值设为之前变量存储的值</li> <li>3、在弹窗消失的时候，将body设为relative定位，将body的top值设为unset</li></ul> <h4 id="vue-mixin代码"><a href="#vue-mixin代码" class="header-anchor">#</a> Vue Mixin代码：</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// mixin.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            scrollTop<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token comment">// 距离顶端的值</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    watch<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function">isShow</span><span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">stopBodyScroll</span><span class="token punctuation">(</span>newVal<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    methods<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function">stopBodyScroll</span><span class="token punctuation">(</span><span class="token parameter">isFixed</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">isFixed</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>scrollTop <span class="token operator">=</span>
                    document<span class="token punctuation">.</span>scrollingElement<span class="token punctuation">.</span>scrollTop <span class="token operator">||</span> window<span class="token punctuation">.</span>scrollY
                document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token string">'fixed'</span>
                document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token operator">-</span><span class="token keyword">this</span><span class="token punctuation">.</span>scrollTop <span class="token operator">+</span> <span class="token string">'px'</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token string">'relative'</span>
                document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token string">'unset'</span>
                window<span class="token punctuation">.</span><span class="token function">scrollTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>scrollTop<span class="token punctuation">)</span> <span class="token comment">// 回到原先的top</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">lastUpdate:</span> <span class="time">2/14/2025, 2:32:58 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Front-end-go-on/pages/frontend/skill/Js.html" class="prev">
        JS代码技巧
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/Front-end-go-on/assets/js/app.469290c7.js" defer></script><script src="/Front-end-go-on/assets/js/2.91199c1a.js" defer></script><script src="/Front-end-go-on/assets/js/7.efe90bd9.js" defer></script>
  </body>
</html>

<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>1.Vue2 生命周期 | 首页</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/Front-end-go-on/logo.png">
    <meta name="description" content="前端记录">
    
    <link rel="preload" href="/Front-end-go-on/assets/css/0.styles.cb101420.css" as="style"><link rel="preload" href="/Front-end-go-on/assets/js/app.de339d43.js" as="script"><link rel="preload" href="/Front-end-go-on/assets/js/2.976a445d.js" as="script"><link rel="preload" href="/Front-end-go-on/assets/js/1.2ccd9185.js" as="script"><link rel="preload" href="/Front-end-go-on/assets/js/12.959b286e.js" as="script"><link rel="prefetch" href="/Front-end-go-on/assets/js/10.c33fa5a6.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/11.bb8fbc2e.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/13.1c3423bc.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/14.d68f0d20.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/15.d671e7a1.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/16.1234a41a.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/17.c67ddf13.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/18.12a524b5.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/19.b99c54e4.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/20.19e2e888.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/21.ce22610e.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/22.bbde2ce1.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/23.e67cdf8a.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/24.039560e6.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/25.d60682a2.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/26.043bf7a8.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/27.ac9c0c34.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/28.6ad7a59c.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/29.0299b147.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/3.9313d513.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/30.c75ac263.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/31.06ae1e67.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/32.2a6b6bb4.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/33.51c8b0d7.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/34.cea152da.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/35.5f047340.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/36.2e3ea820.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/37.2f051343.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/38.d3c01fdc.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/39.354fc377.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/4.30cfb4fe.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/40.15816ae7.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/41.837e4760.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/42.3e15fb8a.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/43.1e91ca7f.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/44.bfb5a9e2.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/45.cc904ba0.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/46.fef92277.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/47.9a45da7e.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/48.3f68a4c3.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/49.85fc7b19.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/5.4c030f55.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/50.250f0394.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/51.039f47b5.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/52.bfa69502.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/53.b3cb7dd1.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/54.251d4069.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/55.3616c2be.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/56.1454ab66.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/57.ce8fd662.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/58.cb2e119a.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/59.0365571e.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/6.017a3cf4.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/60.79522d87.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/61.8efe2a14.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/62.3d847fdf.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/63.1a5d2d30.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/64.bb028ddb.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/65.5ffb0ce6.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/66.211b964a.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/67.2fbb54b5.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/68.dd6fd021.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/69.826a5cf9.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/7.e7c2cec8.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/70.b09a1de8.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/71.31949d89.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/72.1c729f6d.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/73.f59921f5.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/74.4eca680f.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/75.f0db622d.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/76.cd5afc21.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/77.104fd148.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/78.1bcdcbd5.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/79.8e896e5b.js"><link rel="prefetch" href="/Front-end-go-on/assets/js/vendors~docsearch.fc117b08.js">
    <link rel="stylesheet" href="/Front-end-go-on/assets/css/0.styles.cb101420.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Front-end-go-on/" class="home-link router-link-active"><img src="/Front-end-go-on/logo.png" alt="首页" class="logo"> <span class="site-name can-hide">首页</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Front-end-go-on/pages/frontend/base/Html.html" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/Front-end-go-on/pages/otherLang/node/base.html" class="nav-link">
  非前端
</a></div><div class="nav-item"><a href="/Front-end-go-on/pages/assit/chrome/Extension.html" class="nav-link">
  辅助
</a></div><div class="nav-item"><a href="https://github.com/lll618xxx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Front-end-go-on/pages/frontend/base/Html.html" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/Front-end-go-on/pages/otherLang/node/base.html" class="nav-link">
  非前端
</a></div><div class="nav-item"><a href="/Front-end-go-on/pages/assit/chrome/Extension.html" class="nav-link">
  辅助
</a></div><div class="nav-item"><a href="https://github.com/lll618xxx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Front-end-go-on/pages/frontend/base/Html.html" class="sidebar-link">HTML基础</a></li><li><a href="/Front-end-go-on/pages/frontend/base/Css.html" class="sidebar-link">CSS基础</a></li><li><a href="/Front-end-go-on/pages/frontend/base/Js.html" class="sidebar-link">JS基础</a></li><li><a href="/Front-end-go-on/pages/frontend/base/ES6.html" class="sidebar-link">ES6基础</a></li><li><a href="/Front-end-go-on/pages/frontend/base/Http.html" class="sidebar-link">HTTP基础</a></li><li><a href="/Front-end-go-on/pages/frontend/base/Cache.html" class="sidebar-link">前端缓存</a></li><li><a href="/Front-end-go-on/pages/frontend/base/Performance.html" class="sidebar-link">页面性能</a></li><li><a href="/Front-end-go-on/pages/frontend/base/Algorithm.html" class="sidebar-link">数据结构基础</a></li><li><a href="/Front-end-go-on/pages/frontend/base/MyArticle.html" class="sidebar-link">我的文章</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前端进阶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Front-end-go-on/pages/frontend/frame/base/Vue.html" class="sidebar-link">Vue2基础</a></li><li><a href="/Front-end-go-on/pages/frontend/frame/advanced/Vue.html" aria-current="page" class="active sidebar-link">Vue2进阶</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Front-end-go-on/pages/frontend/frame/advanced/Vue.html#_1-vue2-生命周期" class="sidebar-link">1.Vue2 生命周期</a></li><li class="sidebar-sub-header"><a href="/Front-end-go-on/pages/frontend/frame/advanced/Vue.html#_2-父子组件生命周期钩子执行顺序" class="sidebar-link">2.父子组件⽣命周期钩⼦执⾏顺序</a></li><li class="sidebar-sub-header"><a href="/Front-end-go-on/pages/frontend/frame/advanced/Vue.html#_3-v-model是如何实现双向绑定的" class="sidebar-link">3.v-model是如何实现双向绑定的</a></li><li class="sidebar-sub-header"><a href="/Front-end-go-on/pages/frontend/frame/advanced/Vue.html#_4-vue-非父子通信方式" class="sidebar-link">4.Vue 非父子通信方式</a></li><li class="sidebar-sub-header"><a href="/Front-end-go-on/pages/frontend/frame/advanced/Vue.html#_5-vue-router" class="sidebar-link">5.Vue-router</a></li><li class="sidebar-sub-header"><a href="/Front-end-go-on/pages/frontend/frame/advanced/Vue.html#_6-diff算法和虚拟dom" class="sidebar-link">6.diff算法和虚拟dom</a></li><li class="sidebar-sub-header"><a href="/Front-end-go-on/pages/frontend/frame/advanced/Vue.html#_7-vue-数据双向绑定" class="sidebar-link">7.Vue 数据双向绑定</a></li><li class="sidebar-sub-header"><a href="/Front-end-go-on/pages/frontend/frame/advanced/Vue.html#_8-vue-中的-computed-是如何实现" class="sidebar-link">8.Vue 中的 computed 是如何实现</a></li><li class="sidebar-sub-header"><a href="/Front-end-go-on/pages/frontend/frame/advanced/Vue.html#_9-style标签加scoped的作用以及原理" class="sidebar-link">9.style标签加scoped的作用以及原理</a></li><li class="sidebar-sub-header"><a href="/Front-end-go-on/pages/frontend/frame/advanced/Vue.html#_10-vue-template渲染原理" class="sidebar-link">10.vue template渲染原理</a></li><li class="sidebar-sub-header"><a href="/Front-end-go-on/pages/frontend/frame/advanced/Vue.html#_11-new-vue-发生了什么" class="sidebar-link">11. new Vue 发生了什么</a></li><li class="sidebar-sub-header"><a href="/Front-end-go-on/pages/frontend/frame/advanced/Vue.html#其他" class="sidebar-link">其他</a></li></ul></li><li><a href="/Front-end-go-on/pages/frontend/frame/base/Vue3.html" class="sidebar-link">Vue3基础</a></li><li><a href="/Front-end-go-on/pages/frontend/frame/advanced/Vue3.html" class="sidebar-link">Vue3进阶</a></li><li><a href="/Front-end-go-on/pages/frontend/frame/base/React.html" class="sidebar-link">React基础</a></li><li><a href="/Front-end-go-on/pages/frontend/frame/advanced/React.html" class="sidebar-link">React进阶</a></li><li><a href="/Front-end-go-on/pages/frontend/frame/advanced/React18.html" class="sidebar-link">React18新特性</a></li><li><a href="/Front-end-go-on/pages/frontend/frame/base/VueVsReact.html" class="sidebar-link">Vue和React对比</a></li><li><a href="/Front-end-go-on/pages/frontend/frame/base/RN.html" class="sidebar-link">RN基础</a></li><li><a href="/Front-end-go-on/pages/frontend/frame/base/RNEnv.html" class="sidebar-link">RN环境搭建和打包</a></li><li><a href="/Front-end-go-on/pages/frontend/frame/base/Packaging.html" class="sidebar-link">打包工具</a></li><li><a href="/Front-end-go-on/pages/frontend/frame/base/Ts.html" class="sidebar-link">TS基础</a></li><li><a href="/Front-end-go-on/pages/frontend/frame/base/Nuxt.html" class="sidebar-link">Nuxt基础</a></li><li><a href="/Front-end-go-on/pages/frontend/frame/base/Applet.html" class="sidebar-link">小程序基础</a></li><li><a href="/Front-end-go-on/pages/frontend/frame/base/MicroFrontend.html" class="sidebar-link">微前端基础</a></li><li><a href="/Front-end-go-on/pages/frontend/frame/base/UniApp.html" class="sidebar-link">uni-app基础</a></li><li><a href="/Front-end-go-on/pages/frontend/frame/base/Business.html" class="sidebar-link">业务相关</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端代码练习</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Front-end-go-on/pages/frontend/exercise/Css.html" class="sidebar-link">CSS代码练习</a></li><li><a href="/Front-end-go-on/pages/frontend/exercise/Js.html" class="sidebar-link">JS代码练习</a></li><li><a href="/Front-end-go-on/pages/frontend/exercise/Algorithm.html" class="sidebar-link">算法代码练习</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端代码技巧</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Front-end-go-on/pages/frontend/skill/Tools.html" class="sidebar-link">工具库</a></li><li><a href="/Front-end-go-on/pages/frontend/skill/Utils.html" class="sidebar-link">工具函数</a></li><li><a href="/Front-end-go-on/pages/frontend/skill/CSSAnimation.html" class="sidebar-link">CSS动画库</a></li><li><a href="/Front-end-go-on/pages/frontend/skill/Css.html" class="sidebar-link">CSS代码技巧</a></li><li><a href="/Front-end-go-on/pages/frontend/skill/Js.html" class="sidebar-link">JS代码技巧</a></li><li><a href="/Front-end-go-on/pages/frontend/skill/Project.html" class="sidebar-link">项目技巧</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="_1-vue2-生命周期"><a href="#_1-vue2-生命周期" class="header-anchor">#</a> 1.Vue2 生命周期</h2> <p>Vue2 的生命周期可以分为 <strong>4 个主要阶段</strong>，包含 <strong>8 个核心钩子函数</strong></p> <img src="/Front-end-go-on/assets/img/vue2_lifecircle.ddd606dc.png"> <p><code>$el</code> 是 Vue 实例的一个​​内置属性​​，表示 Vue 实例所管理的<strong>根 DOM 节点</strong>。它是 Vue 实例与真实 DOM 之间的桥梁。</p> <h3 id="生命周期阶段概览"><a href="#生命周期阶段概览" class="header-anchor">#</a> 生命周期阶段概览</h3> <ul><li>分为 ​​4 个阶段​​：
<ul><li>​<strong>创建阶段​</strong>​​：实例刚被创建，组件属性计算之前。</li> <li>​<strong>​挂载阶段​</strong>​​：</li> <li>​<strong>更新阶段​</strong>​​：</li> <li>​<strong>销毁阶段​</strong>​​：</li></ul></li></ul> <h3 id="一、创建阶段-initialization"><a href="#一、创建阶段-initialization" class="header-anchor">#</a> 一、创建阶段 (Initialization)</h3> <h4 id="_1-beforecreate"><a href="#_1-beforecreate" class="header-anchor">#</a> 1. beforeCreate</h4> <ul><li>​触发时机​​：实例刚被创建，组件属性计算之前</li> <li>​​特点​​：
<ul><li>无法访问 data、methods、computed 等选项</li> <li>常用于开发中的初始化逻辑，如设置页面标题 <code>window.document.title</code></li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">beforeCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'beforeCreate:'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'beforeCreate:'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>methodName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_2-created"><a href="#_2-created" class="header-anchor">#</a> 2. created</h4> <ul><li>​触发时机​​：实例创建完成，属性已绑定</li> <li>​特点​​：
<ul><li>可以访问 <code>data</code>、<code>methods</code>、<code>computed</code></li> <li>尚未挂载到 DOM，<code>$el</code> 不可用</li> <li>常用于异步数据请求(不涉及dom)</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'created:'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可访问</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'created:'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>methodName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可访问</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'created:'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$el<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 常见的数据请求时机</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="二-挂载阶段-dom-mounting"><a href="#二-挂载阶段-dom-mounting" class="header-anchor">#</a> 二. 挂载阶段 (DOM Mounting)</h3> <h4 id="_3-beforemount"><a href="#_3-beforemount" class="header-anchor">#</a> 3. beforeMount</h4> <ul><li>​触发时机​​：模板编译完成，首次渲染前</li> <li>特点​​：
<ul><li><code>$el</code> 已存在但内容尚未渲染</li> <li>服务端渲染时不调用</li></ul></li></ul> <h4 id="_4-mounted"><a href="#_4-mounted" class="header-anchor">#</a> 4. mounted</h4> <ul><li>​触发时机​​：实例被挂载到 DOM 后</li> <li>​特点​​：
<ul><li>DOM 完全渲染完成</li> <li>常用于操作 DOM 或初始化第三方库</li> <li>注意：不保证所有子组件都已挂载</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'mounted:'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$el<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 完全渲染的DOM</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initChart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 初始化ECharts等库</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="三-更新阶段-data-updates"><a href="#三-更新阶段-data-updates" class="header-anchor">#</a> 三. 更新阶段 (Data Updates)</h3> <h4 id="_5-beforeupdate"><a href="#_5-beforeupdate" class="header-anchor">#</a> 5. beforeUpdate</h4> <ul><li>触发时机​​：数据变化导致重新渲染前</li> <li>​​特点​​：
<ul><li>可以获取更新前的 DOM 状态</li> <li>适合保存更新前的滚动位置等</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">beforeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>scrollTop <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>list<span class="token punctuation">.</span>scrollTop<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_6-updated"><a href="#_6-updated" class="header-anchor">#</a> 6. updated</h4> <ul><li>​触发时机​​：虚拟 DOM 重新渲染和打补丁后</li> <li>​​特点​​：
<ul><li>DOM 已更新完成</li> <li>避免在此修改状态，可能导致无限循环</li> <li>注意：不保证所有子组件都已重绘</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">updated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>list<span class="token punctuation">.</span>scrollTop <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>scrollTop<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="四-销毁阶段-destruction"><a href="#四-销毁阶段-destruction" class="header-anchor">#</a> 四. 销毁阶段 (Destruction)</h3> <h4 id="_7-beforedestroy"><a href="#_7-beforedestroy" class="header-anchor">#</a> 7. beforeDestroy</h4> <ul><li>​​触发时机​​：实例销毁之前</li> <li>特点​​：
<ul><li>实例仍然完全可用</li> <li>必须在此清理定时器、事件监听等</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">beforeDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleResize<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_8-destroyed"><a href="#_8-destroyed" class="header-anchor">#</a> 8. destroyed</h4> <ul><li>​触发时机​​：实例销毁后</li> <li>​​特点​​：
<ul><li>所有指令已解绑</li> <li>所有子实例已销毁</li> <li>常用于清理全局状态</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">destroyed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'destroyed:'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$el<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'destroyed:'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="五-特殊场景生命周期"><a href="#五-特殊场景生命周期" class="header-anchor">#</a> 五. 特殊场景生命周期</h3> <p>keep-alive 组件特有钩子</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">activated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 被 keep-alive 缓存的组件激活时调用</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">startPolling</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function">deactivated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 被 keep-alive 缓存的组件停用时调用</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">stopPolling</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="_2-父子组件生命周期钩子执行顺序"><a href="#_2-父子组件生命周期钩子执行顺序" class="header-anchor">#</a> 2.父子组件⽣命周期钩⼦执⾏顺序</h2> <img src="/Front-end-go-on/assets/img/vue2_pc_lifecircle.6d782a9a.png" style="height:900px;"> <h3 id="特殊场景处理-keep-alive-组件中的销毁"><a href="#特殊场景处理-keep-alive-组件中的销毁" class="header-anchor">#</a> 特殊场景处理 keep-alive 组件中的销毁</h3> <img src="/Front-end-go-on/assets/img/vue2_pc_kl_lifecircle.d6eddc29.png" style="height:400px;"> <h3 id="注意事项"><a href="#注意事项" class="header-anchor">#</a> 注意事项</h3> <h4 id="_1-子组件总是在父组件destroyed之前完成销毁"><a href="#_1-子组件总是在父组件destroyed之前完成销毁" class="header-anchor">#</a> 1. 子组件总是在父组件destroyed之前完成销毁</h4> <h4 id="_2-销毁顺序由vue内部管理-开发者无法改变"><a href="#_2-销毁顺序由vue内部管理-开发者无法改变" class="header-anchor">#</a> 2. 销毁顺序由Vue内部管理，开发者无法改变</h4> <h2 id="_3-v-model是如何实现双向绑定的"><a href="#_3-v-model是如何实现双向绑定的" class="header-anchor">#</a> 3.v-model是如何实现双向绑定的</h2> <h3 id="vue-2-0"><a href="#vue-2-0" class="header-anchor">#</a> vue 2.0</h3> <p><code>v-model</code>是⽤来在表单控件或者组件上创建双向绑定的，他的本质是 <code>v-bind</code> 和 <code>v-on</code> 的语法糖，在
⼀个组件上使⽤ <code>v-model</code> ，默认会为组件绑定名为 <code>value</code> 的 <code>prop</code> 和名为 <code>input</code> 的事件。</p> <p><code>v-model</code>并不是真正的&quot;双向数据流&quot;，而是​​单向数据流 + 自动事件监听​​的语法糖。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- 使用v-model --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>message<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 等价于 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> 
  <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>message<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">@input</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>message = $event.target.value<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>Vue 模板编译器会将 <code>v-model</code> 转换为对应的属性和事件：</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 编译前</span>
<span class="token keyword">const</span> ast <span class="token operator">=</span> <span class="token function">parse</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;input v-model=&quot;message&quot;&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

<span class="token comment">// 编译后</span>
<span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token function">generate</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">directives</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">model</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">dir<span class="token punctuation">,</span> node</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 根据不同元素类型生成不同代码</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">'input'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">{
          value: (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dir<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">),
          onInput: $event =&gt; { </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dir<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> = $event.target.value }
        }</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 其他元素处理...</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="vue3-0"><a href="#vue3-0" class="header-anchor">#</a> Vue3.0</h3> <ul><li>Vue3 对 <code>v-model</code> 进行了重大改进，使其更加灵活和强大</li></ul> <table><thead><tr><th>特性</th> <th>Vue2</th> <th>Vue3</th></tr></thead> <tbody><tr><td>默认prop/event</td> <td>value/input</td> <td>modelValue/update:modelValue</td></tr> <tr><td>多v-model支持</td> <td>不支持(其实是支持，一般不推荐)</td> <td>支持多个v-model绑定</td></tr> <tr><td>修饰符处理</td> <td>有限支持(.trim等)</td> <td>可自定义修饰符处理逻辑</td></tr></tbody></table> <ul><li>Vue3 的编译器会将 v-model 转换为标准的 <code>props</code> 和 <code>emits</code>：</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 编译前</span>
<span class="token operator">&lt;</span>MyComponent v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">&quot;title&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>

<span class="token comment">// 编译后</span>
<span class="token function">h</span><span class="token punctuation">(</span>MyComponent<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">modelValue</span><span class="token operator">:</span> title<span class="token punctuation">,</span>
  <span class="token string-property property">'onUpdate:modelValue'</span><span class="token operator">:</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>title <span class="token operator">=</span> value<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li>Vue3 的 props 是只读的，必须通过 emit 更新：</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 错误！Vue3中直接修改props会警告</span>
props<span class="token punctuation">.</span>modelValue <span class="token operator">=</span> newValue 

<span class="token comment">// 正确方式</span>
<span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'update:modelValue'</span><span class="token punctuation">,</span> newValue<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="_4-vue-非父子通信方式"><a href="#_4-vue-非父子通信方式" class="header-anchor">#</a> 4.Vue 非父子通信方式</h2> <h3 id="_1、eventbus-实例化一个空vue作为事件中心管理"><a href="#_1、eventbus-实例化一个空vue作为事件中心管理" class="header-anchor">#</a> 1、EventBus (实例化一个空Vue作为事件中心管理)</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// bus.js</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> Bus <span class="token keyword">from</span> <span class="token string">'bus'</span>

<span class="token comment">// 监听事件</span>
Bus<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'updateData'</span><span class="token punctuation">,</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 触发事件</span>
Bus<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'updateData'</span><span class="token punctuation">,</span> <span class="token punctuation">)</span>

<span class="token comment">// 注销事件</span>
Bus<span class="token punctuation">.</span><span class="token function">$off</span><span class="token punctuation">(</span><span class="token string">'updateData'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_2、-attrs-listeners-跨级通信"><a href="#_2、-attrs-listeners-跨级通信" class="header-anchor">#</a> 2、$attrs/$listeners(跨级通信)</h3> <p>Vue2.4 提供适用于多层嵌套组件通信的方法</p> <p>$attrs：包含了父作用域中不被 prop 所识别 (且获取) 的特性绑定 (class 和 style 除外)。当一个组件没有声明任何 prop 时，这里会包含所有父作用域的绑定 (class 和 style 除外)，并且可以通过 v-bind=&quot;$attrs&quot; 传入内部组件。通常配合 interitAttrs 选项一起使用。</p> <p>$listeners：包含了父作用域中的 (不含 .native 修饰器的) v-on 事件监听器。它可以通过 v-on=&quot;$listeners&quot; 传入内部组件</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- 中间组件 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>child-component</span> <span class="token attr-name">v-bind</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$attrs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-on</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$listeners<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>child-component</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 祖先组件 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>middle-component</span> <span class="token attr-name">:message</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>msg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@custom-event</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleEvent<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_3、observable"><a href="#_3、observable" class="header-anchor">#</a> 3、Observable</h3> <p><code>Vue.observable</code> 是 Vue2.6 新增的全局 API，用于​​创建响应式对象​​，可以替代部分 Vuex 的小型状态管理需求。</p> <h4 id="与-vuex-的区别"><a href="#与-vuex-的区别" class="header-anchor">#</a> 与 Vuex 的区别</h4> <table><thead><tr><th>特性</th> <th>Vue.observable</th> <th>Vuex</th></tr></thead> <tbody><tr><td>​​复杂度​</td> <td>轻量级</td> <td>功能完整</td></tr> <tr><td>​​适用场景​</td> <td>简单状态共享</td> <td>中大型应用</td></tr> <tr><td>​调试工具​</td> <td>不支持</td> <td>支持DevTools</td></tr> <tr><td>​​响应式原理​</td> <td>与组件data相同</td> <td>专门的状态管理机制</td></tr></tbody></table> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 创建 store</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token comment">// 通过Vue.observable创建一个可响应的对象</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> store <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">observable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">userInfo</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">roleIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 定义 mutations, 修改属性</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> mutations <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">setUserInfo</span><span class="token punctuation">(</span><span class="token parameter">userInfo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    store<span class="token punctuation">.</span>userInfo <span class="token operator">=</span> userInfo
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setRoleIds</span><span class="token punctuation">(</span><span class="token parameter">roleIds</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    store<span class="token punctuation">.</span>roleIds <span class="token operator">=</span> roleIds
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><div class="language-vue line-numbers-mode"><pre class="language-vue"><code>// 在组件中引用
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    {{ userInfo.name }}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> store<span class="token punctuation">,</span> mutations <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../store'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">userInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> store<span class="token punctuation">.</span>userInfo
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    mutations<span class="token punctuation">.</span><span class="token function">setUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'子君'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="_4、provide-inject"><a href="#_4、provide-inject" class="header-anchor">#</a> 4、provide/inject</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 祖先组件</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">provide</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">sharedData</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sharedState
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">sharedState</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'Hello'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 后代组件</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">inject</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'sharedData'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sharedData<span class="token punctuation">.</span>message<span class="token punctuation">)</span> <span class="token comment">// 'Hello'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><ul><li>缺点
<ul><li>单向数据流​​：祖先组件不知道哪些后代组件使用它</li> <li>​响应式问题​​：直接提供基本类型值不是响应式的</li></ul></li></ul> <h3 id="_5、全局挂载"><a href="#_5、全局挂载" class="header-anchor">#</a> 5、全局挂载</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// main.js</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span>
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$globalData <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">sharedValue</span><span class="token operator">:</span> <span class="token string">'Global data'</span>
<span class="token punctuation">}</span>
<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
<span class="token comment">// 任意组件中访问</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$globalData<span class="token punctuation">.</span>sharedValue
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_6、vuex"><a href="#_6、vuex" class="header-anchor">#</a> 6、Vuex</h3> <p>Vuex 是一个专为 Vue.js 应用程序开发的状态管理模式。</p> <img src="/Front-end-go-on/assets/img/vuex.4d005616.png"> <ul><li>数据流规则
<ul><li>​单向数据流​​：<code>View</code> → <code>Actions</code> → <code>Mutations</code> → <code>State</code> → <code>View</code></li> <li>同步修改​​：只有<code>mutations</code> 能直接修改 <code>state</code></li> <li>异步操作​​：在 <code>actions</code> 中处理异步逻辑</li></ul></li></ul> <p>简单来说，这个 store 就是用来存储数据<br>
存储数据方式有很多种，比如变量、数组、cookie、localstorage、session 等等<br>
但是由于 store 是内存机制，而不是缓存机制，当前页面一旦刷新或者通过路由跳转亦或是关闭，都会导致 store 初始化<br>
因此在之前就暂时把 store 看成一个多功能的全局变量</p> <p>而 Vuex 和单纯的全局对象又有点不同<br>
 1、Vuex 的状态存储是响应式的。当 Vue 组件从 store 中读取状态的时候，若 store 中的状态发生变化，那么相应的组件也会相应地得到高效更新。<br>
 2、不能直接改变 store 中的状态。改变 store 中的状态的唯一途径就是显式地提交 (commit) mutation。这样可以方便地跟踪每一个状态的变化。</p> <h4 id="state-单一状态树"><a href="#state-单一状态树" class="header-anchor">#</a> State：(单一状态树)</h4> <p>1、State 就是数据源存放地<br>
2、State 里面存放的数据是响应式的，Vue 组件从 store 中读取数据，若是 store 中的数据发生改变，依赖这个数据的组件也会发生更新</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 定义</span>
<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">''</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 组件访问</span>
<span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token comment">// 方式1：直接访问</span>
  <span class="token function">username</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 方式2：mapState辅助函数</span>
  <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function-variable function">theme</span><span class="token operator">:</span> <span class="token parameter">state</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>settings<span class="token punctuation">.</span>theme
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="getter-派生状态"><a href="#getter-派生状态" class="header-anchor">#</a> Getter：(派生状态)</h4> <p>1、getters 可以对 State 进行计算操作，它就是 Store 的计算属性<br>
2、虽然在组件内也可以做计算属性，但是 getters 可以在多组件之间复用<br>
3、如果一个状态只在一个组件内使用，是可以不用 getters</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 定义</span>
<span class="token keyword">const</span> getters <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 带参数的计算属性</span>
  <span class="token function-variable function">getUserById</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> state<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">user</span> <span class="token operator">=&gt;</span> user<span class="token punctuation">.</span>id <span class="token operator">===</span> id<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 组合多个getter</span>
  <span class="token function-variable function">userProfile</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> getters</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>state<span class="token punctuation">.</span>user<span class="token punctuation">,</span>
      <span class="token literal-property property">preferences</span><span class="token operator">:</span> getters<span class="token punctuation">.</span>userPreferences
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 组件使用</span>
<span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'currentUser'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// 带参数的getter</span>
  <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span><span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>userId<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="mutation-同步事务"><a href="#mutation-同步事务" class="header-anchor">#</a> Mutation：(同步事务)</h4> <p>更改 Vuex 的 store 中的状态的唯一方法是提交 mutation。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// mutation-types.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">SET_USER</span> <span class="token operator">=</span> <span class="token string">'SET_USER'</span>
<span class="token comment">// store.js</span>
<span class="token literal-property property">mutations</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span><span class="token constant">SET_USER</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">.</span>user <span class="token operator">=</span> payload
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 组件调用</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token constant">SET_USER</span><span class="token punctuation">,</span> userData<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="action-类似于-mutation-不同在于"><a href="#action-类似于-mutation-不同在于" class="header-anchor">#</a> Action 类似于 mutation，不同在于：</h4> <p>Action 提交的是 mutation，而不是直接变更状态。
Action 可以包含任意异步操作。</p> <h4 id="moudle"><a href="#moudle" class="header-anchor">#</a> Moudle</h4> <p>每个 state 对应一个 moudle</p> <h2 id="_5-vue-router"><a href="#_5-vue-router" class="header-anchor">#</a> 5.Vue-router</h2> <p>Vue是单页应用（SPA），只有一个html文件，而vue-router就是vue进行页面替换和更新的组件。<br>
由<code>route</code>, <code>routes</code>, <code>router</code>组成。</p> <h3 id="_1、路由之间跳转"><a href="#_1、路由之间跳转" class="header-anchor">#</a> 1、路由之间跳转：</h3> <ul><li>声明式（标签跳转）</li> <li>编程式（js 跳转）</li></ul> <h3 id="_2、原理以及路由模式"><a href="#_2、原理以及路由模式" class="header-anchor">#</a> 2、原理以及路由模式：</h3> <p>更新视图但不重新请求页面，是前端路由原理的核心之一，目前在浏览器环境中这一功能的实现主要有 3 种方式</p> <table><thead><tr><th>模式</th> <th>原理</th> <th>特点</th> <th>使用场景</th></tr></thead> <tbody><tr><td>​​hash模式​</td> <td>使用 URL hash (#)</td> <td>兼容性好，无需服务器配置</td> <td>传统Web应用</td></tr> <tr><td>​​history模式​​</td> <td>利用 HTML5 History API</td> <td>URL更简洁，需要服务端支持</td> <td>现代Web应用，SEO友好</td></tr> <tr><td>​​abstract模式​</td> <td>基于内存的路由</td> <td>无URL变化，适合非浏览器环境</td> <td>移动端原生应用，测试环境</td></tr></tbody></table> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'history'</span><span class="token punctuation">,</span> <span class="token comment">// 可选: 'hash' | 'history' | 'abstract'</span>
  <span class="token literal-property property">routes</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>● hash: 使用 URL hash 值来作路由。默认模式。<br>
● history: 依赖 HTML5 History API 和服务器配置。查看 HTML5 History 模式。<br>
● abstract: 支持所有 JavaScript 运行环境，如 Node.js 服务器端</p> <h4 id="hash模式"><a href="#hash模式" class="header-anchor">#</a> Hash模式</h4> <p>hash模式的工作原理是 <code>hashchange</code> 事件，可以在window监听hash的变化。我们在url后面随便添加一个#xx触发这个事件。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function-variable function">onhashchange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>hash即浏览器url中#后面的内容，包含#。hash是URL中的锚点，代表的是网页中的一个位置，单单改变#后的部分，浏览器只会加载相应位置的内容，不会重新加载页面。</p> <ul><li>即#是用来指导浏览器动作的，对服务器端完全无用，HTTP请求中，不包含#。</li> <li>每一次改变#后的部分，都会在浏览器的访问历史中增加一个记录，使用”后退”按钮，就可以回到上一个位置。</li> <li>所以说Hash模式通过锚点值的改变，根据不同的值，渲染指定DOM位置的不同数据。</li></ul> <h4 id="history模式"><a href="#history模式" class="header-anchor">#</a> History模式</h4> <p>HTML5 History API提供了一种功能，能让开发人员在不刷新整个页面的情况下修改站点的URL，就是利用 <code>history.pushState</code>和<code>history.replaceState</code> API 来完成 URL 跳转而无须重新加载页面；</p> <p>由于hash模式会在url中自带#，如果不想要很丑的 hash，我们可以用路由的 history 模式，只需要在配置路由规则时，加入<code>&quot;mode: 'history'&quot;</code>，这种模式充分利用 <code>history.pushState</code> API 来完成 URL 跳转而无须重新加载页面。</p> <p><strong>有时，history模式下也会出问题：</strong></p> <ul><li>hash模式下：xxx.com/#/id=5 请求地址为 xxx.com,没有问题。</li> <li>history模式下：xxx.com/id=5 请求地址为 xxx.com/id=5，如果后端没有对应的路由处理，就会返回404错误；</li></ul> <p>为了应对这种情况，需要后台配置支持：<br>
在服务端增加一个覆盖所有情况的候选资源：如果 URL 匹配不到任何静态资源，则应该返回同一个 index.html 页面，这个页面就是你 app 依赖的页面。</p> <h3 id="_3、vue-router传参的三种方式"><a href="#_3、vue-router传参的三种方式" class="header-anchor">#</a> 3、vue router传参的三种方式</h3> <ul><li>1、params传参</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'news'</span><span class="token punctuation">,</span> <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>此时浏览器url上是看不到任何参数的，像这样<code>http://localhost:9530/news</code></p> <p>对于像<code>path: '/detail/:id'</code>这样的携带参数的动态路由，传参时也应当使用params，动态路由传参是可以再url上看到的，像这样<code>http://localhost:9530/detail/121</code></p> <ul><li>2、query传参</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'news'</span><span class="token punctuation">,</span> <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token number">1</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>此时浏览器url上是可以看得到参数的，像这样<code>http://localhost:9530/news/?type=1</code>
通过query传的参数在页面刷新时不会丢失。</p> <ul><li>3、props传参</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'news'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/news'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/news'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'新闻详情'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>通过props的方式传参时，在组件内的取值方式也是通过props，像父子组件传值那样</p> <h3 id="_4、动态路由"><a href="#_4、动态路由" class="header-anchor">#</a> 4、动态路由</h3> <p>Vue 动态路由,就是基于 <code>router.addRoutes</code> | <code>router.addRoute</code> 这个 api 的一个功能实现</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 动态路由匹配</span>
<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token comment">// 动态参数以冒号开头</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/user/:id'</span><span class="token punctuation">,</span> <span class="token literal-property property">component</span><span class="token operator">:</span> User <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 可选参数</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/user/:id?'</span><span class="token punctuation">,</span> <span class="token literal-property property">component</span><span class="token operator">:</span> User <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 多段动态参数</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/user/:id/post/:postId'</span><span class="token punctuation">,</span> <span class="token literal-property property">component</span><span class="token operator">:</span> Post <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 高级匹配规则</span>
<span class="token punctuation">{</span>
  <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/user/:id(\\d+)'</span><span class="token punctuation">,</span> <span class="token comment">// 只匹配数字ID</span>
  <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/files/:path*'</span><span class="token punctuation">,</span>    <span class="token comment">// 匹配零个或多个路径段</span>
  <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/docs/:chapter?'</span>  <span class="token comment">// 可选参数</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_5、vue-router-路由守卫"><a href="#_5、vue-router-路由守卫" class="header-anchor">#</a> 5、vue-router 路由守卫</h3> <p>第一种：全局前置守卫 (beforeEach)
第二种：路由独享守卫 (beforeEnter)
第三种：组件内守卫</p> <img src="/Front-end-go-on/assets/img/guard.b5f493ca.png"> <h4 id="_1-全局前置守卫"><a href="#_1-全局前置守卫" class="header-anchor">#</a> 1. 全局前置守卫</h4> <p>典型应用：权限控制</p> <ul><li>业务场景：
<ul><li>登录状态验证</li> <li>权限路由过滤</li> <li>维护模式拦截</li> <li>多租户路由处理</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1. 免登录白名单</span>
  <span class="token keyword">const</span> whiteList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token string">'/register'</span><span class="token punctuation">]</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>whiteList<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// 2. 检查登录状态</span>
  <span class="token keyword">const</span> isAuthenticated <span class="token operator">=</span> <span class="token function">checkAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// 3. 需要登录但未登录</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>requiresAuth <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isAuthenticated<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">redirect</span><span class="token operator">:</span> to<span class="token punctuation">.</span>fullPath <span class="token punctuation">}</span> <span class="token comment">// 记录目标路由</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 4. 已登录但访问登录页</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>path <span class="token operator">===</span> <span class="token string">'/login'</span> <span class="token operator">&amp;&amp;</span> isAuthenticated<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'/dashboard'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h4 id="_2-路由独享守卫-beforeenter"><a href="#_2-路由独享守卫-beforeenter" class="header-anchor">#</a> 2. 路由独享守卫 (beforeEnter)</h4> <p>典型应用：路由级权限</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/admin'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">component</span><span class="token operator">:</span> AdminPanel<span class="token punctuation">,</span>
    <span class="token function-variable function">beforeEnter</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 检查管理员权限</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>isAdmin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'/403'</span><span class="token punctuation">)</span> <span class="token comment">// 无权限跳转</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">requiresAuth</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ul><li>业务场景：
<ul><li>特定路由的权限控制</li> <li>路由参数验证</li> <li>动态路由预检查</li></ul></li></ul> <h4 id="_3-组件内守卫"><a href="#_3-组件内守卫" class="header-anchor">#</a> 3. 组件内守卫</h4> <p>(1) beforeRouteEnter - 进入组件前</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">beforeRouteEnter</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 无法访问this，但可通过回调访问</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token parameter">vm</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 通过vm访问组件实例</span>
      vm<span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>(2) beforeRouteLeave - 离开组件前</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">formChanged</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">beforeRouteLeave</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>formChanged<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">'有未保存的更改，确定离开?'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token comment">// 取消导航</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><ul><li>业务场景：
<ul><li>表单未保存提示</li> <li>数据预加载</li> <li>滚动位置保存</li> <li>组件特定权限检查</li></ul></li></ul> <h3 id="_6、-route-和-router-的区别"><a href="#_6、-route-和-router-的区别" class="header-anchor">#</a> 6、$route 和$router 的区别</h3> <ul><li><code>$router</code> 为 VueRouter 的实例，相当于一个全局的路由对象，里面含有很多属性和子对象，例如 history 对象</li> <li><code>$route</code> 相当于当前路由对象，属于局部对象，以从里面获取 name,path,params,query 等</li></ul> <table><thead><tr><th>特性</th> <th>$route</th> <th>$router</th></tr></thead> <tbody><tr><td>类型​</td> <td>当前路由信息对象（只读）</td> <td>路由实例（可操作路由的方法集合）</td></tr> <tr><td>​数据性质​</td> <td>反映当前路由状态（响应式）</td> <td>提供路由操作方法</td></tr> <tr><td>​​主要用途​</td> <td>获取路由参数、查询参数等</td> <td>编程式导航、路由控制</td></tr> <tr><td>修改方式​</td> <td>不可直接修改</td> <td>通过方法修改路由</td></tr> <tr><td>​​访问方式​</td> <td>this.$route</td> <td>this.$router</td></tr></tbody></table> <h3 id="_7、vue路由懒加载3种方式"><a href="#_7、vue路由懒加载3种方式" class="header-anchor">#</a> 7、Vue路由懒加载3种方式</h3> <ul><li>Vue异步组件</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function-variable function">component</span><span class="token operator">:</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'@/components/Foo'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>resolve<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>ES6的import()</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">Foo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'../components/Foo'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>webpack的require.ensure()</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function-variable function">component</span><span class="token operator">:</span><span class="token parameter">r</span><span class="token operator">=&gt;</span>
    require<span class="token punctuation">.</span><span class="token function">ensure</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token function">r</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@/components/home'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'funcDemo'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="常见问题及解决方案"><a href="#常见问题及解决方案" class="header-anchor">#</a> 常见问题及解决方案</h3> <h4 id="_1-动态路由权限控制"><a href="#_1-动态路由权限控制" class="header-anchor">#</a> 1. 动态路由权限控制</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 初始化基础路由</span>
<span class="token keyword">const</span> constRoutes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token literal-property property">component</span><span class="token operator">:</span> Login <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/404'</span><span class="token punctuation">,</span> <span class="token literal-property property">component</span><span class="token operator">:</span> NotFound <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

<span class="token comment">// 动态添加路由</span>
<span class="token keyword">function</span> <span class="token function">addRoutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> accessRoutes <span class="token operator">=</span> <span class="token function">generateRoutes</span><span class="token punctuation">(</span>userRole<span class="token punctuation">)</span>
  router<span class="token punctuation">.</span><span class="token function">addRoutes</span><span class="token punctuation">(</span>accessRoutes<span class="token punctuation">)</span>
  router<span class="token punctuation">.</span><span class="token function">addRoutes</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'*'</span><span class="token punctuation">,</span> <span class="token literal-property property">redirect</span><span class="token operator">:</span> <span class="token string">'/404'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="_2-页面切换动画"><a href="#_2-页面切换动画" class="header-anchor">#</a> 2. 页面切换动画</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>transition name<span class="token operator">=</span><span class="token string">&quot;fade&quot;</span> mode<span class="token operator">=</span><span class="token string">&quot;out-in&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>router<span class="token operator">-</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>router<span class="token operator">-</span>view<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>transition<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
<span class="token punctuation">.</span>fade<span class="token operator">-</span>enter<span class="token operator">-</span>active<span class="token punctuation">,</span> <span class="token punctuation">.</span>fade<span class="token operator">-</span>leave<span class="token operator">-</span>active <span class="token punctuation">{</span>
  <span class="token literal-property property">transition</span><span class="token operator">:</span> opacity <span class="token number">0</span><span class="token punctuation">.</span>3s<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">.</span>fade<span class="token operator">-</span>enter<span class="token punctuation">,</span> <span class="token punctuation">.</span>fade<span class="token operator">-</span>leave<span class="token operator">-</span>to <span class="token punctuation">{</span>
  <span class="token literal-property property">opacity</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="_6-diff算法和虚拟dom"><a href="#_6-diff算法和虚拟dom" class="header-anchor">#</a> 6.diff算法和虚拟dom</h2> <h3 id="_6-1、虚拟-dom"><a href="#_6-1、虚拟-dom" class="header-anchor">#</a> 6-1、虚拟 DOM</h3> <p>要理解 Diff 算法，就得先理解好虚拟 DOM。<br>
虚拟 DOM（Virtual DOM）是一种​​内存中的轻量级数据表示​​，它是对真实 DOM 的抽象描述。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 真实 DOM 和 虚拟 DOM 是可以相互转化</span>
<span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;container&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;p-container&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Real <span class="token constant">DOM</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

<span class="token keyword">const</span> VirtualDOM <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">'container'</span><span class="token punctuation">,</span>
    <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">'p-container'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token string">'h1'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'Real DOM'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="虚拟-dom-工作流程"><a href="#虚拟-dom-工作流程" class="header-anchor">#</a> 虚拟 DOM 工作流程</h4> <img src="/Front-end-go-on/assets/img/vdom.e5b5b21d.png" style="height:400px;"> <h3 id="_6-2、为什么要有虚拟dom"><a href="#_6-2、为什么要有虚拟dom" class="header-anchor">#</a> 6-2、为什么要有虚拟DOM</h3> <ul><li>虚拟 DOM 的优势
<ul><li>​性能优化​​：减少直接操作真实 DOM 的昂贵开销</li> <li>​跨平台能力​​：可以在非浏览器环境渲染（如 SSR、Weex）</li> <li>​声明式编程​​：开发者只需关心数据，不用手动操作 DOM</li></ul></li></ul> <p>1、跨平台渲染。借助虚拟 DOM 后 FrontEnd 可以进行移动端、小程序等开发。因为虚拟 DOM 本身只是一个 JavaScript 对象，所以可以先由 FE 们写 UI 并抽象成一个虚拟 DOM，再由安卓、IOS、小程序等原生实现根据虚拟 DOM 去渲染页面（React Native、Weex）。<br>
2、函数式的 UI 编程。将 UI 抽象成对象的形式，相当于可以以编写 JavaScript 的形式来写 UI。<br>
3、网上 Blog 常常会说到虚拟 DOM 会有更好的性说能，因为虚拟 DOM 只会在 Diff 后修改一次真实 DOM，所以不会有大量的重排重绘消耗。并且只更新有变动的部分节点，而非更新整个视图。但我对这句话是存疑的，通过下文的 Diff 算法源码可以发现，Vue2 它的 Diff 是每次比对到匹配到的节点后就去修改真实 DOM 的，并不是等所有 Diff 完后再修改一次真实 DOM 而已。</p> <h3 id="_6-3、什么是-diff-算法"><a href="#_6-3、什么是-diff-算法" class="header-anchor">#</a> 6-3、什么是 Diff 算法</h3> <p>Diff算法，全称为Difference算法，通过比较两个对象（如两个文本文件、两个虚拟DOM树等）来找出它们之间的差异，并根据这些差异生成一个补丁文件或差异描述，以便能够将这些差异应用到另一个对象上。</p> <h3 id="_6-4、vue2-中-diff-原理"><a href="#_6-4、vue2-中-diff-原理" class="header-anchor">#</a> 6-4、Vue2 中 Diff 原理</h3> <p>当对新旧两个虚拟 DOM 做 Diff 时，Vue 采用的思想是<strong>同级比较</strong>、<strong>深度优先</strong>、<strong>双端遍历</strong>。</p> <h4 id="_5-4-1、同级比较"><a href="#_5-4-1、同级比较" class="header-anchor">#</a> 5-4-1、同级比较：</h4> <p>同级比较指的是只比对两个相同层级的 VNode，如果两者不一样了，就不再去 Diff 它们的子节点，更不会去跨层级比较，而是直接更新它。<br>
这是因为在我们平时的操作，很少出现将一个 DOM 节点进行跨层级移动，比如将原来的父节点移动到它子节点的位置上。<br>
所以 Diff 算法就没有为这个极少数的情况专门去跨层级 Diff，毕竟为此得不偿失，这也是 Diff 算法时间复杂度能从 O(n^3) 优化到 O(n) 的原因之一。</p> <img src="data:image/png;base64,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"> <h4 id="_6-4-2、深度优先"><a href="#_6-4-2、深度优先" class="header-anchor">#</a> 6-4-2、深度优先</h4> <p>先比较完一个子节点后，就去比较这个子节点的子孙节点，都递归完后再来遍历它的兄弟节点。<br>
如下图的一个 DOM 结构，节点的编号就是它们的遍历顺序。</p> <img src="/Front-end-go-on/assets/img/diff2.c53d0a0b.png"> <p>那么为什么要使用深度优先遍历，广度优先遍历不行么？<br>
深度优先遍历使用到的是栈结构，进行深度递归的时候，栈中保存的是当前节点的父元素和祖先元素，栈中存储的最大节点个数就是 DOM 树最大的层级数。<br>
而广度优先遍历使用的是队列结构，进行广度递归的时候，队列中保存的是下一层的节点，队列中存储的最大节点个数就是 DOM 树最大的层级节点数。<br>
而在通常情况下，<strong>一个 DOM 树的层级数是会少于它的层级节点数的（比如一个列表信息组件）</strong>，所以使用深度优先遍历占用的空间和消耗会更小些。</p> <h4 id="_6-4-3、双端比较"><a href="#_6-4-3、双端比较" class="header-anchor">#</a> 6-4-3、双端比较</h4> <p>双端比较指的是在 Diff 新旧子节点时，使用了四个指针分为四种比较方法</p> <p>oldStartIdx 表示旧 VNode 从左边开始 Diff 的节点，初始值为第一个子节点<br>
oldEndIdx 表示旧 VNode 从右边开始 Diff 的节点，初始值为最后一个子节点<br>
newStartIdx 表示新 VNode 从左边开始 Diff 的节点，初始值为第一个子节点<br>
newEndIdx 表示新 VNode 从右边开始 Diff 的节点，初始值为最后一个子节点</p> <h3 id="_6-5、vue的key"><a href="#_6-5、vue的key" class="header-anchor">#</a> 6-5、Vue的key</h3> <h4 id="_6-5-1、为什么要加上key"><a href="#_6-5-1、为什么要加上key" class="header-anchor">#</a> 6-5-1、为什么要加上key</h4> <p>Vue官网的解释：<br>
key 的特殊 attribute 主要用在 Vue 的虚拟 DOM 算法，在新旧 nodes 对比时辨识 VNodes。<br>
如果不使用 key，Vue 会使用一种最大限度减少动态元素并且尽可能的尝试就地修改/复用相同类型元素的算法。<br>
而使用 key 时，它会基于 key 的变化重新排列元素顺序，并且会移除 key 不存在的元素。</p> <h4 id="_6-5-2、为什么要求key唯一"><a href="#_6-5-2、为什么要求key唯一" class="header-anchor">#</a> 6-5-2、为什么要求key唯一</h4> <p>Vue的源码中有一个sameVnode的方法，这个方法放回布尔值，用来判断两个节点是否相同。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">sameVnode</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    a<span class="token punctuation">.</span>key <span class="token operator">===</span> b<span class="token punctuation">.</span>key <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
      <span class="token punctuation">(</span>
        a<span class="token punctuation">.</span>tag <span class="token operator">===</span> b<span class="token punctuation">.</span>tag <span class="token operator">&amp;&amp;</span>
        a<span class="token punctuation">.</span>isComment <span class="token operator">===</span> b<span class="token punctuation">.</span>isComment <span class="token operator">&amp;&amp;</span>
        <span class="token function">isDef</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">isDef</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        <span class="token function">sameInputType</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
      <span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>
        <span class="token function">isTrue</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>isAsyncPlaceholder<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        a<span class="token punctuation">.</span>asyncFactory <span class="token operator">===</span> b<span class="token punctuation">.</span>asyncFactory <span class="token operator">&amp;&amp;</span>
        <span class="token function">isUndef</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>asyncFactory<span class="token punctuation">.</span>error<span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="_6-5-3、为什么不建议用数组的index作为key"><a href="#_6-5-3、为什么不建议用数组的index作为key" class="header-anchor">#</a> 6-5-3、为什么不建议用数组的index作为key</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>                      
    <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">&quot;0&quot;</span><span class="token operator">&gt;</span>a<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">&quot;1&quot;</span><span class="token operator">&gt;</span>b<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>  
    <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">&quot;2&quot;</span><span class="token operator">&gt;</span>c<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>                
<span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>   
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>举个例子，上面是初始数据，然后在数据前插入一个新数据，变成如下的列表</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>            
    <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">&quot;0&quot;</span><span class="token operator">&gt;</span>xxx<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>          
    <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">&quot;0&quot;</span><span class="token operator">&gt;</span>a<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">&quot;1&quot;</span><span class="token operator">&gt;</span>b<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>  
    <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">&quot;3&quot;</span><span class="token operator">&gt;</span>c<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>                
<span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>   
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>按理说，最理想的结果是：只插入一个li标签新节点，其他都不动，确保操作DOM效率最高。</p> <p>通过Vue的源码可以看到只有在非production的情况下才会显示key重复的warn提示</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">checkDuplicateKeys</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="_7-vue-数据双向绑定"><a href="#_7-vue-数据双向绑定" class="header-anchor">#</a> 7.Vue 数据双向绑定</h2> <ul><li><a href="https://ustbhuangyi.github.io/vue-analysis/" target="_blank" rel="noopener noreferrer">参考地址 1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.kancloud.cn/hanxuming/vue-iq/728305" target="_blank" rel="noopener noreferrer">参考地址 2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="数据双向绑定"><a href="#数据双向绑定" class="header-anchor">#</a> 数据双向绑定</h3> <p>在 vue 上使用 v-model 指令执行数据的双向绑定</p> <h3 id="实现数据绑定的做法有大致如下几种"><a href="#实现数据绑定的做法有大致如下几种" class="header-anchor">#</a> 实现数据绑定的做法有大致如下几种</h3> <ul><li>发布者-订阅者模式（backbone.js）</li> <li>脏值检查（angular.js）</li> <li>数据劫持（vue.js）</li></ul> <p>vue.js 则是采用数据劫持结合发布者-订阅者模式的方式，通过 Object.defineProperty()来劫持各个属性的 setter，getter，在数据变动时发布消息给订阅者，触发相应的监听回调。</p> <h4 id="要实现-mvvm-的双向绑定-就必须要实现以下几点"><a href="#要实现-mvvm-的双向绑定-就必须要实现以下几点" class="header-anchor">#</a> 要实现 mvvm 的双向绑定，就必须要实现以下几点</h4> <p>1、实现一个数据监听器 Observer，能够对数据对象的所有属性进行监听，如有变动可拿到最新值并通知订阅者<br>
2、实现一个指令解析器 Compile，对每个元素节点的指令进行扫描和解析，根据指令模板替换数据，以及绑定相应的更新函数<br>
3、实现一个 Watcher，作为连接 Observer 和 Compile 的桥梁，能够订阅并收到每个属性变动的通知，执行指令绑定的相应回调函数，从而更新视图<br>
4、mvvm 入口函数，整合以上三者</p> <p>上述流程如图所示：</p> <img src="data:image/png;base64,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"> <h4 id="实现-compile"><a href="#实现-compile" class="header-anchor">#</a> 实现 Compile</h4> <p>compile 主要做的事情是解析模板指令，将模板中的变量替换成数据，然后初始化渲染页面视图，并将每个指令对应的节点绑定更新函数，添加监听数据的订阅者，一旦数据有变动，收到通知，更新视图，如图所示：</p> <img src="data:image/png;base64,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"> <p>因为遍历解析的过程有多次操作 dom 节点，为提高性能和效率，会先将跟节点 el 转换成文档碎片 fragment 进行解析编译操作，解析完成，再将 fragment 添加回原来的真实 dom 节点中</p> <h4 id="实现-watcher"><a href="#实现-watcher" class="header-anchor">#</a> 实现 Watcher</h4> <p>Watcher 订阅者作为 Observer 和 Compile 之间通信的桥梁，主要做的事情是:</p> <p>1、在自身实例化时往属性订阅器(dep)里面添加自己<br>
2、自身必须有一个 update()方法<br>
3、待属性变动 dep.notice()通知时，能调用自身的 update()方法，并触发 Compile 中绑定的回调，则功成身退。</p> <h4 id="实现-mvvm"><a href="#实现-mvvm" class="header-anchor">#</a> 实现 MVVM</h4> <p>MVVM 作为数据绑定的入口，整合 Observer、Compile 和 Watcher 三者，通过 Observer 来监听自己的 model 数据变化，通过 Compile 来解析编译模板指令，最终利用 Watcher 搭起 Observer 和 Compile 之间的通信桥梁，达到数据变化 -&gt; 视图更新；视图交互变化(input) -&gt; 数据 model 变更的双向绑定效果。</p> <h2 id="_8-vue-中的-computed-是如何实现"><a href="#_8-vue-中的-computed-是如何实现" class="header-anchor">#</a> 8.Vue 中的 computed 是如何实现</h2> <h3 id="一、基本实现机制"><a href="#一、基本实现机制" class="header-anchor">#</a> 一、基本实现机制</h3> <p>Vue 的 computed 属性是基于响应式系统和依赖追踪实现的，其核心是一个 <strong>​​惰性求值的缓存系统</strong>​​。</p> <h3 id="二、核心实现步骤"><a href="#二、核心实现步骤" class="header-anchor">#</a> 二、核心实现步骤</h3> <h4 id="_1-初始化阶段"><a href="#_1-初始化阶段" class="header-anchor">#</a> 1. 初始化阶段</h4> <p>当组件初始化时，Vue 会处理 <code>computed</code> 属性：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">initComputed</span><span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> computed</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> watchers <span class="token operator">=</span> vm<span class="token punctuation">.</span>_computedWatchers <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> computed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> getter <span class="token operator">=</span> <span class="token keyword">typeof</span> computed<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'function'</span> 
      <span class="token operator">?</span> computed<span class="token punctuation">[</span>key<span class="token punctuation">]</span> 
      <span class="token operator">:</span> computed<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>get<span class="token punctuation">;</span>
    
    <span class="token comment">// 为每个计算属性创建计算watcher</span>
    watchers<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span>
      vm<span class="token punctuation">,</span>
      getter<span class="token punctuation">,</span>
      noop<span class="token punctuation">,</span> <span class="token comment">// 无回调</span>
      <span class="token punctuation">{</span> <span class="token literal-property property">lazy</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span> <span class="token comment">// 标记为计算属性watcher</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 在组件实例上定义计算属性</span>
    <span class="token function">defineComputed</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> key<span class="token punctuation">,</span> userDef<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="_2-依赖收集过程"><a href="#_2-依赖收集过程" class="header-anchor">#</a> 2. 依赖收集过程</h4> <p>当计算属性首次被访问时：</p> <ol><li>​​触发 getter 函数​​：</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createComputedGetter</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">computedGetter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> watcher <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_computedWatchers<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>watcher<span class="token punctuation">.</span>dirty<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      watcher<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 重新计算值</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      watcher<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 收集依赖</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> watcher<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ol start="2"><li><p>​​执行计算函数​​：计算过程中访问的响应式数据会将此计算 watcher 收集为自己的依赖</p></li> <li><p>​​依赖关系建立​​：</p></li></ol> <img src="/Front-end-go-on/assets/img/computed.0679340c.png"> <h4 id="_3-缓存与更新机制"><a href="#_3-缓存与更新机制" class="header-anchor">#</a> 3. 缓存与更新机制</h4> <ul><li><p>​​缓存机制​​：</p> <ul><li>计算属性会缓存上一次计算的结果</li> <li>只有依赖项变化时才会重新计算</li></ul></li> <li><p>更新触发条件​​：</p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 当依赖项发生变化时</span>
<span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">watcher</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>watcher<span class="token punctuation">.</span>lazy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      watcher<span class="token punctuation">.</span>dirty <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 标记为脏数据</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      watcher<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="_9-style标签加scoped的作用以及原理"><a href="#_9-style标签加scoped的作用以及原理" class="header-anchor">#</a> 9.style标签加scoped的作用以及原理</h2> <h3 id="一、基本作用"><a href="#一、基本作用" class="header-anchor">#</a> 一、基本作用</h3> <p><code>&lt;style scoped&gt;</code> 的作用是​​实现组件级别的<strong>样式隔离封装</strong>​​，确保样式只作用于当前组件，不会影响其他组件。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>example<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.example</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="二、核心原理"><a href="#二、核心原理" class="header-anchor">#</a> 二、核心原理</h3> <p>Vue 通过 PostCSS 插件和 HTML 转换实现样式作用域隔离：</p> <h4 id="_1-html-处理"><a href="#_1-html-处理" class="header-anchor">#</a> 1. HTML 处理</h4> <p>为当前组件内的所有 DOM 元素添加一个​<strong>​唯一的数据属性</strong></p> <p>每个组件会获得一个唯一的哈希标识（如 data-v-f3f3eg9）, 哈希标识基于组件文件路径和内容计算得出</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- 转换前 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>example<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 转换后 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>example<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-v-f3f3eg9</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_2-css-处理"><a href="#_2-css-处理" class="header-anchor">#</a> 2. CSS 处理</h4> <p>将样式选择器转换为​<strong>​属性选择器​​形式</strong></p> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token comment">/* 转换前 */</span>
<span class="token selector">.example</span> <span class="token punctuation">{</span> <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token comment">/* 转换后 */</span>
<span class="token selector">.example[data-v-f3f3eg9]</span> <span class="token punctuation">{</span> <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="三、样式作用域规则"><a href="#三、样式作用域规则" class="header-anchor">#</a> 三、样式作用域规则</h3> <ul><li>仅影响当前组件模板中的元素</li> <li>不影响子组件的根元素（子组件根元素会同时拥有父组件和子组件的 <code>scoped</code> 属性）</li> <li>不影响通过 <code>v-html</code> 动态插入的内容</li></ul> <h3 id="四、深度选择器"><a href="#四、深度选择器" class="header-anchor">#</a> 四、深度选择器</h3> <p>当需要影响子组件样式时，可以使用 ::v-deep、&gt;&gt;&gt; 或 /deep/（后两者已废弃）</p> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token comment">/* 深度作用选择器 */</span>
<span class="token selector">::v-deep(.child-component)</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/* 转换后 */</span>
<span class="token selector">[data-v-f3f3eg9] .child-component</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="_10-vue-template渲染原理"><a href="#_10-vue-template渲染原理" class="header-anchor">#</a> 10.vue template渲染原理</h2> <p>Vue 的模板渲染过程是将模板(template)转换为真实 DOM 的过程</p> <h3 id="一、整体渲染流程"><a href="#一、整体渲染流程" class="header-anchor">#</a> 一、整体渲染流程</h3> <p>模板(template) → 解析(AST) → 优化 → 生成渲染函数 → 虚拟DOM → 真实DOM</p> <h3 id="二、核心处理阶段"><a href="#二、核心处理阶段" class="header-anchor">#</a> 二、核心处理阶段</h3> <h4 id="_1-模板解析阶段"><a href="#_1-模板解析阶段" class="header-anchor">#</a> 1. 模板解析阶段</h4> <p>将模板字符串转换为AST(抽象语法树)​​：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 示例模板</span>
<span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;app&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> message <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

<span class="token comment">// 转换为AST后</span>
<span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">attrsList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'app'</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token string">'p'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token literal-property property">expression</span><span class="token operator">:</span> <span class="token string">'_s(message)'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'{{ message }}'</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><ul><li>解析器工作流程​​：
<ul><li>使用正则表达式匹配标签、属性、文本等</li> <li>通过栈结构维护DOM层级关系</li> <li>生成带有节点类型、属性、子节点等信息的AST树</li></ul></li></ul> <h4 id="_2-优化阶段"><a href="#_2-优化阶段" class="header-anchor">#</a> 2. 优化阶段</h4> <p>标记静态节点​​：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 静态节点示例</span>
<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>静态内容<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>

<span class="token comment">// 优化后AST节点</span>
<span class="token punctuation">{</span>
  <span class="token keyword">static</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">staticRoot</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token comment">// ...其他属性</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>优化器会：
<ul><li>标记所有静态节点（不依赖响应式数据的节点）</li> <li>标记静态根节点（子节点全是静态的父节点）</li> <li>在后续更新中跳过这些静态节点的比对</li></ul></li></ul> <h4 id="_3-代码生成阶段"><a href="#_3-代码生成阶段" class="header-anchor">#</a> 3. 代码生成阶段</h4> <p>将AST转换为渲染函数代码​​：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 生成结果示例</span>
<span class="token keyword">with</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">attrs</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;app&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">_v</span><span class="token punctuation">(</span><span class="token function">_s</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>生成的渲染函数包含Vue内部方法：
<ul><li>_c: 创建虚拟节点</li> <li>_v: 创建文本虚拟节点</li> <li>_s: 转换为字符串</li></ul></li></ul> <h3 id="三、虚拟dom与patch过程"><a href="#三、虚拟dom与patch过程" class="header-anchor">#</a> 三、虚拟DOM与patch过程</h3> <h4 id="_1-首次渲染"><a href="#_1-首次渲染" class="header-anchor">#</a> 1. 首次渲染</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 执行渲染函数生成虚拟DOM</span>
<span class="token keyword">const</span> vnode <span class="token operator">=</span> vm<span class="token punctuation">.</span><span class="token function">_render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 将虚拟DOM转为真实DOM</span>
vm<span class="token punctuation">.</span><span class="token function">_update</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_2-更新过程"><a href="#_2-更新过程" class="header-anchor">#</a> 2. 更新过程</h4> <ul><li>数据变化触发setter</li> <li>通知依赖(Watcher)更新</li> <li>重新执行渲染函数生成新虚拟DOM</li> <li>新旧虚拟DOM对比(patch)</li> <li>计算最小差异并更新真实DOM</li></ul> <h4 id="_3-diff算法核心"><a href="#_3-diff算法核心" class="header-anchor">#</a> 3. Diff算法核心</h4> <ul><li>同级比较策略​​：
<ul><li>只比较同层级节点，不跨级比较</li> <li>通过key标识相同节点</li> <li>采用双端比较算法优化性能</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 简单的diff示例</span>
<span class="token keyword">function</span> <span class="token function">updateChildren</span><span class="token punctuation">(</span><span class="token parameter">parentElm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> newCh</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> oldStartIdx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> newStartIdx <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">let</span> oldEndIdx <span class="token operator">=</span> oldCh<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>
  <span class="token keyword">let</span> newEndIdx <span class="token operator">=</span> newCh<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="_11-new-vue-发生了什么"><a href="#_11-new-vue-发生了什么" class="header-anchor">#</a> 11. new Vue 发生了什么</h2> <p><code>new</code> 关键字在 Javascript 语言中代表实例化是一个对象，而 <code>Vue</code> 实际上是一个类</p> <p>可以看到 <code>Vue</code> 只能通过 <code>new</code> 关键字初始化，然后会调用 <code>this._init</code> 方法</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Vue</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span>
    <span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">Vue</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'Vue is a constructor and should be called with the `new` keyword'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_init</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Vue 初始化主要就干了几件事情<br>
合并配置，初始化生命周期，初始化事件中心，初始化渲染，初始化 data、props、computed、watcher 等等</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">_init</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">options<span class="token operator">?</span><span class="token operator">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token literal-property property">vm</span><span class="token operator">:</span> Component <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token comment">// a uid</span>
  vm<span class="token punctuation">.</span>_uid <span class="token operator">=</span> uid<span class="token operator">++</span>

  <span class="token keyword">let</span> startTag<span class="token punctuation">,</span> endTag
  <span class="token comment">/* istanbul ignore if */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> config<span class="token punctuation">.</span>performance <span class="token operator">&amp;&amp;</span> mark<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    startTag <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">vue-perf-start:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>vm<span class="token punctuation">.</span>_uid<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    endTag <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">vue-perf-end:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>vm<span class="token punctuation">.</span>_uid<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token function">mark</span><span class="token punctuation">(</span>startTag<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// a flag to avoid this being observed</span>
  vm<span class="token punctuation">.</span>_isVue <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token comment">// merge options</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>options <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>_isComponent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// optimize internal component instantiation</span>
    <span class="token comment">// since dynamic options merging is pretty slow, and none of the</span>
    <span class="token comment">// internal component options needs special treatment.</span>
    <span class="token function">initInternalComponent</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    vm<span class="token punctuation">.</span>$options <span class="token operator">=</span> <span class="token function">mergeOptions</span><span class="token punctuation">(</span>
      <span class="token function">resolveConstructorOptions</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>constructor<span class="token punctuation">)</span><span class="token punctuation">,</span>
      options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      vm
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/* istanbul ignore else */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">initProxy</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    vm<span class="token punctuation">.</span>_renderProxy <span class="token operator">=</span> vm
  <span class="token punctuation">}</span>
  <span class="token comment">// expose real self</span>
  vm<span class="token punctuation">.</span>_self <span class="token operator">=</span> vm
  <span class="token function">initLifecycle</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
  <span class="token function">initEvents</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
  <span class="token function">initRender</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
  <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'beforeCreate'</span><span class="token punctuation">)</span>
  <span class="token function">initInjections</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token comment">// resolve injections before data/props</span>
  <span class="token function">initState</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
  <span class="token function">initProvide</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token comment">// resolve provide after data/props</span>
  <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'created'</span><span class="token punctuation">)</span>

  <span class="token comment">/* istanbul ignore if */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> config<span class="token punctuation">.</span>performance <span class="token operator">&amp;&amp;</span> mark<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    vm<span class="token punctuation">.</span>_name <span class="token operator">=</span> <span class="token function">formatComponentName</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token function">mark</span><span class="token punctuation">(</span>endTag<span class="token punctuation">)</span>
    <span class="token function">measure</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">vue </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>vm<span class="token punctuation">.</span>_name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> init</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> startTag<span class="token punctuation">,</span> endTag<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    vm<span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>el<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div><h2 id="其他"><a href="#其他" class="header-anchor">#</a> 其他</h2> <p><a href="https://ustbhuangyi.github.io/vue-analysis/" target="_blank" rel="noopener noreferrer">Vue.js 技术揭秘<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://vue3js.cn/interview/" target="_blank" rel="noopener noreferrer">面试系列<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">lastUpdate:</span> <span class="time">5/24/2025, 5:41:34 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Front-end-go-on/pages/frontend/frame/base/Vue.html" class="prev">
        Vue2基础
      </a></span> <span class="next"><a href="/Front-end-go-on/pages/frontend/frame/base/Vue3.html">
        Vue3基础
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/Front-end-go-on/assets/js/app.de339d43.js" defer></script><script src="/Front-end-go-on/assets/js/2.976a445d.js" defer></script><script src="/Front-end-go-on/assets/js/1.2ccd9185.js" defer></script><script src="/Front-end-go-on/assets/js/12.959b286e.js" defer></script>
  </body>
</html>

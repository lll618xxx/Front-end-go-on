import{_ as s,c as a,a as t,o as p}from"./app-B7B08v9l.js";const e="/Front-end-go-on/assets/vue3_lifecircle-DO2NLsWq.png",l="/Front-end-go-on/assets/vue3_pc_lifecircle-BvRtSoCc.png",c="/Front-end-go-on/assets/vue2oapi_1-tIAWznI5.png",o="/Front-end-go-on/assets/vue2oapi_2-CNEKQ2--.png",i="/Front-end-go-on/assets/vue3capi-8RKfuZdA.png",u={};function r(d,n){return p(),a("div",null,[...n[0]||(n[0]=[t('<h2 id="_1-生命周期钩子对比-⭐️" tabindex="-1"><a class="header-anchor" href="#_1-生命周期钩子对比-⭐️"><span>1.生命周期钩子对比(⭐️)</span></a></h2><p>Vue 3 的生命周期可分为<strong>四大阶段</strong>，包含<strong>12个主要钩子函数</strong>：</p><img src="'+e+'" style="height:500px;"><h3 id="生命周期阶段概览" tabindex="-1"><a class="header-anchor" href="#生命周期阶段概览"><span>生命周期阶段概览</span></a></h3><ul><li>主要分为 ​​4 个阶段​​： <ul><li>​<strong>初始化阶段​</strong>​​： (用 setup 替代)</li><li>​<strong>​挂载阶段​</strong>​​：</li><li>​<strong>更新阶段</strong>​​：</li><li>​<strong>卸载阶段</strong>​​：</li></ul></li></ul><h3 id="vue-选项式api-vs-组合式api-生命周期对比" tabindex="-1"><a class="header-anchor" href="#vue-选项式api-vs-组合式api-生命周期对比"><span>Vue 选项式API vs 组合式API 生命周期对比</span></a></h3><table><thead><tr><th>生命周期阶段</th><th>选项式 API</th><th>组合式 API</th><th>触发时机说明</th></tr></thead><tbody><tr><td><strong>初始化阶段</strong></td><td></td><td></td><td></td></tr><tr><td><code>beforeCreate</code></td><td>✅ 支持</td><td>❌ 不需要 (用 setup 替代)</td><td>组件实例初始化前，<strong>无法访问数据和方法</strong></td></tr><tr><td><code>created</code></td><td>✅ 支持</td><td>❌ 不需要 (用 setup 替代)</td><td>组件实例创建完成，<strong>可访问数据但未挂载 DOM</strong></td></tr><tr><td><strong>挂载阶段</strong></td><td></td><td></td><td></td></tr><tr><td><code>beforeMount</code></td><td>✅ 支持</td><td><code>onBeforeMount</code></td><td>DOM 挂载开始前，<strong>首次 <code>render</code> 调用前</strong></td></tr><tr><td><code>mounted</code></td><td>✅ 支持</td><td><code>onMounted</code></td><td>DOM 挂载完成，<strong>可操作 DOM 或初始化第三方库</strong></td></tr><tr><td><strong>更新阶段</strong></td><td></td><td></td><td></td></tr><tr><td><code>beforeUpdate</code></td><td>✅ 支持</td><td><code>onBeforeUpdate</code></td><td>数据变化导致虚拟 DOM 重新渲染前，<strong>可获取更新前状态</strong></td></tr><tr><td><code>updated</code></td><td>✅ 支持</td><td><code>onUpdated</code></td><td>虚拟 DOM 重新渲染完成，<strong>避免在此修改状态（可能循环更新）</strong></td></tr><tr><td><strong>卸载阶段</strong></td><td></td><td></td><td></td></tr><tr><td><code>beforeUnmount</code></td><td>✅ 支持 (Vue3)</td><td><code>onBeforeUnmount</code></td><td>组件卸载前，<strong>清理定时器/事件监听</strong></td></tr><tr><td><code>unmounted</code></td><td>✅ 支持 (Vue3)</td><td><code>onUnmounted</code></td><td>组件卸载后，<strong>所有子组件也已卸载</strong></td></tr><tr><td><code>beforeDestroy</code></td><td>✅ 支持 (Vue2)</td><td>❌ 已废弃</td><td>Vue2 的卸载前钩子</td></tr><tr><td><code>destroyed</code></td><td>✅ 支持 (Vue2)</td><td>❌ 已废弃</td><td>Vue2 的卸载后钩子</td></tr><tr><td><strong>缓存组件</strong></td><td></td><td></td><td></td></tr><tr><td><code>activated</code></td><td>✅ 支持</td><td><code>onActivated</code></td><td>被 <code>&lt;keep-alive&gt;</code> 缓存的组件激活时</td></tr><tr><td><code>deactivated</code></td><td>✅ 支持</td><td><code>onDeactivated</code></td><td>被 <code>&lt;keep-alive&gt;</code> 缓存的组件失活时</td></tr><tr><td><strong>错误处理</strong></td><td></td><td></td><td></td></tr><tr><td><code>errorCaptured</code></td><td>✅ 支持</td><td><code>onErrorCaptured</code></td><td>捕获后代组件错误时</td></tr><tr><td><strong>调试钩子</strong></td><td></td><td></td><td></td></tr><tr><td>-</td><td>❌ 不支持</td><td><code>onRenderTracked</code></td><td><strong>开发模式</strong>下追踪响应式依赖时触发</td></tr><tr><td>-</td><td>❌ 不支持</td><td><code>onRenderTriggered</code></td><td><strong>开发模式</strong>下响应式依赖触发重新渲染时</td></tr></tbody></table><h3 id="父子组件生命周期顺序" tabindex="-1"><a class="header-anchor" href="#父子组件生命周期顺序"><span>父子组件生命周期顺序</span></a></h3><img src="'+l+`" style="height:500px;"><h4 id="挂载阶段" tabindex="-1"><a class="header-anchor" href="#挂载阶段"><span>挂载阶段</span></a></h4><p>父 beforeMount → 子 beforeMount → 子 mounted → 父 mounted</p><h4 id="更新阶段" tabindex="-1"><a class="header-anchor" href="#更新阶段"><span>更新阶段</span></a></h4><p>父 beforeUpdate → 子 beforeUpdate → 子 updated → 父 updated</p><h4 id="卸载阶段" tabindex="-1"><a class="header-anchor" href="#卸载阶段"><span>卸载阶段</span></a></h4><p>父 beforeUnmount → 子 beforeUnmount → 子 unmounted → 父 unmounted</p><h3 id="setup-中的-相关疑问" tabindex="-1"><a class="header-anchor" href="#setup-中的-相关疑问"><span>setup 中的 相关疑问</span></a></h3><h4 id="_1-为什么在-setup-中访问不到-this" tabindex="-1"><a class="header-anchor" href="#_1-为什么在-setup-中访问不到-this"><span>1. 为什么在 setup 中访问不到 this？</span></a></h4><p><code>setup()</code> 在组件实例创建前执行，此时 this 尚未绑定。</p><h4 id="_2-替代方案-如何访问组件实例" tabindex="-1"><a class="header-anchor" href="#_2-替代方案-如何访问组件实例"><span>2. 替代方案：如何访问组件实例？</span></a></h4><p>通过 getCurrentInstance（谨慎使用）</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> getCurrentInstance <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token function">getCurrentInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment">// 访问根组件属性（类似 this.$root）</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>root<span class="token punctuation">.</span>proxy<span class="token punctuation">)</span> </span>
<span class="line">    <span class="token comment">// 访问父组件（类似 this.$parent）</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>parent<span class="token operator">?.</span>proxy<span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment">// 访问插槽（类似 this.$slots）</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>slots<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>⚠️ ​​注意​​：</p><ul><li>此 API 主要供库开发者使用，​​不推荐在业务代码中频繁使用​​</li><li>生产构建时可能被 Tree-Shaking（除屑优化） 移除</li></ul><h4 id="_3-哪些业务要setup访问类似this的功能" tabindex="-1"><a class="header-anchor" href="#_3-哪些业务要setup访问类似this的功能"><span>3. 哪些业务要setup访问类似this的功能？</span></a></h4><table><thead><tr><th>业务场景</th><th>推荐解决方案</th><th>替代 this 的方式</th></tr></thead><tbody><tr><td>访问全局属性​</td><td>使用 provide/inject</td><td>inject(&#39;globalProperty&#39;)</td></tr><tr><td>​​访问路由​</td><td>使用 useRouter</td><td>const router = useRouter()</td></tr><tr><td>访问 Vuex 存储​</td><td>使用 useStore</td><td>const store = useStore()</td></tr><tr><td>​​访问 $el​</td><td>使用模板 ref</td><td>const el = ref(null)</td></tr><tr><td>​​访问 $parent​​</td><td>通过 getCurrentInstance（谨慎）</td><td>getCurrentInstance().parent</td></tr></tbody></table><h4 id="_4-return-的作用" tabindex="-1"><a class="header-anchor" href="#_4-return-的作用"><span>4. return 的作用</span></a></h4><p>return 返回一个对象，这个对象的 ​<strong>​所有属性和方法都会暴露给模板和其他组件选项​</strong>​（如 <code>methods</code>、<code>computed</code> 等）。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// 模板可访问, 可直接使用返回的 ref 和计算属性</span></span>
<span class="line"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span></span>
<span class="line">  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> count <span class="token punctuation">}</span><span class="token punctuation">}</span> × <span class="token number">2</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> double <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">const</span> double <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> count<span class="token punctuation">.</span>value <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">      count<span class="token punctuation">,</span>  <span class="token comment">// 模板中可直接使用 count</span></span>
<span class="line">      double  <span class="token comment">// 模板中可直接使用 double</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">printCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// 通过 this 访问 setup 返回的值</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-vue2-组件只允许有一个根节点-vue3允许有多个" tabindex="-1"><a class="header-anchor" href="#_2-vue2-组件只允许有一个根节点-vue3允许有多个"><span>2.Vue2 组件只允许有一个根节点，Vue3允许有多个</span></a></h2><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// Vue2</span></span>
<span class="line"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// Vue3</span></span>
<span class="line"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Vue2要求单根节点是因为其虚拟DOM实现依赖于每个组件实例必须对应一个单一的根DOM元素。组件的$el属性和diff算法都需要明确的根节点作为操作的锚点。</li><li>Vue3允许多根节点是通过引入<code>Fragment</code>（片段）的概念实现的。<code>Fragment</code>是一个特殊的虚拟节点，它本身不渲染为真实DOM，只是作为多个兄弟节点的逻辑容器。这使得Vue3的patch算法能够处理多根组件，同时为<code>Teleport</code>、<code>Suspense</code>等新特性奠定了基础。</li></ul><h2 id="_3-响应式数据拦截监听方法比较-⭐️" tabindex="-1"><a class="header-anchor" href="#_3-响应式数据拦截监听方法比较-⭐️"><span>3.响应式数据拦截监听方法比较(⭐️)</span></a></h2><p>Vu2采用的是 <code>Object.defineProperty</code>， Vue3采用的是 <code>Proxy</code></p><table><thead><tr><th>特性</th><th>Vue2</th><th>Vue3</th></tr></thead><tbody><tr><td>底层技术​</td><td>Object.defineProperty</td><td>Proxy</td></tr><tr><td>初始化时机</td><td>初始化时递归遍历所有属性</td><td>按需惰性响应式</td></tr><tr><td>数组处理​</td><td>重写数组方法</td><td>原生支持数组操作</td></tr><tr><td>​​新增属性​</td><td>需使用Vue.set</td><td>自动支持</td></tr></tbody></table><p>Object.defineProperty 虽然已经能够实现双向绑定了，但是他还是有缺陷的。<br> 1、只能对属性进行数据劫持，所以需要深度遍历整个对象<br> 2、对于数组不能监听到数据的变化<br> 3、Proxy 的第二个参数可以有 13 种拦截方法，比 Object.defineProperty() 要更加丰富<br> 4、Proxy 的兼容性不如 Object.defineProperty() 不能使用 polyfill 来处理兼容性</p><p>而Object.defineProperty这个对于数组缺陷可以通过vue提供的set方法去解决</p><p>Proxy能够原生支持监听数组变化，并且可以直接对整个对象进行拦截</p><h2 id="_4-vue2-options-api-和-vue3-conponents-api-对比-⭐️" tabindex="-1"><a class="header-anchor" href="#_4-vue2-options-api-和-vue3-conponents-api-对比-⭐️"><span>4. Vue2 options Api 和 Vue3 conponents Api 对比(⭐️)</span></a></h2><p><code>Options</code> API​ 按选项类型组织代码（<code>data</code>、<code>methods</code>、<code>computed</code>分开），适合简单组件，但大型组件中相关逻辑分散，难以维护。逻辑复用依赖mixins，存在命名冲突和来源不清晰的问题。</p><p><code>Composition</code> API​ 按逻辑功能组织代码，将相关的数据、计算属性、方法放在一起，类似<code>React Hooks</code>。它通过自定义Hook实现更好的逻辑复用，有更好的TypeScript支持，更适合大型复杂应用。</p><p>实际选择时，小型简单组件用Options API更直观，大型复杂组件用<code>Composition</code> API更易维护。Vue 3两者都支持，可以根据项目需求灵活选择</p><h3 id="vue2-options-api示例图" tabindex="-1"><a class="header-anchor" href="#vue2-options-api示例图"><span>Vue2 options Api示例图</span></a></h3><br><img src="`+c+'" style="width:500px;"><img src="'+o+`" style="width:200px;"><ul><li>通过选项（data, methods, computed 等）组织代码：</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="vue3-conponents-api" tabindex="-1"><a class="header-anchor" href="#vue3-conponents-api"><span>Vue3 conponents Api</span></a></h3><img src="`+i+`" style="width:300px;"><ul><li>通过 setup() 函数按逻辑组织代码（类似 React Hooks）：</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> computed <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> double <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> count<span class="token punctuation">.</span>value <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span> count<span class="token punctuation">,</span> double <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当这个组件的代码超过几百行时，这时增加或者修改某个需求， 就要在 data、methods、computed 以及 mounted 中反复的跳转，这其中的的痛苦写过的都知道。</p><p>vue2.x 版本给出的解决方案就是 Mixin，但是也会有相对应的问题<br> 1、命名冲突问题<br> 2、不清楚暴露出来的变量的作用<br> 3、逻辑重用到其他 component 经常遇到问题</p><p>Vue 3: 自定义Hook（清晰复用）</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// useUser.js - 自定义Hook</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> onMounted <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">const</span> isLoading <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 获取用户数据</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token function">onMounted</span><span class="token punctuation">(</span>fetchUsers<span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">    users<span class="token punctuation">,</span></span>
<span class="line">    isLoading<span class="token punctuation">,</span></span>
<span class="line">    fetchUsers</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// component.vue</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useUser <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./useUser&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> users<span class="token punctuation">,</span> isLoading<span class="token punctuation">,</span> fetchUsers <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment">// ✅ 清晰：明确知道user来自useUser</span></span>
<span class="line"><span class="token comment">// ✅ 类型安全：TypeScript友好</span></span>
<span class="line"><span class="token comment">// ✅ 可组合：可以和其他Hook组合使用</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="composition的核心优势" tabindex="-1"><a class="header-anchor" href="#composition的核心优势"><span>Composition的核心优势</span></a></h3><h4 id="_1、更强的逻辑复用能力" tabindex="-1"><a class="header-anchor" href="#_1、更强的逻辑复用能力"><span>1、更强的逻辑复用能力</span></a></h4><p>通过自定义组合式函数，可以将业务逻辑干净利落地封装成独立、可测试的单元，然后在多个组件中像普通函数一样引入和使用，彻底解决了 <code>Mixin</code> 的痛点</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// 1. 封装逻辑：useMouse.js</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> onMounted<span class="token punctuation">,</span> onUnmounted <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useMouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> y <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token comment">// 相关逻辑可以集中在此处</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token function-variable function">update</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    x<span class="token punctuation">.</span>value <span class="token operator">=</span> e<span class="token punctuation">.</span>pageX<span class="token punctuation">;</span></span>
<span class="line">    y<span class="token punctuation">.</span>value <span class="token operator">=</span> e<span class="token punctuation">.</span>pageY<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;mousemove&#39;</span><span class="token punctuation">,</span> update<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">onUnmounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;mousemove&#39;</span><span class="token punctuation">,</span> update<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token comment">// 返回需要使用的数据和方法</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 2. 在组件中使用</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useMouse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./useMouse&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 逻辑清晰复用</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2、更优雅的代码组织" tabindex="-1"><a class="header-anchor" href="#_2、更优雅的代码组织"><span>2、更优雅的代码组织</span></a></h4><p>当组件变得复杂时，<code>Options API</code> 会导致开发者在 <code>data</code>, <code>methods</code>, <code>computed</code>, <code>mounted</code>等选项间反复跳跃查看和修改同一功能的代码。<code>Composition API</code> 允许你将一个功能的所有代码（数据、计算属性、方法、生命周期钩子）组织在同一个区域，大大提升了代码的可读性和可维护性。</p><h4 id="_3、更出色的-typescript-集成" tabindex="-1"><a class="header-anchor" href="#_3、更出色的-typescript-集成"><span>3、更出色的 TypeScript 集成</span></a></h4><p>由于 <code>Composition API</code> 主要使用普通的变量和函数，它能够与 TypeScript 的静态类型系统完美协作，提供更可靠的类型推断和代码提示，非常适合大型项目开发</p><h2 id="_5-watch-和-watcheffect-区别-⭐️" tabindex="-1"><a class="header-anchor" href="#_5-watch-和-watcheffect-区别-⭐️"><span>5.watch 和 watchEffect 区别(⭐️)</span></a></h2><table><thead><tr><th style="text-align:center;">特性</th><th style="text-align:center;">watch</th><th style="text-align:center;">watchEffect</th></tr></thead><tbody><tr><td style="text-align:center;">依赖收集方式​</td><td style="text-align:center;">显式指定侦听源</td><td style="text-align:center;">隐式自动收集</td></tr><tr><td style="text-align:center;">初始执行​</td><td style="text-align:center;">默认不执行(可配置)</td><td style="text-align:center;">立即执行</td></tr><tr><td style="text-align:center;">回调参数​</td><td style="text-align:center;">提供新旧值</td><td style="text-align:center;">无参数</td></tr><tr><td style="text-align:center;">​​停止侦听​</td><td style="text-align:center;">返回停止函数</td><td style="text-align:center;">返回停止函数</td></tr></tbody></table><h4 id="_1-用法示例" tabindex="-1"><a class="header-anchor" href="#_1-用法示例"><span>(1) 用法示例</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">&#39;爱丽丝&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">details</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;鲍勃&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// --- watchEffect ---</span></span>
<span class="line"><span class="token comment">// 1. 在组件初始化时立即执行。</span></span>
<span class="line"><span class="token comment">// 2. 自动追踪其依赖项。</span></span>
<span class="line"><span class="token comment">//    每当 &#39;count.value&#39; 或 &#39;name.value&#39; 发生变化时，它会重新运行。</span></span>
<span class="line"><span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">watchEffect: Count 是 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>count<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, Name 是 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>name<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">。此 effect 执行。</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">flush</span><span class="token operator">:</span> <span class="token string">&#39;post&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 1. 侦听单个 ref</span></span>
<span class="line"><span class="token comment">//    - 默认情况下不会立即执行。</span></span>
<span class="line"><span class="token comment">//    - 提供 oldValue 和 newValue。</span></span>
<span class="line"><span class="token function">watch</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">watch (count): 从 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>oldValue<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 变为 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>newValue<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">。</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 2. 侦听一个 getter 函数</span></span>
<span class="line"><span class="token comment">//    - 用于侦听响应式对象的特定属性。</span></span>
<span class="line"><span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> user<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newId<span class="token punctuation">,</span> oldId</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">watch (user.id getter): User ID 从 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>oldId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 变为 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>newId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">。</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 3. 侦听多个源</span></span>
<span class="line"><span class="token comment">//    - 回调函数接收新值和旧值的数组。</span></span>
<span class="line"><span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">[</span>count<span class="token punctuation">,</span> name<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>newCount<span class="token punctuation">,</span> newName<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>oldCount<span class="token punctuation">,</span> oldName<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">watch (多个源: [count, name]): Count: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>oldCount<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> -&gt; </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>newCount<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, Name: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>oldName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> -&gt; </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>newName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">。</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 4. 使用 \`immediate: true\` 的 watch</span></span>
<span class="line"><span class="token comment">//    - 在初始化时立即执行回调，此时 oldValue 为 undefined。</span></span>
<span class="line"><span class="token function">watch</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newName<span class="token punctuation">,</span> oldName</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">watch (name, immediate): Name: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>oldName <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> <span class="token string">&#39;N/A (初始运行)&#39;</span> <span class="token operator">:</span> oldName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> -&gt; </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>newName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">。</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">immediate</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 5. 侦听响应式对象 (直接属性更改)</span></span>
<span class="line"><span class="token comment">//    - 默认情况下，对响应式对象的 \`watch\` 对于其直接属性是&quot;深层&quot;的。</span></span>
<span class="line"><span class="token comment">//    - 但是，除非指定了 \`deep: true\` 或您侦听特定的嵌套属性，否则它不会因嵌套对象更改而触发。</span></span>
<span class="line"><span class="token comment">//    - 直接侦听响应式对象时，除非对象引用本身被替换，否则 oldValue 和 newValue 将是同一个对象</span></span>
<span class="line"><span class="token comment">//      (代理到同一个底层对象)。</span></span>
<span class="line"><span class="token function">watch</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newUser<span class="token punctuation">,</span> oldUser</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 注意：对于响应式对象，如果您直接修改属性，newUser 和 oldUser 通常是同一个代理对象。</span></span>
<span class="line">  <span class="token comment">// 变化发生在对象 *内部*。</span></span>
<span class="line">  <span class="token comment">// 如果 \`user.id\` 更改，或者 \`user.details\` 被替换，则此侦听器会触发。</span></span>
<span class="line">  <span class="token comment">// 在没有 \`deep:true\` 的情况下，它不会因为 \`user.details.name\` 的更改而触发。</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">watch (user 对象直接侦听): User 对象已更改。New ID: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>newUser<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, Old ID (可能是相同的代理): </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>oldUser<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">。</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>newUser <span class="token operator">===</span> oldUser<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;watch (user 对象直接侦听): newUser 和 oldUser 是同一个代理对象。&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 6. 深层侦听响应式对象</span></span>
<span class="line"><span class="token comment">//    - 使用 \`deep: true\` 来侦听对象内部任何级别的更改。</span></span>
<span class="line"><span class="token comment">//    - 对于非常大或复杂的对象，请注意性能。</span></span>
<span class="line"><span class="token function">watch</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newUser<span class="token punctuation">,</span> oldUser</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">watch (user 对象, deep: true): User 详细信息已更改。New Name: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>newUser<span class="token punctuation">.</span>details<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, Age: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>newUser<span class="token punctuation">.</span>details<span class="token punctuation">.</span>age<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">。</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token comment">// 即使使用 deep，如果对象被修改，newUser 和 oldUser 也可能是同一个代理。</span></span>
<span class="line">  <span class="token comment">// 关键是 *内部的某些东西* 发生了变化。</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">deep</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-停止侦听" tabindex="-1"><a class="header-anchor" href="#_2-停止侦听"><span>(2) 停止侦听</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// watch</span></span>
<span class="line"><span class="token keyword">const</span> stopWatch <span class="token operator">=</span> <span class="token function">watch</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token function">stopWatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// watchEffect</span></span>
<span class="line"><span class="token keyword">const</span> stopEffect <span class="token operator">=</span> <span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token function">stopEffect</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-副作用清理" tabindex="-1"><a class="header-anchor" href="#_3-副作用清理"><span>(3) 副作用清理</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// watch</span></span>
<span class="line"><span class="token function">watch</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newVal<span class="token punctuation">,</span> oldVal<span class="token punctuation">,</span> onCleanup</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token function">onCleanup</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// watchEffect</span></span>
<span class="line"><span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">onCleanup</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token function">onCleanup</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="使用-watch-当" tabindex="-1"><a class="header-anchor" href="#使用-watch-当"><span>使用 watch 当：</span></a></h4><p>✅ 需要比较新旧值<br> ✅ 需要惰性执行（非立即执行）<br> ✅ 侦听特定数据源，避免不必要的触发<br> ✅ 侦听嵌套数据结构中的特定属性</p><h4 id="使用-watcheffect-当" tabindex="-1"><a class="header-anchor" href="#使用-watcheffect-当"><span>使用 watchEffect 当：</span></a></h4><p>✅ 需要立即执行并建立依赖关系<br> ✅ 依赖多个属性且关系复杂<br> ✅ 执行副作用不关心具体变化值</p><h3 id="flush-的可选值" tabindex="-1"><a class="header-anchor" href="#flush-的可选值"><span>flush 的可选值</span></a></h3><p>控制副作用执行时机的重要配置选项，主要用于 <code>watch</code> 和 <code>watchEffect</code></p><table><thead><tr><th style="text-align:center;">值</th><th style="text-align:center;">执行时机</th><th style="text-align:center;">适用场景</th></tr></thead><tbody><tr><td style="text-align:center;"><code>&#39;pre&#39;</code></td><td style="text-align:center;">组件更新前（默认值）</td><td style="text-align:center;">需要获取更新前DOM状态时</td></tr><tr><td style="text-align:center;"><code>&#39;post&#39;</code></td><td style="text-align:center;">组件更新后</td><td style="text-align:center;">需要操作更新后的DOM时</td></tr><tr><td style="text-align:center;"><code>&#39;sync&#39;</code></td><td style="text-align:center;">依赖变更后同步立即执行</td><td style="text-align:center;">需要极速响应的特殊场景</td></tr></tbody></table><h4 id="不同-flush-模式的执行流程对比" tabindex="-1"><a class="header-anchor" href="#不同-flush-模式的执行流程对比"><span>不同 flush 模式的执行流程对比</span></a></h4><p><strong>1. ​​依赖变更触发流程​​：</strong><br> &#39;sync&#39;: 变更 → 立即执行副作用<br> &#39;pre&#39;: 变更 → 加入pre队列 → 组件beforeUpdate → 执行pre队列 → DOM更新<br> &#39;post&#39;: 变更 → 加入post队列 → 组件beforeUpdate → DOM更新 → 执行post队列</p><p><strong>2. ​​与生命周期钩子的关系​​：</strong><br> beforeUpdate → (&#39;pre&#39;副作用) → DOM更新 → updated → (&#39;post&#39;副作用)</p><h4 id="不同场景下的选择指南" tabindex="-1"><a class="header-anchor" href="#不同场景下的选择指南"><span>不同场景下的选择指南</span></a></h4><table><thead><tr><th style="text-align:center;">场景特征</th><th style="text-align:center;">推荐值</th><th style="text-align:center;">理由</th></tr></thead><tbody><tr><td style="text-align:center;">需要获取元素更新前尺寸</td><td style="text-align:center;"><code>&#39;pre&#39;</code></td><td style="text-align:center;">在DOM更新前捕获旧值</td></tr><tr><td style="text-align:center;">触发需要DOM更新的动画</td><td style="text-align:center;"><code>&#39;post&#39;</code></td><td style="text-align:center;">确保动画基于最新DOM状态</td></tr><tr><td style="text-align:center;">实时游戏状态同步</td><td style="text-align:center;"><code>&#39;sync&#39;</code></td><td style="text-align:center;">需要帧级精确响应</td></tr><tr><td style="text-align:center;">表单输入验证</td><td style="text-align:center;"><code>&#39;pre&#39;</code></td><td style="text-align:center;">在用户看到变化前完成验证</td></tr><tr><td style="text-align:center;">图表数据更新</td><td style="text-align:center;"><code>&#39;post&#39;</code></td><td style="text-align:center;">确保容器尺寸已更新</td></tr><tr><td style="text-align:center;">与Web Worker通信</td><td style="text-align:center;"><code>&#39;sync&#39;</code></td><td style="text-align:center;">避免消息延迟</td></tr></tbody></table><h2 id="_6-组件通信方式-⭐️" tabindex="-1"><a class="header-anchor" href="#_6-组件通信方式-⭐️"><span>6.组件通信方式(⭐️)</span></a></h2><h3 id="一、父子组件通信" tabindex="-1"><a class="header-anchor" href="#一、父子组件通信"><span>一、父子组件通信</span></a></h3><h4 id="_1-​​props-emit​​-vue2-vue3-通用" tabindex="-1"><a class="header-anchor" href="#_1-​​props-emit​​-vue2-vue3-通用"><span>1. ​​Props / $emit​​（Vue2 &amp; Vue3 通用）</span></a></h4><ul><li>​父 → 子​​：通过 props 传递数据</li><li>​子 → 父​​：通过 $emit 触发事件</li></ul><p><strong>Vue2 父子组件通信</strong></p><div class="language-vue line-numbers-mode" data-highlighter="prismjs" data-ext="vue"><pre><code class="language-vue"><span class="line"><span class="token comment">&lt;!-- Parent.vue --&gt;</span></span>
<span class="line"><span class="token comment">&lt;!-- 父组件 → 子组件（props） --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> <span class="token attr-name">:message</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>parentMsg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@update</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleUpdate<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"></span>
<span class="line"><span class="token keyword">import</span> Child <span class="token keyword">from</span> <span class="token string">&#39;./Child.vue&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">{</span> Child <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">parentMsg</span><span class="token operator">:</span> <span class="token string">&#39;Hello from Parent&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">handleUpdate</span><span class="token punctuation">(</span><span class="token parameter">newMsg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span>parentMsg <span class="token operator">=</span> newMsg<span class="token punctuation">;</span> <span class="token comment">// 接收子组件传递的数据</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-vue line-numbers-mode" data-highlighter="prismjs" data-ext="vue"><pre><code class="language-vue"><span class="line"><span class="token comment">&lt;!-- 子组件 → 父组件（$emit） --&gt;</span></span>
<span class="line"><span class="token comment">&lt;!-- Child.vue --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>收到父组件消息：{{ message }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sendToParent<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点击修改父组件数据<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;message&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 接收父组件数据</span></span>
<span class="line">  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">sendToParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&#39;update&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;子组件修改后的消息&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 触发父组件事件</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Vue3 父子组件通信（Composition API）</strong></p><div class="language-vue line-numbers-mode" data-highlighter="prismjs" data-ext="vue"><pre><code class="language-vue"><span class="line"><span class="token comment">&lt;!-- Parent.vue --&gt;</span></span>
<span class="line"><span class="token comment">&lt;!-- 父组件 → 子组件（props） --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> <span class="token attr-name">:message</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>parentMsg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@update</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleUpdate<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> Child <span class="token keyword">from</span> <span class="token string">&#39;./Child.vue&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> parentMsg <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">&#39;Hello from Parent&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">handleUpdate</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">newMsg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  parentMsg<span class="token punctuation">.</span>value <span class="token operator">=</span> newMsg<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-vue line-numbers-mode" data-highlighter="prismjs" data-ext="vue"><pre><code class="language-vue"><span class="line"><span class="token comment">&lt;!-- Child.vue --&gt;</span></span>
<span class="line"><span class="token comment">&lt;!-- 子组件 → 父组件（defineEmits） --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>收到父组件消息：{{ message }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sendToParent<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点击修改父组件数据<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"></span>
<span class="line"><span class="token function">defineProps</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;message&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 接收props</span></span>
<span class="line"><span class="token keyword">const</span> emit <span class="token operator">=</span> <span class="token function">defineEmits</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;update&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 声明事件</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">sendToParent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&#39;update&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;子组件修改后的消息&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 触发事件</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-​​v-model-sync​​-语法糖-适用于表单组件" tabindex="-1"><a class="header-anchor" href="#_2-​​v-model-sync​​-语法糖-适用于表单组件"><span>2. ​​v-model / .sync​​（语法糖），适用于表单组件</span></a></h4><ul><li>Vue2​​：<code>.sync</code> 修饰符（双向绑定）</li><li>Vue3​​：<code>v-model</code> 可绑定多个值</li></ul><p><strong>Vue2 的 .sync 修饰符</strong></p><div class="language-vue line-numbers-mode" data-highlighter="prismjs" data-ext="vue"><pre><code class="language-vue"><span class="line"><span class="token comment">&lt;!-- Parent.vue --&gt;</span></span>
<span class="line"><span class="token comment">&lt;!-- Vue2 的 .sync 修饰符 --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> <span class="token attr-name">:title.sync</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>parentTitle<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>父组件标题：{{ parentTitle }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"></span>
<span class="line"><span class="token keyword">import</span> Child <span class="token keyword">from</span> <span class="token string">&#39;./Child.vue&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">{</span> Child <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">parentTitle</span><span class="token operator">:</span> <span class="token string">&#39;默认标题&#39;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-vue line-numbers-mode" data-highlighter="prismjs" data-ext="vue"><pre><code class="language-vue"><span class="line"><span class="token comment">&lt;!-- Child.vue --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> </span>
<span class="line">      <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>title<span class="token punctuation">&quot;</span></span> </span>
<span class="line">      <span class="token attr-name">@input</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$emit(&#39;update:title&#39;, $event.target.value)<span class="token punctuation">&quot;</span></span></span>
<span class="line">    <span class="token punctuation">/&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;title&#39;</span><span class="token punctuation">]</span> <span class="token comment">// 接收父组件传递的 title</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>关键点​​： <ul><li><code>.sync</code> 本质是 <code>:title</code> + <code>@update:title</code> 的语法糖</li><li>子组件通过 <code>$emit(&#39;update:propName&#39;)</code> 修改父组件数据</li></ul></li></ul><p><strong>为什么会有“只能绑定一个属性”的说法？</strong></p><ul><li>​历史背景​​ <ul><li>Vue2 早期版本中，<code>.sync</code> 曾被废弃（因滥用导致数据流混乱），后来在 ​​2.3.0+​​ 重新引入但​​官方文档强调谨慎使用​​</li><li>开发者为避免滥用，常约定“尽量不用 <code>.sync</code>”或“只用于单个属性”，导致误解传播</li></ul></li></ul><p><strong>Vue3 的 v-model（支持多个绑定）</strong></p><div class="language-vue line-numbers-mode" data-highlighter="prismjs" data-ext="vue"><pre><code class="language-vue"><span class="line"><span class="token comment">&lt;!-- Parent.vue --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> <span class="token attr-name"><span class="token namespace">v-model:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>parentTitle<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">v-model:</span>content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>parentContent<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> Child <span class="token keyword">from</span> <span class="token string">&#39;./Child.vue&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> parentTitle <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">&#39;默认标题&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> parentContent <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">&#39;默认内容&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-vue line-numbers-mode" data-highlighter="prismjs" data-ext="vue"><pre><code class="language-vue"><span class="line"><span class="token comment">&lt;!-- Child.vue --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span></span>
<span class="line">      <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>title<span class="token punctuation">&quot;</span></span></span>
<span class="line">      <span class="token attr-name">@input</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$emit(&#39;update:title&#39;, $event.target.value)<span class="token punctuation">&quot;</span></span></span>
<span class="line">    <span class="token punctuation">/&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span></span>
<span class="line">      <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>content<span class="token punctuation">&quot;</span></span></span>
<span class="line">      <span class="token attr-name">@input</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$emit(&#39;update:content&#39;, $event.target.value)<span class="token punctuation">&quot;</span></span></span>
<span class="line">    <span class="token punctuation">/&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"></span>
<span class="line"><span class="token function">defineProps</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;title&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;content&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">defineEmits</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;update:title&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;update:content&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>关键点​​： <ul><li>Vue3 的 <code>v-model:propName</code> 可绑定多个属性</li><li>子组件需通过 <code>defineEmits</code> 显式声明更新事件</li></ul></li></ul><div class="hint-container tip"><p class="hint-container-title">提示</p><p>Vue3 的 v-model 本质是 modelValue + update:modelValue 的语法糖，且支持多个绑定&quot;</p></div><h3 id="二、跨层级通信" tabindex="-1"><a class="header-anchor" href="#二、跨层级通信"><span>二、跨层级通信</span></a></h3><h4 id="_3-​​provide-inject​​-vue2-2-vue3-适用于主题-配置" tabindex="-1"><a class="header-anchor" href="#_3-​​provide-inject​​-vue2-2-vue3-适用于主题-配置"><span>3. ​​provide / inject​​（Vue2.2+ &amp; Vue3），适用于主题/配置</span></a></h4><ul><li>祖先组件​​：<code>provide</code> 提供数据</li><li>​后代组件​​：<code>inject</code> 注入数据</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// 祖先组件</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">provide</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">theme</span><span class="token operator">:</span> <span class="token string">&#39;dark&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 后代组件</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">inject</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;theme&#39;</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>适用场景​​： <ul><li>主题切换、全局配置等跨多级组件传递</li></ul></li></ul><h4 id="_4-​​attrs-listeners​​-vue2-→-​​useattrs​​-vue3" tabindex="-1"><a class="header-anchor" href="#_4-​​attrs-listeners​​-vue2-→-​​useattrs​​-vue3"><span>4. ​​attrs/listeners​​（Vue2）→ ​​useAttrs​​（Vue3）</span></a></h4><ul><li>​Vue2​​： <ul><li>$attrs：接收非 props 的属性</li><li>$listeners：接收所有事件</li></ul></li><li>​Vue3​​： <ul><li>合并为 useAttrs()，用于获取组件接收的所有非props属性，包括class、style、事件监听器等。</li></ul></li></ul><p><strong>Vue2 的 $attrs 和 $listeners</strong></p><div class="language-vue line-numbers-mode" data-highlighter="prismjs" data-ext="vue"><pre><code class="language-vue"><span class="line"><span class="token comment">&lt;!-- 父组件（传递属性和事件） --&gt;</span></span>
<span class="line"><span class="token comment">&lt;!-- Parent.vue --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> </span>
<span class="line">    <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>父组件标题<span class="token punctuation">&quot;</span></span> </span>
<span class="line">    <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>red-text<span class="token punctuation">&quot;</span></span> </span>
<span class="line">    <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleClick<span class="token punctuation">&quot;</span></span></span>
<span class="line">    <span class="token attr-name">@custom-event</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleCustom<span class="token punctuation">&quot;</span></span></span>
<span class="line">  <span class="token punctuation">/&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"></span>
<span class="line"><span class="token keyword">import</span> Child <span class="token keyword">from</span> <span class="token string">&#39;./Child.vue&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">{</span> Child <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;点击事件触发&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">handleCustom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;自定义事件触发&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-vue line-numbers-mode" data-highlighter="prismjs" data-ext="vue"><pre><code class="language-vue"><span class="line"><span class="token comment">&lt;!-- 子组件（透传到孙组件） --&gt;</span></span>
<span class="line"><span class="token comment">&lt;!-- Child.vue --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token comment">&lt;!-- 透传所有非props属性和事件 --&gt;</span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>GrandChild</span> <span class="token attr-name">v-bind</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$attrs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-on</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$listeners<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"></span>
<span class="line"><span class="token keyword">import</span> GrandChild <span class="token keyword">from</span> <span class="token string">&#39;./GrandChild.vue&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">{</span> GrandChild <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">inheritAttrs</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 禁止自动绑定到根元素</span></span>
<span class="line">  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;title&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 显式接收的prop不会出现在$attrs中</span></span>
<span class="line">  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$attrs<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出：{ class: &quot;red-text&quot; }</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$listeners<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出：{ click: fn, custom-event: fn }</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-vue line-numbers-mode" data-highlighter="prismjs" data-ext="vue"><pre><code class="language-vue"><span class="line"><span class="token comment">&lt;!-- 孙组件（最终接收） --&gt;</span></span>
<span class="line"><span class="token comment">&lt;!-- GrandChild.vue --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$emit(&#39;click&#39;)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    点击我（透传的class：{{ $attrs.class }}）</span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Vue3 的 useAttrs（合并了属性和事件）</strong></p><div class="language-vue line-numbers-mode" data-highlighter="prismjs" data-ext="vue"><pre><code class="language-vue"><span class="line"><span class="token comment">&lt;!-- 父组件（传递属性和事件） --&gt;</span></span>
<span class="line"><span class="token comment">&lt;!-- Parent.vue --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> </span>
<span class="line">    <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>父组件标题<span class="token punctuation">&quot;</span></span> </span>
<span class="line">    <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>red-text<span class="token punctuation">&quot;</span></span> </span>
<span class="line">    <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleClick<span class="token punctuation">&quot;</span></span></span>
<span class="line">  <span class="token punctuation">/&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> Child <span class="token keyword">from</span> <span class="token string">&#39;./Child.vue&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;点击事件触发&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-vue line-numbers-mode" data-highlighter="prismjs" data-ext="vue"><pre><code class="language-vue"><span class="line"><span class="token comment">&lt;!-- 子组件（透传属性） --&gt;</span></span>
<span class="line"><span class="token comment">&lt;!-- Child.vue --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>GrandChild</span> <span class="token attr-name">v-bind</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>attrs<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useAttrs <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> GrandChild <span class="token keyword">from</span> <span class="token string">&#39;./GrandChild.vue&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> attrs <span class="token operator">=</span> <span class="token function">useAttrs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 自动合并属性和事件</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>attrs<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出：{ class: &quot;red-text&quot;, onClick: fn }</span></span>
<span class="line"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-vue line-numbers-mode" data-highlighter="prismjs" data-ext="vue"><pre><code class="language-vue"><span class="line"><span class="token comment">&lt;!-- 孙组件（最终接收） --&gt;</span></span>
<span class="line"><span class="token comment">&lt;!-- GrandChild.vue --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>attrs.onClick<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    点击我（透传的class：{{ attrs.class }}）</span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useAttrs <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> attrs <span class="token operator">=</span> <span class="token function">useAttrs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>记忆技巧​​： <ul><li><code>&quot;attrs</code> 传属性，<code>listeners</code>传事件，Vue3 合并简化&quot;</li></ul></li></ul><h3 id="三、全局状态管理" tabindex="-1"><a class="header-anchor" href="#三、全局状态管理"><span>三、全局状态管理</span></a></h3><h4 id="_5-​​vuex-vue2-→-pinia-vue3-推荐-​​" tabindex="-1"><a class="header-anchor" href="#_5-​​vuex-vue2-→-pinia-vue3-推荐-​​"><span>5. ​​Vuex（Vue2）→ Pinia（Vue3 推荐）​​</span></a></h4><table><thead><tr><th style="text-align:center;">​​特性​</th><th style="text-align:center;">Vuex​</th><th style="text-align:center;">​​Pinia​</th></tr></thead><tbody><tr><td style="text-align:center;">​​API 设计​</td><td style="text-align:center;">state + mutations + actions</td><td style="text-align:center;">合并为 state + actions</td></tr><tr><td style="text-align:center;">​​TypeScript​​</td><td style="text-align:center;">支持较弱</td><td style="text-align:center;">原生支持类型推断</td></tr><tr><td style="text-align:center;">​模块化​</td><td style="text-align:center;">通过 modules 分割</td><td style="text-align:center;">每个Store是独立文件</td></tr><tr><td style="text-align:center;">​异步处理​</td><td style="text-align:center;">需在 actions 中调用 commit</td><td style="text-align:center;">可直接修改 state</td></tr><tr><td style="text-align:center;">modules</td><td style="text-align:center;">独立store文件</td><td style="text-align:center;">无需命名空间</td></tr></tbody></table><ul><li>​Vuex​​： <ul><li>state / mutations / actions / getters</li></ul></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// 定义 Store (store/index.js)</span></span>
<span class="line"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">&#39;vuex&#39;</span><span class="token punctuation">;</span></span>
<span class="line">Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token keyword">null</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">mutations</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token constant">SET_COUNT</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      state<span class="token punctuation">.</span>count <span class="token operator">=</span> payload<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token constant">SET_USER</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      state<span class="token punctuation">.</span>user <span class="token operator">=</span> payload<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">actions</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">async</span> <span class="token function">fetchUser</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> commit <span class="token punctuation">}</span><span class="token punctuation">,</span> userId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> api<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 模拟API请求</span></span>
<span class="line">      <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">&#39;SET_USER&#39;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">getters</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function-variable function">doubleCount</span><span class="token operator">:</span> <span class="token parameter">state</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>count <span class="token operator">*</span> <span class="token number">2</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-vue line-numbers-mode" data-highlighter="prismjs" data-ext="vue"><pre><code class="language-vue"><span class="line"><span class="token comment">&lt;!-- 组件中使用 (MyComponent.vue) --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Count: {{ $store.state.count }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Double: {{ $store.getters.doubleCount }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$store.commit(&#39;SET_COUNT&#39;, 10)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>直接修改<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$store.dispatch(&#39;fetchUser&#39;, 123)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>异步获取用户<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>user<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>​Pinia​​： <ul><li>更简洁的 API（defineStore）</li><li>支持 Composition API</li></ul></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// 定义 Store (stores/counterStore.js)</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> defineStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;pinia&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> useCounterStore <span class="token operator">=</span> <span class="token function">defineStore</span><span class="token punctuation">(</span><span class="token string">&#39;counter&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function-variable function">state</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token keyword">null</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">actions</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> payload<span class="token punctuation">;</span> <span class="token comment">// 直接修改（无需mutations）</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token keyword">async</span> <span class="token function">fetchUser</span><span class="token punctuation">(</span><span class="token parameter">userId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token keyword">await</span> api<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 直接赋值</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">getters</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function-variable function">doubleCount</span><span class="token operator">:</span> <span class="token parameter">state</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>count <span class="token operator">*</span> <span class="token number">2</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-vue line-numbers-mode" data-highlighter="prismjs" data-ext="vue"><pre><code class="language-vue"><span class="line"><span class="token comment">&lt;!-- 组件中使用 (MyComponent.vue) --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Count: {{ counter.count }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Double: {{ counter.doubleCount }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>counter.setCount(10)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>直接修改<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>counter.fetchUser(123)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>异步获取用户<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useCounterStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/stores/counterStore&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> counter <span class="token operator">=</span> <span class="token function">useCounterStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Pinia 是 Vue3 官方推荐的状态管理工具，去除了 mutations，直接支持异步操作</p><h4 id="四、其他通信方式" tabindex="-1"><a class="header-anchor" href="#四、其他通信方式"><span>四、其他通信方式</span></a></h4><h4 id="_6-​​event-bus-vue2-→-mitt-vue3-替代-​​-适用于通知消息" tabindex="-1"><a class="header-anchor" href="#_6-​​event-bus-vue2-→-mitt-vue3-替代-​​-适用于通知消息"><span>6. ​​Event Bus（Vue2）→ mitt（Vue3 替代）​​，适用于通知消息</span></a></h4><ul><li>Vue2​​：通过 <code>new Vue()</code> 实例实现</li><li>​Vue3​​：推荐使用第三方库 <code>mitt</code></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// Vue2 的 Event Bus</span></span>
<span class="line"><span class="token keyword">const</span> bus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">bus<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">&#39;event&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">bus<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&#39;event&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Vue3 使用 mitt</span></span>
<span class="line"><span class="token keyword">import</span> mitt <span class="token keyword">from</span> <span class="token string">&#39;mitt&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> emitter <span class="token operator">=</span> <span class="token function">mitt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">emitter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;event&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">emitter<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&#39;event&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用场景​​：简单场景的跨组件通信，但大型项目建议用 Pinia/Vuex</p><h4 id="_7-ref-获取组件实例-vue2-vue3-​-父组件调用子组件方法" tabindex="-1"><a class="header-anchor" href="#_7-ref-获取组件实例-vue2-vue3-​-父组件调用子组件方法"><span>7. Ref 获取组件实例（Vue2 &amp; Vue3）​，父组件调用子组件方法</span></a></h4><table><thead><tr><th style="text-align:center;">​​特性​</th><th style="text-align:center;">​​Vue2​</th><th style="text-align:center;">​​Vue23</th></tr></thead><tbody><tr><td style="text-align:center;">​​API​</td><td style="text-align:center;">this.$refs.xxx</td><td style="text-align:center;">const xx = ref(null) + xx.value</td></tr><tr><td style="text-align:center;">​​暴露控制​</td><td style="text-align:center;">默认暴露所有选项（data/methods）</td><td style="text-align:center;">需手动 defineExpose 暴露特定内容</td></tr><tr><td style="text-align:center;">Composition</td><td style="text-align:center;">无</td><td style="text-align:center;">支持在 <code>&lt;script setup&gt;</code> 中使用</td></tr></tbody></table><p><strong>Vue2 的 $refs 获取组件实例</strong></p><div class="language-vue line-numbers-mode" data-highlighter="prismjs" data-ext="vue"><pre><code class="language-vue"><span class="line"><span class="token comment">&lt;!-- 父组件（通过 ref 标记子组件） --&gt;</span></span>
<span class="line"><span class="token comment">&lt;!-- Parent.vue --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>childRef<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>callChildMethod<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>调用子组件方法<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"></span>
<span class="line"><span class="token keyword">import</span> Child <span class="token keyword">from</span> <span class="token string">&#39;./Child.vue&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">{</span> Child <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">callChildMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// 通过 $refs 获取子组件实例</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>childRef<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用子组件方法</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>childRef<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 访问子组件数据</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-vue line-numbers-mode" data-highlighter="prismjs" data-ext="vue"><pre><code class="language-vue"><span class="line"><span class="token comment">&lt;!-- 子组件（默认暴露所有选项） --&gt;</span></span>
<span class="line"><span class="token comment">&lt;!-- Child.vue --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>子组件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&#39;Hello from Child&#39;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#39;子组件方法被调用！&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Vue3 的 ref + defineExpose</strong></p><div class="language-vue line-numbers-mode" data-highlighter="prismjs" data-ext="vue"><pre><code class="language-vue"><span class="line"><span class="token comment">&lt;!-- 父组件（使用 ref 绑定） --&gt;</span></span>
<span class="line"><span class="token comment">&lt;!-- Parent.vue --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>childRef<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>callChildMethod<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>调用子组件方法<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> Child <span class="token keyword">from</span> <span class="token string">&#39;./Child.vue&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> childRef <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建 ref 引用</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">callChildMethod</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 通过 .value 访问子组件实例</span></span>
<span class="line">  childRef<span class="token punctuation">.</span>value<span class="token operator">?.</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 安全调用（可选链）</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>childRef<span class="token punctuation">.</span>value<span class="token operator">?.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-vue line-numbers-mode" data-highlighter="prismjs" data-ext="vue"><pre><code class="language-vue"><span class="line"><span class="token comment">&lt;!-- 子组件（需显式暴露内容） --&gt;</span></span>
<span class="line"><span class="token comment">&lt;!-- Child.vue --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>子组件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> defineExpose <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">&#39;Hello from Child&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">sayHello</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#39;子组件方法被调用！&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// 必须显式暴露，父组件才能访问</span></span>
<span class="line"><span class="token function">defineExpose</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  message<span class="token punctuation">,</span></span>
<span class="line">  sayHello</span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7-vue3-diff算法和-vue2-的区别-⭐️" tabindex="-1"><a class="header-anchor" href="#_7-vue3-diff算法和-vue2-的区别-⭐️"><span>7.Vue3 Diff算法和 Vue2 的区别(⭐️)</span></a></h2><p><strong>编译阶段的优化：</strong><br> 1、事件缓存：将事件缓存(如: @click)，可以理解为变成静态的了<br> 2、静态提升：第一次创建静态节点时保存，后续直接复用<br> 3、添加静态标记：给节点添加静态标记，以优化 Diff 过程</p><p>由于编译阶段的优化，除了能更快的生成虚拟 DOM 以外，还使得 Diff 时可以跳过&quot;永远不会变化的节点&quot;，Diff 优化如下：</p><p>Vue2 是全量 Diff。<br> Vue3 是静态标记 + 非全量 Diff， 使用最长递增子序列优化了对比流程。</p><table><thead><tr><th style="text-align:center;">对比项</th><th style="text-align:center;">Vue 2</th><th style="text-align:center;">Vue 3</th></tr></thead><tbody><tr><td style="text-align:center;">Diff 策略</td><td style="text-align:center;">双端交叉比较（头尾指针）</td><td style="text-align:center;">快速 Diff + 最长递增子序列（LIS）</td></tr><tr><td style="text-align:center;">静态优化</td><td style="text-align:center;">无</td><td style="text-align:center;">Patch Flag 标记静态节点</td></tr><tr><td style="text-align:center;">复用机制</td><td style="text-align:center;">依赖 key 的全量比较</td><td style="text-align:center;">使用 Rollup 进行生产打包</td></tr><tr><td style="text-align:center;">移动次数</td><td style="text-align:center;">可能较多</td><td style="text-align:center;">最小化（LIS 优化）</td></tr><tr><td style="text-align:center;">性能</td><td style="text-align:center;">较慢</td><td style="text-align:center;">更快（2~5 倍优化）</td></tr></tbody></table><h2 id="_8-vue3-router" tabindex="-1"><a class="header-anchor" href="#_8-vue3-router"><span>8. Vue3 router</span></a></h2><table><thead><tr><th style="text-align:center;">特性</th><th style="text-align:center;">​​Vue 2 (vue-router 3.x)​</th><th style="text-align:center;">Vue 3 (vue-router 4.x)​</th></tr></thead><tbody><tr><td style="text-align:center;">​​兼容性</td><td style="text-align:center;">仅支持 Vue 2</td><td style="text-align:center;">仅支持 Vue 3</td></tr><tr><td style="text-align:center;">创建方式​</td><td style="text-align:center;">new Router()</td><td style="text-align:center;">createRouter()</td></tr><tr><td style="text-align:center;">​​路由模式​</td><td style="text-align:center;">mode: &#39;history&#39;</td><td style="text-align:center;">history: createWebHistory()</td></tr><tr><td style="text-align:center;">​​动态路由​</td><td style="text-align:center;">router.addRoutes()</td><td style="text-align:center;">router.addRoute()</td></tr></tbody></table><h3 id="_1-具体差异解析" tabindex="-1"><a class="header-anchor" href="#_1-具体差异解析"><span>1. 具体差异解析</span></a></h3><ol><li>​​初始化方式变化​</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// Vue 2 (vue-router 3.x)</span></span>
<span class="line"><span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">&#39;vue-router&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&#39;history&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">routes</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Vue 3 (vue-router 4.x)</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createRouter<span class="token punctuation">,</span> createWebHistory <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue-router&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">createRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">history</span><span class="token operator">:</span> <span class="token function">createWebHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 或 createWebHashHistory()</span></span>
<span class="line">  <span class="token literal-property property">routes</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>​​路由模式配置​</li></ol><ul><li>Vue 2​​：通过 mode 指定</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&#39;history&#39;</span>  <span class="token comment">// 或 &#39;hash&#39;、&#39;abstract&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>​​Vue 3​​：使用独立函数</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createWebHistory<span class="token punctuation">,</span> createWebHashHistory <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue-router&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token literal-property property">history</span><span class="token operator">:</span> <span class="token function">createWebHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// 或 createWebHashHistory()</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><ol start="3"><li>​​动态路由 API​</li></ol></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// Vue 2</span></span>
<span class="line">router<span class="token punctuation">.</span><span class="token function">addRoutes</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>routes<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Vue 3 (更灵活)</span></span>
<span class="line">router<span class="token punctuation">.</span><span class="token function">addRoute</span><span class="token punctuation">(</span>parentName<span class="token punctuation">,</span> route<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加嵌套路由</span></span>
<span class="line">router<span class="token punctuation">.</span><span class="token function">removeRoute</span><span class="token punctuation">(</span><span class="token string">&#39;route-name&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 删除路由</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><ol start="4"><li>​​路由守卫组合式 API​</li></ol></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// Vue 3 新增组合式守卫</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> onBeforeRouteLeave<span class="token punctuation">,</span> onBeforeRouteUpdate <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue-router&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">onBeforeRouteLeave</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">&#39;确定离开吗？&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><ol start="5"><li>​<code>​&lt;router-view&gt;</code> 用法升级​​</li></ol></li></ul><div class="language-vue line-numbers-mode" data-highlighter="prismjs" data-ext="vue"><pre><code class="language-vue"><span class="line"><span class="token comment">&lt;!-- Vue 2 --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-view</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token comment">&lt;!-- Vue 3 支持 v-slot 控制缓存 --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span> <span class="token attr-name">v-slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{ Component }<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keep-alive</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Component<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>keep-alive</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-view</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-新增特性-vue-3-专属" tabindex="-1"><a class="header-anchor" href="#_2-新增特性-vue-3-专属"><span>2. 新增特性（Vue 3 专属）</span></a></h3><ul><li><ol><li>​​路由懒加载改进​</li></ol></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// Vue 3 推荐使用 defineAsyncComponent</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">User</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#39;./User.vue&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// 或</span></span>
<span class="line"><span class="token keyword">const</span> User <span class="token operator">=</span> <span class="token function">defineAsyncComponent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#39;./User.vue&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><ol start="2"><li>路由元数据 (meta) 类型化</li></ol></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">declare module <span class="token string">&#39;vue-router&#39;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">interface</span> <span class="token class-name">RouteMeta</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">requiresAuth</span><span class="token operator">:</span> boolean<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="常见问题" tabindex="-1"><a class="header-anchor" href="#常见问题"><span>常见问题</span></a></h3><ul><li><p>Q1: Vue 3 的 vue-router 为什么改用 createRouter？​​</p></li><li><p>​答​​：</p><ul><li>保持与 Vue 3 的 Composition API 设计一致（工厂函数模式）。</li><li>明确分离路由模式（createWebHistory vs createWebHashHistory）。</li></ul></li><li><p>​​Q2: Vue 3 中如何实现路由守卫？​​</p></li><li><p>​​答​​：</p><ul><li>选项式 API：仍支持 beforeRouteEnter 等组件内守卫。</li><li>组合式 API：使用 onBeforeRouteUpdate 等函数。</li></ul></li><li><p>​Q3: Vue 3 的动态路由有什么优化？​​</p></li><li><p>​答​​：</p><ul><li>支持单个路由的增删（addRoute/removeRoute）。</li><li>优先级规则更符合直觉（后添加的路由优先匹配）</li></ul></li></ul><h2 id="_9-获取数据生命周期对比" tabindex="-1"><a class="header-anchor" href="#_9-获取数据生命周期对比"><span>9.获取数据生命周期对比</span></a></h2><h4 id="vue-2-options-api" tabindex="-1"><a class="header-anchor" href="#vue-2-options-api"><span>Vue 2 (Options API)</span></a></h4><ul><li>在获取数据后，对数据的处理如果不涉及DOM，可在 <code>created</code> 阶段获取，毕竟速度更快一些</li><li>如果数据涉及到DOM的处理，则要在<code>mounted</code>阶段获取数据</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 常见的数据获取位置（不依赖 DOM）</span></span>
<span class="line">  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;https://api.example.com/posts&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="vue-3-composition-api" tabindex="-1"><a class="header-anchor" href="#vue-3-composition-api"><span>Vue 3 (Composition API)</span></a></h4><ol><li>setup() 函数内部（相当于 created 阶段）</li></ol><p>setup() 是组合式 API 的入口，在组件创建时同步执行（早于 beforeMount 和 mounted）。</p><p>这是推荐的数据获取位置，类似于 Vue 2 的 created。</p><ol start="2"><li>onMounted（如果需要依赖 DOM）</li></ol><p>通过 onMounted 钩子可以在 DOM 挂载后执行操作，类似于 Vue 2 的 mounted。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 推荐：在 setup 中直接获取数据（类似 created）</span></span>
<span class="line">    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;https://api.example.com/posts&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 如果需要 DOM，使用 onMounted</span></span>
<span class="line">    <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;DOM 已挂载&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_10-数据定义对比⭐️" tabindex="-1"><a class="header-anchor" href="#_10-数据定义对比⭐️"><span>10.数据定义对比⭐️</span></a></h2><h3 id="vue-2" tabindex="-1"><a class="header-anchor" href="#vue-2"><span>Vue 2</span></a></h3><p><code>data</code> 必须是一个函数，返回一个对象： 所有响应式数据需在 data 函数中定义，Vue 会自动将其转换为响应式对象（基于 <code>Object.defineProperty</code>）。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;Hello Vue2&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>模板中使用，直接通过 <code>this.count</code> 访问。</p><h3 id="vue-3" tabindex="-1"><a class="header-anchor" href="#vue-3"><span>Vue 3</span></a></h3><table><thead><tr><th style="text-align:center;">​​API​</th><th style="text-align:center;">适用类型</th><th style="text-align:center;">访问方式</th><th style="text-align:center;">解构响应性</th><th style="text-align:center;">典型场景</th></tr></thead><tbody><tr><td style="text-align:center;">ref</td><td style="text-align:center;">基本类型/对象</td><td style="text-align:center;">.value</td><td style="text-align:center;">原生支持</td><td style="text-align:center;">单个值、模板暴露、DOM 引用</td></tr><tr><td style="text-align:center;">reactive</td><td style="text-align:center;">对象/数组</td><td style="text-align:center;">直接访问属性</td><td style="text-align:center;">需 toRefs</td><td style="text-align:center;">复杂状态对象、表单数据</td></tr><tr><td style="text-align:center;">toRefs</td><td style="text-align:center;">reactive 对象</td><td style="text-align:center;">.value</td><td style="text-align:center;">原生支持</td><td style="text-align:center;">解构 reactive 返回值</td></tr></tbody></table><h4 id="一、ref-处理基本类型-也可用于对象" tabindex="-1"><a class="header-anchor" href="#一、ref-处理基本类型-也可用于对象"><span>一、ref：处理基本类型（也可用于对象）</span></a></h4><ul><li>核心特点 <ul><li>​<strong>包装基本类型​</strong>​：通过 .value 访问/修改值</li><li><strong>​深层响应式</strong>​​：如果传入对象，内部会调用 reactive 实现深层响应</li><li><strong>​模板自动解包</strong>​​：在模板中无需写 .value</li></ul></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 基本类型</span></span>
<span class="line"><span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span></span>
<span class="line">count<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// 修改值</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 对象类型（也可用，但更推荐 reactive）</span></span>
<span class="line"><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">obj<span class="token punctuation">.</span>value<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 自动深层响应</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>为什么需要 <code>.value</code>？</p><ul><li>由于原始类型不能直接被 Proxy 代理（Proxy 只能作用于对象），Vue 设计了 <code>ref</code> 来处理原始类型的响应式，通过 <code>.value</code> 属性访问其封装的值。</li><li><code>ref</code> 的内部本质上是一个对象，只有一个 <code>.value</code> 属性存储真正的值。对 <code>.value</code> 的访问和修改操作，都会被 <code>Vue</code> 内部的响应式系统捕捉，从而实现响应式更新。</li></ul></li><li><p>为什么不直接用 ref 本身来存取值？</p><ul><li>使用 <code>.value</code> 而不直接使用 <code>ref</code> 本身访问值，主要是为了区分响应式的引用和非响应式的普通变量。</li><li>如果直接使用 <code>ref</code> 本身访问值，而不通过 <code>.value</code>，Vue 无法清楚地区分什么时候应该进行响应式追踪和触发更新。</li></ul></li></ul><h4 id="二、reactive-处理对象-数组" tabindex="-1"><a class="header-anchor" href="#二、reactive-处理对象-数组"><span>二、reactive：处理对象/数组</span></a></h4><ul><li><p>核心特点</p><ul><li><strong>直接代理对象</strong>​​：返回的对象本身就是响应式的</li><li><strong>无需 <code>.value</code>​</strong>​：直接访问属性即可</li><li><strong>深层响应</strong>​​：嵌套对象也会被自动代理</li></ul></li><li><p>重要限制</p><ul><li><strong>不能直接解构</strong>​​：解构后会丢失响应性</li></ul></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// ❌ 错误做法：解构后失去响应性</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> count <span class="token punctuation">}</span> <span class="token operator">=</span> state<span class="token punctuation">;</span></span>
<span class="line">count<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// 不会触发视图更新</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="三、torefs-保持响应式的解构" tabindex="-1"><a class="header-anchor" href="#三、torefs-保持响应式的解构"><span>三、toRefs：保持响应式的解构</span></a></h4><ul><li>解决 <code>reactive</code> 解构问题 <ul><li>​转换对象属性为 <code>ref</code>​​：每个属性都变成独立的 <code>ref</code></li><li>​保持响应性链接​​：修改解构后的值仍能触发更新</li></ul></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> reactive<span class="token punctuation">,</span> toRefs <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;Alice&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> count<span class="token punctuation">,</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">toRefs</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 解构为 ref</span></span>
<span class="line"></span>
<span class="line">count<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// 通过 .value 修改</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1 （原对象同步更新）</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>toRef</code> 和 <code>toRefs</code> 的基本区别： <ul><li><code>toRef</code>：为响应式对象的单个属性创建 <code>ref</code>，保持与源属性的响应式连接</li><li><code>toRefs</code>：将响应式对象的所有属性都转换为 <code>ref</code>，返回一个普通对象，每个属性都是 <code>ref</code></li></ul></li></ul><h2 id="_11-全局-api-变化" tabindex="-1"><a class="header-anchor" href="#_11-全局-api-变化"><span>11.全局 API 变化</span></a></h2><h3 id="​1-创建应用实例​" tabindex="-1"><a class="header-anchor" href="#​1-创建应用实例​"><span>​1. 创建应用实例​</span></a></h3><ul><li><p>Vue 2: 全局 API 挂载在 Vue 构造函数上（如 Vue.component, Vue.directive）。</p></li><li><p>Vue 3: 使用 createApp 创建实例，全局 API 通过实例调用：</p></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// Vue 2</span></span>
<span class="line"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">el</span><span class="token operator">:</span> <span class="token string">&#39;#app&#39;</span><span class="token punctuation">,</span> <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Vue 3</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">&#39;#app&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-全局配置​" tabindex="-1"><a class="header-anchor" href="#_2-全局配置​"><span>2. 全局配置​</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// Vue 2</span></span>
<span class="line">Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// 关闭生产提示</span></span>
<span class="line">Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>ignoredElements <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;custom-el&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 忽略自定义元素</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Vue 3</span></span>
<span class="line"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token function-variable function">errorHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">/* 错误处理 */</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token function-variable function">isCustomElement</span> <span class="token operator">=</span> <span class="token parameter">tag</span> <span class="token operator">=&gt;</span> tag<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&#39;ion-&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 自定义元素检查</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Vue 3 的配置​​仅对当前应用实例生效​​，避免全局副作用。</p><h3 id="_3-全局-api-模块化​" tabindex="-1"><a class="header-anchor" href="#_3-全局-api-模块化​"><span>3. 全局 API 模块化​</span></a></h3><table><thead><tr><th style="text-align:center;">​​Vue 2​</th><th style="text-align:center;">​​Vue 3​​（需显式导入）</th><th style="text-align:center;">作用</th></tr></thead><tbody><tr><td style="text-align:center;"><code>Vue.nextTick</code></td><td style="text-align:center;"><code>import { nextTick } from &#39;vue&#39;</code></td><td style="text-align:center;">DOM 更新后执行回调</td></tr><tr><td style="text-align:center;"><code>Vue.set / Vue.delete</code></td><td style="text-align:center;">​已废弃​​（Proxy 自动支持）</td><td style="text-align:center;">响应式添加/删除属性（Vue 2 专用）</td></tr><tr><td style="text-align:center;"><code>Vue.directive</code></td><td style="text-align:center;">app.directive(&#39;focus&#39;, {...})</td><td style="text-align:center;">注册全局指令</td></tr><tr><td style="text-align:center;"><code>Vue.filter</code></td><td style="text-align:center;">已移除​​（推荐用计算属性替代）</td><td style="text-align:center;">全局过滤器</td></tr></tbody></table><h2 id="_12-新增teleport-传送门-⭐️" tabindex="-1"><a class="header-anchor" href="#_12-新增teleport-传送门-⭐️"><span>12.新增Teleport（传送门）⭐️</span></a></h2><p>Vue 3 新增 <code>Teleport</code>：可以将组件渲染到 DOM 的任意位置（如全局弹窗）：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span></span>
<span class="line">  <span class="token operator">&lt;</span>Teleport to<span class="token operator">=</span><span class="token string">&quot;body&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;modal&quot;</span><span class="token operator">&gt;</span>内容<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">  <span class="token operator">&lt;</span><span class="token operator">/</span>Teleport<span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，<code>&lt;Teleport&gt;</code> 组件会将内部的 <code>&lt;div class=&quot;modal&quot;&gt;</code> 渲染到 <code>&lt;body&gt;</code> 标签中，而不是在当前组件的 DOM 结构中。</p><ul><li>使用场景</li></ul><ol><li>模态框（Modal）</li><li>通知（Notification）</li><li>全局工具提示（Tooltip）</li><li>浮动菜单或弹窗（Dropdown）</li></ol><h4 id="to-属性" tabindex="-1"><a class="header-anchor" href="#to-属性"><span>to 属性</span></a></h4><p>to 属性指定了 Teleport 内容的目标位置。它可以是一个 CSS 选择器字符串，也可以是一个 DOM 元素。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token operator">&lt;</span>teleport to<span class="token operator">=</span><span class="token string">&quot;#app&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>内容将被渲染到 #app 元素中<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span><span class="token operator">/</span>teleport<span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="多个-teleport-到同一个目标" tabindex="-1"><a class="header-anchor" href="#多个-teleport-到同一个目标"><span>多个 Teleport 到同一个目标</span></a></h4><p>如果多个 Teleport 组件指向同一个目标位置，它们的内容会按照在 DOM 中的顺序依次渲染。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span></span>
<span class="line">  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span>teleport to<span class="token operator">=</span><span class="token string">&quot;#target&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>第一个内容<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span><span class="token operator">/</span>teleport<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span>teleport to<span class="token operator">=</span><span class="token string">&quot;#target&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>第二个内容<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span><span class="token operator">/</span>teleport<span class="token operator">&gt;</span></span>
<span class="line">  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="限制与注意事项" tabindex="-1"><a class="header-anchor" href="#限制与注意事项"><span>限制与注意事项</span></a></h4><ol><li>状态依然在父组件</li></ol><ul><li>虽然 DOM 渲染位置发生了变化，但组件的状态、事件等逻辑仍然属于父组件。</li><li>父组件销毁时，Teleport 的内容也会被销毁。</li></ul><ol start="2"><li>动态目标</li></ol><p>目标容器可以是动态创建的，但需要确保容器在 Teleport 渲染之前存在。</p><ol start="3"><li>与 CSS 的交互</li></ol><p>Teleport 的内容脱离了父组件的 DOM 层级，因此需要确保样式在目标容器中也适用。例如，全局样式表需要覆盖 Teleport 渲染的内容。</p><h2 id="_13-新增defineasynccomponent⭐️" tabindex="-1"><a class="header-anchor" href="#_13-新增defineasynccomponent⭐️"><span>13.新增defineAsyncComponent⭐️</span></a></h2><p><code>defineAsyncComponent</code>是Vue3提供的一个API，用于延迟加载组件。它返回一个包装组件，只有当组件需要渲染时才会真正加载。</p><ul><li>有两种使用方式： <ul><li>工厂函数形式：<code>defineAsyncComponent(() =&gt; import(&#39;./Comp.vue&#39;))</code></li><li>配置对象形式：可配置加载状态、错误处理、延迟、超时等</li></ul></li></ul><h3 id="工厂函数形式" tabindex="-1"><a class="header-anchor" href="#工厂函数形式"><span>工厂函数形式</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// 使用import()动态导入</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> defineAsyncComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 1. 工厂函数方式（最简单）</span></span>
<span class="line"><span class="token keyword">const</span> AsyncComp <span class="token operator">=</span> <span class="token function">defineAsyncComponent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> </span>
<span class="line">  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#39;./MyComponent.vue&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>主要应用场景包括： <ul><li>路由懒加载：减少初始包体积</li><li>大组件延迟加载：提升首屏速度</li><li>条件渲染组件：只在需要时加载</li><li>组件库按需引入：减少打包体积</li></ul></li></ul><h2 id="_14-新增suspense⭐️" tabindex="-1"><a class="header-anchor" href="#_14-新增suspense⭐️"><span>14.新增Suspense⭐️</span></a></h2><p><code>Suspense</code>是Vue3新增的内置组件，用于优雅地处理异步组件和异步数据的加载状态。它的核心价值在于提升用户体验，避免页面闪烁和空白</p><h3 id="基本语法" tabindex="-1"><a class="header-anchor" href="#基本语法"><span>基本语法</span></a></h3><div class="language-vue line-numbers-mode" data-highlighter="prismjs" data-ext="vue"><pre><code class="language-vue"><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Suspense</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token comment">&lt;!-- 包含异步组件的插槽 --&gt;</span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">#default</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token comment">&lt;!-- 放置一个或多个异步组件 --&gt;</span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AsyncComponent</span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">&lt;!-- 加载完成前的回退内容 --&gt;</span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">#fallback</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token comment">&lt;!-- 显示加载状态 --&gt;</span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>加载中...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Suspense</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>主要使用场景包括： <ul><li>异步组件加载：结合<code>defineAsyncComponent</code>实现组件懒加载</li><li>异步setup函数：组件内部等待异步数据获取</li><li>路由懒加载：配合Vue Router实现按需加载</li></ul></li></ul><h2 id="_15-v-model-的变化⭐️" tabindex="-1"><a class="header-anchor" href="#_15-v-model-的变化⭐️"><span>15.v-model 的变化⭐️</span></a></h2><ul><li>Vue 2: 一个组件仅支持一个 v-model。</li></ul><p>在 Vue 2 中，v-model 主要用于输入元素 （如 <code>&lt;input&gt;</code>、<code>&lt;textarea&gt;</code> 和 <code>&lt;select&gt;</code>）</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token operator">&lt;</span>input v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">&quot;value&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>input<span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>Vue 3: 支持多个 v-model，并可自定义修饰符：</li></ul><p>在 Vue 3 中，<code>v-model</code> 也可以在自定义组件上使用，并且可以自定义组件上的 <code>modelValue</code> 和 <code>update:modelValue</code> 事件。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 父组件 <span class="token operator">--</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span>ChildComponent v<span class="token operator">-</span>model<span class="token operator">:</span>title<span class="token operator">=</span><span class="token string">&quot;pageTitle&quot;</span> v<span class="token operator">-</span>model<span class="token operator">:</span>content<span class="token operator">=</span><span class="token string">&quot;pageContent&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_16-vue3-性能优化部分⭐️" tabindex="-1"><a class="header-anchor" href="#_16-vue3-性能优化部分⭐️"><span>16.Vue3 性能优化部分⭐️</span></a></h2><h3 id="一、响应式系统升级-proxy-vs-defineproperty" tabindex="-1"><a class="header-anchor" href="#一、响应式系统升级-proxy-vs-defineproperty"><span>一、响应式系统升级：Proxy vs defineProperty</span></a></h3><table><thead><tr><th style="text-align:center;">​​对比项​​</th><th style="text-align:center;">Vue 2 (Object.defineProperty)</th><th style="text-align:center;">Vue 3 (Proxy)</th></tr></thead><tbody><tr><td style="text-align:center;">​<strong>​初始化速度​</strong></td><td style="text-align:center;">递归遍历对象，一次性劫持所有属性</td><td style="text-align:center;">惰性劫持，仅在访问时触发依赖收集</td></tr><tr><td style="text-align:center;">​<strong>动态属性​</strong></td><td style="text-align:center;">无法检测新增/删除属性（需 Vue.set）</td><td style="text-align:center;">直接支持动态增删属性</td></tr><tr><td style="text-align:center;">​​<strong>​数组处理​</strong>​</td><td style="text-align:center;">需重写数组方法（如 push）</td><td style="text-align:center;">直接监听数组索引变化</td></tr><tr><td style="text-align:center;">​​<strong>嵌套对象​</strong>​</td><td style="text-align:center;">递归代理，性能损耗大</td><td style="text-align:center;">按需代理，延迟深层响应</td></tr></tbody></table><ul><li>性能影响​​： <ul><li>大型对象（如 10k+ 属性）的初始化速度提升 ​​2~5 倍​​（官方测试）</li><li>避免 Vue.set 的手动维护成本</li></ul></li></ul><h3 id="二、编译时优化" tabindex="-1"><a class="header-anchor" href="#二、编译时优化"><span>二、编译时优化</span></a></h3><h4 id="_1-​​静态节点提升-static-hoisting-​" tabindex="-1"><a class="header-anchor" href="#_1-​​静态节点提升-static-hoisting-​"><span>1. ​​静态节点提升（Static Hoisting）​</span></a></h4><div class="language-vue line-numbers-mode" data-highlighter="prismjs" data-ext="vue"><pre><code class="language-vue"><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Static Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>  <span class="token comment">&lt;!-- 静态节点 --&gt;</span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{ dynamicText }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!-- 动态节点 --&gt;</span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>​优化效果​​： <ul><li>将静态节点提取为常量，跳过虚拟 DOM 比对</li><li>渲染函数体积减少 ​​30%~40%​</li></ul></li></ul><h4 id="_2-​​patch-flag-靶向更新" tabindex="-1"><a class="header-anchor" href="#_2-​​patch-flag-靶向更新"><span>2. ​​Patch Flag（靶向更新）</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// 编译后的代码</span></span>
<span class="line"><span class="token function">createVNode</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span></span>
<span class="line">  <span class="token function">createVNode</span><span class="token punctuation">(</span><span class="token string">&quot;p&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> text<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token comment">/* TEXT */</span><span class="token punctuation">)</span> <span class="token comment">// 1 表示仅文本动态</span></span>
<span class="line"><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>​优化效果​​： <ul><li>动态节点标记类型（如 1 表示文本动态），比对时跳过无关属性</li><li>虚拟 DOM Diff 速度提升 ​​50%+​</li></ul></li></ul><h4 id="_3-​​树结构拍平-block-tree" tabindex="-1"><a class="header-anchor" href="#_3-​​树结构拍平-block-tree"><span>3. ​​树结构拍平（Block Tree）</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span></span>
<span class="line">  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span>div v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;show&quot;</span><span class="token operator">&gt;</span>Block <span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span>div v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">&gt;</span>Block <span class="token number">2</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>​优化效果​​： <ul><li>动态节点按区块（Block）组织，减少递归深度</li><li>Diff 算法复杂度从 ​​O(n³)​​ 优化至接近 ​​O(n)​</li></ul></li></ul><h3 id="三、虚拟-dom-重写" tabindex="-1"><a class="header-anchor" href="#三、虚拟-dom-重写"><span>三、虚拟 DOM 重写</span></a></h3><h4 id="_1-​​同层比较优化​​" tabindex="-1"><a class="header-anchor" href="#_1-​​同层比较优化​​"><span>1. ​​同层比较优化​​</span></a></h4><ul><li>Vue 2​​：全量比对新旧节点树</li><li>​​Vue 3​​： <ul><li>通过 <code>key</code> 和 <code>patch flag</code> 快速定位动态节点</li><li>跳过静态子树比对</li></ul></li></ul><h4 id="_2-​​事件缓存​" tabindex="-1"><a class="header-anchor" href="#_2-​​事件缓存​"><span>2. ​​事件缓存​</span></a></h4><div class="language-vue line-numbers-mode" data-highlighter="prismjs" data-ext="vue"><pre><code class="language-vue"><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleClick<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Click<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>优化效果​​： <ul><li>将事件处理函数缓存，避免重复创建</li><li>减少 GC 压力</li></ul></li></ul><h3 id="四、tree-shaking-除屑优化-支持" tabindex="-1"><a class="header-anchor" href="#四、tree-shaking-除屑优化-支持"><span>四、Tree-Shaking（除屑优化） 支持</span></a></h3><ul><li>优化原理​​： <ul><li>通过 ES Module 静态分析，移除未使用的代码（如 v-model、transition 等）</li></ul></li></ul><h3 id="五、组合式-api-的运行时优化" tabindex="-1"><a class="header-anchor" href="#五、组合式-api-的运行时优化"><span>五、组合式 API 的运行时优化</span></a></h3><h4 id="_1-​​更高效的组件实例​​" tabindex="-1"><a class="header-anchor" href="#_1-​​更高效的组件实例​​"><span>1. ​​更高效的组件实例​​</span></a></h4><ul><li>Vue 2 每个实例需维护完整的选项上下文（data/watch/computed）</li><li>Vue 3 的 setup() 按需创建响应式引用，内存占用减少 ​​30%​​</li></ul><h4 id="_2-​​ssr-性能提升​​" tabindex="-1"><a class="header-anchor" href="#_2-​​ssr-性能提升​​"><span>2. ​​SSR 性能提升​​</span></a></h4><ul><li>服务端渲染的字符串拼接速度提升 ​​3 倍​​</li><li>得益于编译时的静态节点标记</li></ul><h2 id="_17-其他变化" tabindex="-1"><a class="header-anchor" href="#_17-其他变化"><span>17.其他变化</span></a></h2><h3 id="一、v-if-和-v-for优先级" tabindex="-1"><a class="header-anchor" href="#一、v-if-和-v-for优先级"><span>一、v-if 和 v-for优先级</span></a></h3><p>​避免 <code>v-for</code> 和 <code>v-if</code> 同级使用​​：优先级问题（Vue 2 中 <code>v-for</code> 优先，Vue 3 中 <code>v-if</code> 优先）</p>`,279)])])}const v=s(u,[["render",r]]),m=JSON.parse('{"path":"/pages/frontend/frame/base/Vue3.html","title":"","lang":"zh-CN","frontmatter":{},"git":{"updatedTime":1767525743000,"contributors":[{"name":"李旭翔","username":"","email":"837435186@qq.com","commits":1},{"name":"nxiang","username":"","email":"837435186@qq.com","commits":7},{"name":"lixx","username":"","email":"837435186@qq.com","commits":7}],"changelog":[{"hash":"b008c56f65186c668df24534c6ca5b5f3951a5a7","time":1767525743000,"email":"837435186@qq.com","author":"nxiang","message":"update"},{"hash":"ec1fc409126a3f87c77b898f937b212f82dc9f7d","time":1767101499000,"email":"837435186@qq.com","author":"nxiang","message":"update"},{"hash":"9247946d466ac03fc922726e33912af74f66502d","time":1766932969000,"email":"837435186@qq.com","author":"nxiang","message":"update"},{"hash":"5246cbd2b8ea64e45f23b2240f171126dc9d3365","time":1766131007000,"email":"837435186@qq.com","author":"nxiang","message":"update"},{"hash":"b25c1c827b636f36f7a89fd0befec8d748d2ba60","time":1764846259000,"email":"837435186@qq.com","author":"nxiang","message":"u"},{"hash":"c61acd36778d81123d3084bcaa3301c1e28aaa24","time":1748426026000,"email":"837435186@qq.com","author":"lixx","message":"update"},{"hash":"db346b4124c95537eaba620ce0e5b2550c8f3e16","time":1748252963000,"email":"837435186@qq.com","author":"lixx","message":"update"},{"hash":"78daa02bdc06401d86656c5e4e06e5c33cb86567","time":1748079694000,"email":"837435186@qq.com","author":"lixx","message":"update"},{"hash":"ed1795553344e1b56afcd8d56f28951af2b33cc5","time":1747475544000,"email":"837435186@qq.com","author":"lixx","message":"update"},{"hash":"dd869f6d423404dc68fa92722a2977f89d127454","time":1747389727000,"email":"837435186@qq.com","author":"lixx","message":"update"},{"hash":"df1beb42a60492ba20bbf99cd5f7539292da1f1d","time":1746004920000,"email":"837435186@qq.com","author":"lixx","message":"update"},{"hash":"14dd74491805c43e4d3d6981bc31b273b7230b7e","time":1743500812000,"email":"837435186@qq.com","author":"lixx","message":"update"},{"hash":"7d2aca2343eb4bb8c0d020d151892171aafaf210","time":1667440378000,"email":"837435186@qq.com","author":"nxiang","message":"feat：react content update"},{"hash":"007c0125f821d72555a1c199f2ca495e110c5b26","time":1662965077000,"email":"837435186@qq.com","author":"nxiang","message":"feat：update frame content"},{"hash":"747d34554b90b4ba1cca4002413cc29a726b67d9","time":1660290630000,"email":"837435186@qq.com","author":"李旭翔","message":"✨ feat：update"}]},"filePathRelative":"pages/frontend/frame/base/Vue3.md"}');export{v as comp,m as data};

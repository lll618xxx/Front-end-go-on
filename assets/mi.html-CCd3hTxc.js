import{_ as e,c as n,a as s,o as a}from"./app-BKtqNPcQ.js";const i={};function l(p,t){return a(),n("div",null,[...t[0]||(t[0]=[s(`<h2 id="_1-米家业务相关在线地址" tabindex="-1"><a class="header-anchor" href="#_1-米家业务相关在线地址"><span>1.米家业务相关在线地址</span></a></h2><p><a href="https://home.miot-spec.com/" target="_blank" rel="noopener noreferrer">小米/米家产品库 - Xiaomi Miot Spec</a></p><p><a href="https://vd.iot.mi.com/home" target="_blank" rel="noopener noreferrer">AIoT平台高仿真系统 - 设备租借</a></p><p><a href="https://autotest.iot.mi.com/acsLanding/" target="_blank" rel="noopener noreferrer">AIoT认证测试平台 - 自动测试</a></p><h2 id="_2-米家wifi设备的架构和通信流程" tabindex="-1"><a class="header-anchor" href="#_2-米家wifi设备的架构和通信流程"><span>2.米家WiFi设备的架构和通信流程</span></a></h2><h4 id="_2-1、整体架构" tabindex="-1"><a class="header-anchor" href="#_2-1、整体架构"><span>2-1、整体架构</span></a></h4><p>米家生态的通信流程通常分为三层：</p><p>1、<strong>设备端</strong>：WiFi模组（如ESP32/乐鑫方案）运行定制固件，支持与云端/App交互。</p><p>2、<strong>云端服务器</strong>：小米的IoT平台（Miot Cloud）负责设备管理、指令转发和数据存储。</p><p>3、<strong>客户端（插件/App）</strong>：通过SDK或API与云端交互，间接控制设备。</p><h4 id="_2-2、关键通信流程" tabindex="-1"><a class="header-anchor" href="#_2-2、关键通信流程"><span>2-2、关键通信流程</span></a></h4><p><strong>1、设备配网（Provisioning）</strong></p><p>设备初次联网需通过「Smart Config」或「AP配网模式」：</p><ul><li><p><strong>Smart Config</strong>：手机App发送WiFi SSID/Password的加密广播包（UDP），设备监听并解析。</p></li><li><p><strong>AP模式</strong>：设备开启热点，用户连接后通过HTTP页面提交WiFi信息。</p></li><li><p><strong>配网后</strong>：设备通过MQTT/TLS与小米云建立长连接，并上报设备信息（DID、Token等）。</p></li></ul><p><strong>2、认证与绑定</strong></p><ul><li><p><strong>设备唯一标识</strong>：每个设备拥有唯一的DID（Device ID）和Token（加密密钥）。</p></li><li><p><strong>绑定流程</strong>：用户通过App扫码或手动添加设备，云端验证Token后绑定设备到账户。</p></li></ul><p><strong>3. 通信协议</strong></p><p>米家采用分层协议设计，核心协议包括：</p><ul><li><p><strong>传输层</strong>：基于TLS加密的MQTT协议（长连接）+ HTTP（配置/OTA升级）。</p></li><li><p><strong>应用层</strong>：自定义二进制协议（部分设备开放HTTP API），数据格式通常为JSON或Protobuf。</p></li></ul><p><strong>MQTT 主题结构</strong></p><p>设备与云端通过MQTT的Topic订阅/发布消息：</p><ul><li><p><strong>指令下发</strong>：miio/command/{DID}</p></li><li><p><strong>状态上报</strong>：miio/report/{DID}</p></li><li><p><strong>设备心跳</strong>：miio/heartbeat/{DID}</p></li></ul><p><strong>4. 指令交互流程</strong></p><p>以开关灯为例：</p><p>App/插件端：调用小米云API（如miot-spec.com）发送指令（JSON格式）。</p><p>云端：验证权限后，通过MQTT将指令转发到目标设备。</p><p>设备端：执行指令并返回状态码（如{&quot;code&quot;:0}表示成功）。</p><p>云端：将状态同步到App/插件端。</p><p><strong>5. 本地通信（可选）</strong></p><p>部分设备支持局域网控制（绕过云端）：</p><ul><li><p><strong>协议</strong>：UDP广播 + 自定义二进制协议（如Xiaomi MIoT Spec Local）。</p></li><li><p><strong>发现设备</strong>：发送广播包到端口54321，设备响应IP和Token。</p></li><li><p><strong>指令加密</strong>：使用AES-CBC加密，密钥由Token派生。</p></li></ul><h4 id="_2-3、插件端开发关键点" tabindex="-1"><a class="header-anchor" href="#_2-3、插件端开发关键点"><span>2-3、插件端开发关键点</span></a></h4><h4 id="_2-3-1、接入方式" tabindex="-1"><a class="header-anchor" href="#_2-3-1、接入方式"><span>2-3-1、接入方式：</span></a></h4><ul><li><p><strong>云端API</strong>：通过小米开放平台（Open Cloud）申请API权限，使用OAuth 2.0授权。</p></li><li><p><strong>本地控制</strong>：需获取设备的Token和IP，直接发送加密指令（需逆向协议）。</p></li></ul><h4 id="_2-3-2、sdk支持" tabindex="-1"><a class="header-anchor" href="#_2-3-2、sdk支持"><span>2-3-2、SDK支持：</span></a></h4><p>官方提供MiHome SDK或MIoT Spec，封装了协议细节。</p><p>第三方库（如python-miio）支持部分设备的本地控制。</p><h4 id="_2-3-3、数据格式示例-伪代码" tabindex="-1"><a class="header-anchor" href="#_2-3-3、数据格式示例-伪代码"><span>2-3-3、数据格式示例（伪代码）：</span></a></h4><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre><code class="language-json"><span class="line"><span class="token comment">// 云端API指令</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;method&quot;</span><span class="token operator">:</span> <span class="token string">&quot;set_properties&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;params&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;did&quot;</span><span class="token operator">:</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;siid&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token comment">// 服务ID</span></span>
<span class="line">    <span class="token property">&quot;piid&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment">// 属性ID</span></span>
<span class="line">    <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-4-安全机制" tabindex="-1"><a class="header-anchor" href="#_2-4-安全机制"><span>2-4.安全机制</span></a></h4><p><strong>设备认证</strong>：Token绑定设备与账户，防止未授权访问。</p><p><strong>通信加密</strong>：TLS 1.2（云端） + AES（本地）。</p><p><strong>动态刷新</strong>：部分设备支持Token周期性更新。</p><h2 id="_3-联网方式对比" tabindex="-1"><a class="header-anchor" href="#_3-联网方式对比"><span>3.联网方式对比</span></a></h2><table><thead><tr><th style="text-align:center;">联网方式</th><th style="text-align:center;">功耗</th><th style="text-align:center;">覆盖范围</th><th style="text-align:center;">带宽</th><th style="text-align:center;">适用规模</th><th style="text-align:center;">典型应用</th></tr></thead><tbody><tr><td style="text-align:center;">Wi-Fi</td><td style="text-align:center;">高</td><td style="text-align:center;">中（依赖路由）</td><td style="text-align:center;">高</td><td style="text-align:center;">中小型</td><td style="text-align:center;">智能电视、摄像头</td></tr><tr><td style="text-align:center;">Wi-Fi + BLE</td><td style="text-align:center;">中</td><td style="text-align:center;">中</td><td style="text-align:center;">高</td><td style="text-align:center;">中小型</td><td style="text-align:center;">智能音箱、中控面板</td></tr><tr><td style="text-align:center;">BLE</td><td style="text-align:center;">极低</td><td style="text-align:center;">短（10-50m）</td><td style="text-align:center;">低</td><td style="text-align:center;">点对点/少量设备</td><td style="text-align:center;">手环、智能锁</td></tr><tr><td style="text-align:center;">BLE-Mesh</td><td style="text-align:center;">低-中</td><td style="text-align:center;">中-大（接力）</td><td style="text-align:center;">中低</td><td style="text-align:center;">大型（数百节点）</td><td style="text-align:center;">商业照明、传感器网络</td></tr><tr><td style="text-align:center;">第三方云接入</td><td style="text-align:center;">依赖底层</td><td style="text-align:center;">全球</td><td style="text-align:center;">依赖网络</td><td style="text-align:center;">任意规模</td><td style="text-align:center;">跨区域设备管理</td></tr><tr><td style="text-align:center;">虚拟设备组</td><td style="text-align:center;">无影响</td><td style="text-align:center;">无限制</td><td style="text-align:center;">无影响</td><td style="text-align:center;">任意规模</td><td style="text-align:center;">场景化智能家居联动</td></tr></tbody></table><h4 id="选择建议" tabindex="-1"><a class="header-anchor" href="#选择建议"><span>选择建议</span></a></h4><ul><li>低功耗+近距离：优先BLE。</li><li>大规模组网：选择BLE-Mesh或Zigbee（未提及但常用）。</li><li>高带宽+互联网接入：Wi-Fi或双模。</li><li>快速商业化部署：第三方云接入。</li><li>多设备协同：虚拟设备组+兼容协议（如Matter）。</li></ul><h4 id="wi-fi、ble、ble-mesh-对比" tabindex="-1"><a class="header-anchor" href="#wi-fi、ble、ble-mesh-对比"><span>Wi-Fi、BLE、BLE Mesh 对比</span></a></h4><table><thead><tr><th style="text-align:center;">接入方式</th><th style="text-align:center;">Wi-Fi</th><th style="text-align:center;">BLE</th><th style="text-align:center;">BLE Mesh</th></tr></thead><tbody><tr><td style="text-align:center;">使用场景</td><td style="text-align:center;">有电源常供电、且用户多以 单个产品购买使用的产品，如空调、厨房电器</td><td style="text-align:center;">低功耗的硬件产品，如手环、按摩器等运动健康类产品</td><td style="text-align:center;">电工：灯、开关、插座、电风扇和窗帘</td></tr><tr><td style="text-align:center;">优势</td><td style="text-align:center;">上网简单，用户熟悉度高，不需要额外的 网关，可以和存量路由器直接通信</td><td style="text-align:center;">低成本、低功耗，近场与手机连接，不支持远程下行，支持上行（依赖网关）</td><td style="text-align:center;">低成本、低功耗，支持远程上下行 ( 依赖 Mesh 网关 )，和近场 BLE GATT 直连</td></tr><tr><td style="text-align:center;">缺点</td><td style="text-align:center;">成本高，功耗高</td><td style="text-align:center;">远程上行 需要依赖 BLE 网关，远程下行 不支持</td><td style="text-align:center;">需要依赖 Mesh 网关，上下行指令长度较小</td></tr></tbody></table><ul><li><p>米家 BLE 设备通过网关只能上报数据，在没有网关时也可根据需要开发蓝牙直连功能控制设备。</p></li><li><p>米家 BLE Mesh 设备实现远程控制需要有 Mesh 网关，在没有网关时也可根据需要开发蓝牙直连功能控制设备。</p></li></ul><h4 id="wi-fi-和-wi-fi-ble-对比" tabindex="-1"><a class="header-anchor" href="#wi-fi-和-wi-fi-ble-对比"><span>Wi-Fi 和 Wi-Fi + BLE 对比</span></a></h4><p>Wi-Fi + BLE 双模</p><ul><li><p>BLE 角色：用于低功耗待机、设备发现和快速配网（如通过 BLE 广播 Wi-Fi 的 SSID/密码）。</p></li><li><p>Wi-Fi 角色：配网完成后切换至 Wi-Fi 进行高速数据传输。</p></li></ul><p>BLE 一般只用于配网</p><p><strong>传统Wi-Fi配网方式（AP模式/手动输入密码）</strong></p><p>AP模式（热点配网）</p><ul><li>原理：</li></ul><p>设备启动时，自身变成一个Wi-Fi热点（类似手机开热点）。</p><p>用户手机需要手动连接这个设备热点（如 Device_XXXX），然后在浏览器或App内输入家庭Wi-Fi的SSID和密码。</p><p>设备收到信息后，关闭热点模式，尝试连接家庭Wi-Fi。</p><ul><li>缺点：</li></ul><p>用户需要 手动切换手机Wi-Fi（从家庭Wi-Fi切换到设备热点），操作繁琐。</p><p><strong>实际案例对比</strong></p><ul><li>场景1：智能灯泡配网</li></ul><p>传统Wi-Fi方式：</p><p>1.断电重启灯泡，进入AP模式。</p><p>2.手机Wi-Fi列表里找到 Light_XXXX 并连接。</p><p>3.打开米家App，选择“添加设备”，手动输入家庭Wi-Fi密码。</p><p>4.等待配网，成功后手机需手动切换回家庭Wi-Fi。</p><p>BLE一键配网：</p><p>1.通电后，打开米家App，自动弹出“发现新设备”。</p><p>2.点击“确认配网”，App自动推送Wi-Fi信息。</p><p>3.灯泡连接成功，全程无需手动输入密码或切换Wi-Fi。</p><h2 id="_4-wi-fi设备和ble-mesh带网关设备的通信流程对比" tabindex="-1"><a class="header-anchor" href="#_4-wi-fi设备和ble-mesh带网关设备的通信流程对比"><span>4. Wi-Fi设备和BLE-Mesh带网关设备的通信流程对比</span></a></h2><h3 id="_4-1-wi-fi设备的通信流程" tabindex="-1"><a class="header-anchor" href="#_4-1-wi-fi设备的通信流程"><span>4.1 Wi-Fi设备的通信流程</span></a></h3><p><strong>网络架构</strong></p><p>直接连接互联网：Wi-Fi设备通过路由器直接接入云端，无需中间网关。</p><p>通信路径：设备 → 路由器 → 互联网（云服务器） → 用户手机/终端</p><p><strong>通信特点</strong></p><ul><li><p>协议栈：基于TCP/IP（HTTP/MQTT/CoAP），依赖Wi-Fi的IEEE 802.11标准。</p></li><li><p>数据传输：</p><ul><li>设备与云端长连接（如MQTT心跳包），实时双向通信。</li><li>用户通过手机App发送指令时，需经过云端中转（即使设备与手机在同一局域网）。</li></ul></li><li><p>优缺点：</p><ul><li>✅ 无需网关，部署简单。</li><li>❌ 依赖互联网，断网时无法控制（除非设备支持本地局域网协议，如Home Assistant）。</li></ul></li></ul><p><strong>典型场景</strong><br> 智能摄像头、Wi-Fi插座等直接联网设备。</p><h3 id="_4-2-ble-mesh带网关设备的通信流程" tabindex="-1"><a class="header-anchor" href="#_4-2-ble-mesh带网关设备的通信流程"><span>4.2 BLE-Mesh带网关设备的通信流程</span></a></h3><p><strong>网络架构</strong></p><p>分层组网：BLE-Mesh设备通过网关与云端交互，网关是本地与云端的桥梁。</p><p>通信路径：设备 → BLE-Mesh节点（中继） → 网关 → 互联网 → 用户手机/终端</p><p><strong>通信特点</strong></p><ul><li><p>协议栈：</p><ul><li>设备间：BLE Mesh协议（基于蓝牙4.0+，使用GATT广播或洪泛路由）。</li><li>网关与云端：Wi-Fi/Ethernet + MQTT/HTTP。</li></ul></li><li><p>数据传输：</p><ul><li>本地控制：手机通过网关直接控制设备（不依赖云端，如米家蓝牙Mesh网关）。</li><li>远程控制：指令需经网关上传至云端，再返回网关执行。</li><li>自组网：节点间通过多跳中继传递数据，扩展覆盖范围。</li></ul></li><li><p>优缺点：</p><ul><li>✅ 断网时可本地控制（网关+手机在局域网内）。</li><li>❌ 需额外网关硬件，成本较高。</li></ul></li></ul><p><strong>典型场景</strong><br> 蓝牙Mesh灯泡、传感器等低功耗设备（如Yeelight吸顶灯）。</p><h3 id="_4-3-核心差异对比表" tabindex="-1"><a class="header-anchor" href="#_4-3-核心差异对比表"><span>4.3 核心差异对比表</span></a></h3><table><thead><tr><th style="text-align:center;">对比项</th><th style="text-align:center;">Wi-Fi设备</th><th style="text-align:center;">BLE-Mesh带网关设备</th></tr></thead><tbody><tr><td style="text-align:center;">网络拓扑</td><td style="text-align:center;">星型（设备直连路由器）</td><td style="text-align:center;">网状（设备-网关-云端）</td></tr><tr><td style="text-align:center;">依赖网关</td><td style="text-align:center;">否</td><td style="text-align:center;">是</td></tr><tr><td style="text-align:center;">断网控制</td><td style="text-align:center;">通常不可用（除非支持本地协议）</td><td style="text-align:center;">可通过网关本地控制</td></tr><tr><td style="text-align:center;">覆盖范围</td><td style="text-align:center;">依赖路由器信号</td><td style="text-align:center;">通过Mesh节点中继扩展</td></tr><tr><td style="text-align:center;">功耗</td><td style="text-align:center;">高（持续Wi-Fi连接）</td><td style="text-align:center;">低（BLE间歇性通信）</td></tr><tr><td style="text-align:center;">典型协议</td><td style="text-align:center;">HTTP/MQTT over Wi-Fi</td><td style="text-align:center;">BLE Mesh Profile + 网关转MQTT</td></tr></tbody></table><h3 id="_4-4-通信流程示例" tabindex="-1"><a class="header-anchor" href="#_4-4-通信流程示例"><span>4.4 通信流程示例</span></a></h3><ul><li>Wi-Fi智能灯泡控制</li></ul><p>1.用户点击App开关 → 指令发送至云端。<br> 2.云端通过互联网推送指令到家庭路由器。<br> 3.路由器通过Wi-Fi将指令传给灯泡。</p><ul><li><p>BLE-Mesh灯泡控制（带网关）</p><ul><li><p>场景1：远程控制<br> 1.用户点击App开关 → 指令发送至云端。<br> 2.云端推送指令到家庭网关（需网关在线）。<br> 3.网关通过BLE-Mesh将指令广播至灯泡（可能经多跳中继）。</p></li><li><p>场景2：本地控制（断网时）<br> 1.手机直接连接网关（同一局域网）。<br> 2.网关通过BLE-Mesh本地控制灯泡。</p></li></ul></li></ul>`,94)])])}const o=e(i,[["render",l]]),d=JSON.parse('{"path":"/pages/otherLang/ioT%E2%80%8C/mi.html","title":"","lang":"zh-CN","frontmatter":{},"git":{"updatedTime":1745044414000,"contributors":[{"name":"lixx","username":"","email":"837435186@qq.com","commits":4}],"changelog":[{"hash":"2ae23818638900edebeb2f9957bb56aea4ef53f7","time":1745044414000,"email":"837435186@qq.com","author":"lixx","message":"update mi"},{"hash":"e6cb5f216f72ea55570d89d7f8ef78cc7572864c","time":1742548856000,"email":"837435186@qq.com","author":"lixx","message":"11"},{"hash":"75f7e2b41e9e0aa828bf3c8d8fe5b16b31d86623","time":1742547682000,"email":"837435186@qq.com","author":"lixx","message":"update"},{"hash":"c11d295ca6248ba3e821e31873b93b699eed95b7","time":1739603365000,"email":"837435186@qq.com","author":"lixx","message":"abc"}]},"filePathRelative":"pages/otherLang/ioT‌/mi.md"}');export{o as comp,d as data};
